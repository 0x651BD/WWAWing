var wwa_input;
(function(c){(function(b){b[b.NONE=0]="NONE";b[b.KEYDOWN=1]="KEYDOWN";b[b.KEYPRESS=2]="KEYPRESS";b[b.KEYUP=3]="KEYUP";b[b.KEYPRESS_MESSAGECHANGE=4]="KEYPRESS_MESSAGECHANGE"})(c.KeyState||(c.KeyState={}));var g=c.KeyState;(function(b){b[b.KEY_ENTER=13]="KEY_ENTER";b[b.KEY_SHIFT=16]="KEY_SHIFT";b[b.KEY_ESC=27]="KEY_ESC";b[b.KEY_SPACE=32]="KEY_SPACE";b[b.KEY_LEFT=37]="KEY_LEFT";b[b.KEY_UP=38]="KEY_UP";b[b.KEY_RIGHT=39]="KEY_RIGHT";b[b.KEY_DOWN=40]="KEY_DOWN";b[b.KEY_1=49]="KEY_1";b[b.KEY_2=50]="KEY_2";
b[b.KEY_3=51]="KEY_3";b[b.KEY_A=65]="KEY_A";b[b.KEY_C=67]="KEY_C";b[b.KEY_D=68]="KEY_D";b[b.KEY_E=69]="KEY_E";b[b.KEY_I=73]="KEY_I";b[b.KEY_M=77]="KEY_M";b[b.KEY_N=78]="KEY_N";b[b.KEY_P=80]="KEY_P";b[b.KEY_Q=81]="KEY_Q";b[b.KEY_S=83]="KEY_S";b[b.KEY_W=87]="KEY_W";b[b.KEY_X=88]="KEY_X";b[b.KEY_Y=89]="KEY_Y";b[b.KEY_Z=90]="KEY_Z";b[b.KEY_F1=112]="KEY_F1";b[b.KEY_F3=114]="KEY_F3";b[b.KEY_F4=115]="KEY_F4";b[b.KEY_F5=116]="KEY_F5";b[b.KEY_F6=117]="KEY_F6";b[b.KEY_F7=118]="KEY_F7";b[b.KEY_F8=119]="KEY_F8";
b[b.KEY_F12=123]="KEY_F12"})(c.KeyCode||(c.KeyCode={}));var k=function(){function b(){var e;this._nextKeyState=Array(b.KEY_BUFFER_MAX);this._keyState=Array(b.KEY_BUFFER_MAX);this._prevKeyState=Array(b.KEY_BUFFER_MAX);this._prevKeyStateOnControllable=Array(b.KEY_BUFFER_MAX);this._keyInputContinueFrameNum=Array(b.KEY_BUFFER_MAX);for(e=0;e<b.KEY_BUFFER_MAX;e++)this._nextKeyState[e]=!1,this._keyState[e]=!1,this._prevKeyState[e]=!1,this._prevKeyStateOnControllable[e]=!1,this._keyInputContinueFrameNum[e]=
0}b.prototype.checkHitKey=function(b){b=this.getKeyState(b);return b===g.KEYDOWN||b===g.KEYPRESS};b.prototype.getKeyState=function(b){return this._prevKeyState[b]?this._keyState[b]?g.KEYPRESS:g.KEYUP:this._keyState[b]?g.KEYDOWN:g.NONE};b.prototype.getKeyStateForControllPlayer=function(b){return this._prevKeyStateOnControllable[b]?this._keyState[b]?g.KEYPRESS:g.KEYUP:this._keyState[b]?g.KEYDOWN:g.NONE};b.prototype.getKeyStateForMessageCheck=function(b){return this._prevKeyState[b]?this._keyState[b]?
this._keyInputContinueFrameNum[b]>=wwa_data.WWAConsts.KEYPRESS_MESSAGE_CHANGE_FRAME_NUM?g.KEYPRESS_MESSAGECHANGE:g.KEYPRESS:g.KEYUP:this._keyState[b]?g.KEYDOWN:g.NONE};b.prototype.setPressInfo=function(b){this._nextKeyState[b]=!0;this._keyInputContinueFrameNum[b]=-1};b.prototype.setReleaseInfo=function(b){this._nextKeyState[b]=!1;this._keyInputContinueFrameNum[b]=-1};b.prototype.update=function(){var e;this._prevKeyState=this._keyState.slice();this._keyState=this._nextKeyState.slice();for(e=0;e<b.KEY_BUFFER_MAX;e++)this._keyState[e]&&
this._keyInputContinueFrameNum[e]++};b.prototype.memorizeKeyStateOnControllableFrame=function(){this._prevKeyStateOnControllable=this._keyState.slice()};b.prototype.allClear=function(){var e;this._nextKeyState=Array(b.KEY_BUFFER_MAX);for(e=0;e<b.KEY_BUFFER_MAX;e++)this._nextKeyState[e]=!1};b.KEY_BUFFER_MAX=256;return b}();c.KeyStore=k;(function(b){b[b.NONE=0]="NONE";b[b.MOUSEDOWN=1]="MOUSEDOWN";b[b.MOUSEPRESS=2]="MOUSEPRESS";b[b.MOUSEUP=3]="MOUSEUP"})(c.MouseState||(c.MouseState={}));var e=c.MouseState,
k=function(){function b(){this._nextMouseState=this._mouseState=this._prevMouseState=!1}b.prototype.checkClickMouse=function(b){b=void 0!==b?this.getMouseState(b):this.getMouseState();return b===e.MOUSEDOWN||b===e.MOUSEPRESS};b.prototype.getMouseState=function(b){return void 0!==b&&this._inputDir!==b?e.NONE:this._prevMouseState?this._mouseState?e.MOUSEPRESS:e.MOUSEUP:this._mouseState?e.MOUSEDOWN:e.NONE};b.prototype.getMouseStateForControllPlayer=function(b){return void 0!==b&&this._inputDir!==b?e.NONE:
this._prevMouseStateOnControllable?this._mouseState?e.MOUSEPRESS:e.MOUSEUP:this._mouseState?e.MOUSEDOWN:e.NONE};b.prototype.setPressInfo=function(b,a){this._nextMouseState=!0;this._inputDir=b;this._touchID=a};b.prototype.setReleaseInfo=function(){this._touchID=void 0;this._nextMouseState=!1};b.prototype.memorizeMouseStateOnControllableFrame=function(){this._prevMouseStateOnControllable=this._mouseState};b.prototype.update=function(){this._prevMouseState=this._mouseState;this._mouseState=this._nextMouseState};
b.prototype.clear=function(){this._nextMouseState=!1};b.prototype.getTouchID=function(){return this._touchID};return b}();c.MouseStore=k})(wwa_input||(wwa_input={}));var __extends=this.__extends||function(c,g){function k(){this.constructor=c}for(var e in g)g.hasOwnProperty(e)&&(c[e]=g[e]);k.prototype=g.prototype;c.prototype=new k},wwa_data;
(function(c){var g=function(){function a(a,l){this.strength=a;this.defence=l}a.prototype.add=function(a){this.strength+=a.strength;this.defence+=a.defence;return this};a.prototype.plus=function(f){return new a(this.strength+f.strength,this.defence+f.defence)};a.prototype.minus=function(f){return new a(this.strength-f.strength,this.defence-f.defence)};a.prototype.equals=function(a){return this.strength===a.strength&&this.defence===a.defence};return a}();c.EquipmentStatus=g;g=function(a){function f(l,
d,f,b){this.energy=l;this.gold=b;a.call(this,d,f)}__extends(f,a);f.prototype.add=function(a){a instanceof f&&(this.energy+=a.energy,this.gold+=a.gold);this.strength+=a.strength;this.defence+=a.defence;return this};f.prototype.plus=function(a){return a instanceof f?new f(this.energy+a.energy,this.strength+a.strength,this.defence+a.defence,this.gold+a.gold):new f(this.energy,this.strength+a.strength,this.defence+a.defence,this.gold)};f.prototype.minus=function(a){return a instanceof f?new f(this.energy-
a.energy,this.strength-a.strength,this.defence-a.defence,this.gold-a.gold):new f(this.energy,this.strength-a.strength,this.defence-a.defence,this.gold)};f.prototype.equals=function(a){return this.energy===a.energy&&this.strength===a.strength&&this.defence===a.defence&&this.gold===a.gold};return f}(g);c.Status=g;var k=function(){function a(a,l){void 0===a&&(a=0);void 0===l&&(l=0);this.x=a;this.y=l}a.prototype.equals=function(a){return this.x===a.x&&this.y===a.y};a.prototype.substract=function(f){return new a(this.x-
f.x,this.y-f.y)};a.prototype.clone=function(){return new a(this.x,this.y)};a.prototype.convertIntoPosition=function(a){return new e(a,this.x,this.y,0,0)};a.prototype.getDirectionTo=function(a){return this.x<a.x?this.y>a.y?b.RIGHT_UP:this.y===a.y?b.RIGHT:b.RIGHT_DOWN:this.x===a.x?this.y>a.y?b.UP:this.y===a.y?b.NO_DIRECTION:b.DOWN:this.y>a.y?b.LEFT_UP:this.y===a.y?b.LEFT:b.LEFT_DOWN};return a}();c.Coord=k;var e=function(){function a(a,l,d,b,e){void 0===b&&(b=0);void 0===e&&(e=0);this._wwa=a;if(void 0===
this._wwa)throw Error("WWA\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u5b58\u5728\u3057\u307e\u305b\u3093. ");a=this._wwa.getMapWidth();if(0>l||l>=a||l>=a-1&&0<b||0>d||d>=a||d>=a-1&&0<e)throw Error("\u7bc4\u56f2\u5916\u306e\u5ea7\u6a19\u3067\u3059!! parts:("+l+", "+d+"), offset:("+b+", "+e+"), mapWidth = "+a);this._partsCoord=new k(l,d);this._offsetCoord=new k(b,e)}a.prototype.getPartsCoord=function(){return this._partsCoord};a.prototype.getOffsetCoord=function(){return this._offsetCoord};a.prototype.getScreenTopPosition=
function(){return new a(this._wwa,Math.floor(this._partsCoord.x/(m.H_PARTS_NUM_IN_WINDOW-1))*(m.H_PARTS_NUM_IN_WINDOW-1),Math.floor(this._partsCoord.y/(m.V_PARTS_NUM_IN_WINDOW-1))*(m.V_PARTS_NUM_IN_WINDOW-1),0,0)};a.prototype.getNextJustPosition=function(f){if(void 0!==f){var l=this._partsCoord;return new a(this._wwa,l.x+c.vx[f],l.y+c.vy[f],0,0)}f=this._partsCoord.x;l=this._partsCoord.y;0>this._offsetCoord.x?f--:0<this._offsetCoord.x&&f++;0>this._offsetCoord.y?l--:0<this._offsetCoord.y&&l++;return new a(this._wwa,
f,l,0,0)};a.prototype.getNextFramePosition=function(f,l,d){var b=this._partsCoord.x,e=this._partsCoord.y;l=this._offsetCoord.x+c.vx[f]*l;f=this._offsetCoord.y+c.vy[f]*d;0>l&&(d=Math.floor(Math.abs(l)/m.CHIP_SIZE),b-=d,l=(l+d*m.CHIP_SIZE)%m.CHIP_SIZE);0>f&&(d=Math.floor(Math.abs(f)/m.CHIP_SIZE),e-=d,f=(f+d*m.CHIP_SIZE)%m.CHIP_SIZE);l>=m.CHIP_SIZE&&(b+=Math.floor(l/m.CHIP_SIZE),l=(l+m.CHIP_SIZE)%m.CHIP_SIZE);f>=m.CHIP_SIZE&&(e+=Math.floor(f/m.CHIP_SIZE),f=(f+m.CHIP_SIZE)%m.CHIP_SIZE);return new a(this._wwa,
b,e,l,f)};a.prototype.isJustPosition=function(){return 0==this._offsetCoord.x&&0==this._offsetCoord.y};a.prototype.isScreenTopPosition=function(){var a=this.getScreenTopPosition();return this.equals(a)};a.prototype.equals=function(a){return this._partsCoord.equals(a.getPartsCoord())&&this._offsetCoord.equals(a.getOffsetCoord())};a.prototype.isInCameraRange=function(a){a=a.getPosition()._partsCoord;var l=this._partsCoord.x,d=this._partsCoord.y;return a.x<=l&&l<a.x+m.H_PARTS_NUM_IN_WINDOW&&a.y<=d&&
d<a.y+m.V_PARTS_NUM_IN_WINDOW};a.prototype.hasLocalGate=function(){return this._wwa.getMapTypeByPosition(this)===m.MAP_LOCALGATE||this._wwa.getObjectTypeByPosition(this)===m.OBJECT_LOCALGATE};a.prototype.clone=function(){return new a(this._wwa,this._partsCoord.x,this._partsCoord.y,this._offsetCoord.x,this._offsetCoord.y)};return a}();c.Position=e;g=function(){return function(a,f,l){this.destPos=a.clone();this.srcPos=f.clone();this.srcSize=l.clone()}}();c.Face=g;(function(a){a[a.LEFT=0]="LEFT";a[a.RIGHT=
1]="RIGHT";a[a.DOWN=2]="DOWN";a[a.UP=3]="UP";a[a.LEFT_DOWN=4]="LEFT_DOWN";a[a.LEFT_UP=5]="LEFT_UP";a[a.RIGHT_DOWN=6]="RIGHT_DOWN";a[a.RIGHT_UP=7]="RIGHT_UP";a[a.NO_DIRECTION=8]="NO_DIRECTION"})(c.Direction||(c.Direction={}));var b=c.Direction;c.vx=[-1,1,0,0,-1,-1,1,1,0];c.vy=[0,0,1,-1,1,-1,1,-1,0];c.dirToPos=[4,6,2,0];c.dirToKey=[wwa_input.KeyCode.KEY_LEFT,wwa_input.KeyCode.KEY_RIGHT,wwa_input.KeyCode.KEY_DOWN,wwa_input.KeyCode.KEY_UP];(function(a){a[a.YES=0]="YES";a[a.NO=1]="NO";a[a.UNSELECTED=2]=
"UNSELECTED"})(c.YesNoState||(c.YesNoState={}));(function(a){a[a.MAP=0]="MAP";a[a.OBJECT=1]="OBJECT";a[a.CHOICE_YES=2]="CHOICE_YES";a[a.CHOICE_NO=3]="CHOICE_NO"})(c.AppearanceTriggerType||(c.AppearanceTriggerType={}));(function(a){a[a.NORMAL=0]="NORMAL";a[a.CAN_USE=1]="CAN_USE";a[a.NOT_DISAPPEAR=2]="NOT_DISAPPEAR"})(c.ItemMode||(c.ItemMode={}));(function(a){a[a.MAP=1]="MAP";a[a.OBJECT=0]="OBJECT"})(c.PartsType||(c.PartsType={}));(function(a){a[a.NONE=0]="NONE";a[a.CALL_BY_MAP_PARTS=1]="CALL_BY_MAP_PARTS";
a[a.CALL_BY_OBJECT_PARTS=2]="CALL_BY_OBJECT_PARTS";a[a.CALL_BY_ITEM_USE=3]="CALL_BY_ITEM_USE";a[a.CALL_BY_QUICK_SAVE=4]="CALL_BY_QUICK_SAVE";a[a.CALL_BY_QUICK_LOAD=5]="CALL_BY_QUICK_LOAD";a[a.CALL_BY_RESTART_GAME=6]="CALL_BY_RESTART_GAME";a[a.CALL_BY_GOTO_WWA=7]="CALL_BY_GOTO_WWA"})(c.ChoiceCallInfo||(c.ChoiceCallInfo={}));(function(a){a[a.QUICK_LOAD=0]="QUICK_LOAD";a[a.QUICK_SAVE=1]="QUICK_SAVE";a[a.RESTART_GAME=2]="RESTART_GAME";a[a.GOTO_WWA=3]="GOTO_WWA"})(c.SidebarButton||(c.SidebarButton={}));
(function(a){a[a.UP=0]="UP";a[a.DOWN=1]="DOWN"})(c.SpeedChange||(c.SpeedChange={}));(function(a){a[a.QUICK_LOAD=0]="QUICK_LOAD";a[a.RESTART_GAME=1]="RESTART_GAME"})(c.LoadType||(c.LoadType={}));(function(a){a[a.STATIC=0]="STATIC";a[a.CHASE_PLAYER=1]="CHASE_PLAYER";a[a.RUN_OUT=2]="RUN_OUT";a[a.HANG_AROUND=3]="HANG_AROUND"})(c.MoveType||(c.MoveType={}));(function(a){a[a.MODE_X=0]="MODE_X";a[a.MODE_Y=1]="MODE_Y";a[a.UNDECIDED=2]="UNDECIDED"})(c.SecondCandidateMoveType||(c.SecondCandidateMoveType={}));
c.sidebarButtonCellElementID=["cell-load","cell-save","cell-restart","cell-gotowwa"];(function(a){a[a.ASK_LINK=5]="ASK_LINK";a[a.NO_MONEY=6]="NO_MONEY";a[a.NO_ITEM=7]="NO_ITEM";a[a.USE_ITEM=8]="USE_ITEM"})(c.SystemMessage1||(c.SystemMessage1={}));(function(a){a[a.CLICKABLE_ITEM=0]="CLICKABLE_ITEM";a[a.FULL_ITEM=1]="FULL_ITEM";a[a.LOAD_SE=2]="LOAD_SE"})(c.SystemMessage2||(c.SystemMessage2={}));(function(a){a[a.UNDEFINED=0]="UNDEFINED";a[a.IMGPLAYER=1]="IMGPLAYER";a[a.IMGYESNO=2]="IMGYESNO";a[a.HPMAX=
3]="HPMAX";a[a.SAVE=4]="SAVE";a[a.ITEM=5]="ITEM";a[a.DEFAULT=6]="DEFAULT";a[a.OLDMAP=7]="OLDMAP";a[a.PARTS=8]="PARTS";a[a.MOVE=9]="MOVE";a[a.MAP=10]="MAP";a[a.DIRMAP=11]="DIRMAP";a[a.IMGFRAME=12]="IMGFRAME";a[a.IMGBOM=13]="IMGBOM";a[a.DELPLAYER=14]="DELPLAYER";a[a.FACE=15]="FACE";a[a.EFFECT=16]="EFFECT";a[a.GAMEOVER=17]="GAMEOVER";a[a.IMGCLICK=18]="IMGCLICK";a[a.STATUS=19]="STATUS";a[a.EFFITEM=20]="EFFITEM";a[a.COLOR=21]="COLOR";a[a.WAIT=22]="WAIT";a[a.SOUND=23]="SOUND"})(c.MacroType||(c.MacroType=
{}));c.macrotable={"":0,$imgplayer:1,$imgyesno:2,$hpmax:3,$save:4,$item:5,$default:6,$oldmap:7,$parts:8,$move:9,$map:10,$dirmap:11,$imgframe:12,$imgbom:13,$delplayer:14,$face:15,$effect:16,$gameover:17,$imgclick:18,$status:19,$effitem:20,$color:21,$wait:22,$sound:23};(function(a){a[a.ENERGY=0]="ENERGY";a[a.STRENGTH=1]="STRENGTH";a[a.DEFENCE=2]="DEFENCE";a[a.GOLD=3]="GOLD";a[a.MOVES=4]="MOVES"})(c.MacroStatusIndex||(c.MacroStatusIndex={}));(function(a){a[a.ENERGY=0]="ENERGY";a[a.STRENGTH=1]="STRENGTH";
a[a.DEFENCE=2]="DEFENCE";a[a.GOLD=3]="GOLD";a[a.WIDE_CELL_ROW=4]="WIDE_CELL_ROW";a[a.ITEM_BG=5]="ITEM_BG";a[a.MAIN_FRAME=6]="MAIN_FRAME"})(c.MacroImgFrameIndex||(c.MacroImgFrameIndex={}));(function(a){a[a.DECISION=1]="DECISION";a[a.ATTACK=3]="ATTACK";a[a.BGM_LB=70]="BGM_LB";a[a.NO_SOUND=99]="NO_SOUND"})(c.SystemSound||(c.SystemSound={}));c.speedList=[2,5,8,10];c.speedNameList=["\u4f4e\u901f","\u6e96\u4f4e\u901f","\u4e2d\u901f","\u9ad8\u901f"];var m=function(){function a(){}a.VERSION_WWAJS="W3.13c";
a.WWA_HOME="http://wwajp.com";a.ITEMBOX_SIZE=12;a.MAP_ATR_MAX=60;a.OBJ_ATR_MAX=60;a.OLD_MAP_ATR_MAX=40;a.OLD_OBJ_ATR_MAX=40;a.ATR_TYPE=3;a.ATR_MODE=4;a.ATR_STRING=5;a.ATR_X=6;a.ATR_Y=7;a.ATR_X2=8;a.ATR_Y2=9;a.ATR_ENERGY=10;a.ATR_STRENGTH=11;a.ATR_DEFENCE=12;a.ATR_GOLD=13;a.ATR_ITEM=14;a.ATR_NUMBER=15;a.ATR_JUMP_X=16;a.ATR_MOVE=16;a.ATR_JUMP_Y=17;a.ATR_SOUND=19;a.ATR_APPERANCE_BASE=20;a.REL_ATR_APPERANCE_ID=0;a.REL_ATR_APPERANCE_X=1;a.REL_ATR_APPERANCE_Y=2;a.REL_ATR_APPERANCE_TYPE=3;a.REL_ATR_APPERANCE_UNIT_LENGTH=
4;a.ATR_RANDOM_BASE=10;a.RANDOM_ATR_NUM=10;a.RANDOM_ITERATION_MAX=10;a.MAP_STREET=0;a.MAP_WALL=1;a.MAP_LOCALGATE=2;a.MAP_URLGATE=4;a.OBJECT_NORMAL=0;a.OBJECT_MESSAGE=1;a.OBJECT_URLGATE=2;a.OBJECT_STATUS=3;a.OBJECT_ITEM=4;a.OBJECT_DOOR=5;a.OBJECT_MONSTER=6;a.OBJECT_SCORE=11;a.OBJECT_SELL=14;a.OBJECT_BUY=15;a.OBJECT_RANDOM=16;a.OBJECT_SELECT=17;a.OBJECT_LOCALGATE=18;a.SYSTEM_MESSAGE_NUM=20;a.IMGPOS_DEFAULT_YESNO_X=3;a.IMGPOS_DEFAULT_YESNO_Y=1;a.IMGRELPOS_YESNO_YES_X=0;a.IMGRELPOS_YESNO_NO_X=1;a.IMGRELPOS_YESNO_YESP_X=
2;a.IMGRELPOS_YESNO_NOP_X=3;a.IMGPOS_DEFAULT_PLAYER_X=2;a.IMGPOS_DEFAULT_PLAYER_Y=0;a.IMGPOS_DEFAULT_CLICKABLE_ITEM_SIGN_X=0;a.IMGPOS_DEFAULT_CLICKABLE_ITEM_SIGN_Y=0;a.IMGPOS_DEFAULT_FRAME_X=0;a.IMGPOS_DEFAULT_FRAME_Y=1;a.IMGPOS_DEFAULT_BATTLE_EFFECT_X=3;a.IMGPOS_DEFAULT_BATTLE_EFFECT_Y=3;a.DEFAULT_DISABLE_SAVE=!1;a.DEFAULT_OLDMAP=!1;a.DEFAULT_OBJECT_NO_COLLAPSE=!1;a.SPLASH_SCREEN_DISP_MILLS=100;a.DEFAULT_FRAME_INTERVAL=20;a.GAMEOVER_FRAME_INTERVAL=50;a.YESNO_PRESS_DISP_FRAME_NUM=20;a.CHIP_SIZE=40;
a.MAP_WINDOW_WIDTH=440;a.MAP_WINDOW_HEIGHT=440;a.H_PARTS_NUM_IN_WINDOW=a.MAP_WINDOW_WIDTH/a.CHIP_SIZE;a.V_PARTS_NUM_IN_WINDOW=a.MAP_WINDOW_HEIGHT/a.CHIP_SIZE;a.DEFAULT_SPEED_INDEX=2;a.MIN_SPEED_INDEX=0;a.MAX_SPEED_INDEX=c.speedList.length-1;a.ANIMATION_REP_HALF_FRAME=22;a.PLAYER_LOOKING_AROUND_START_FRAME=4*a.ANIMATION_REP_HALF_FRAME;a.RELATIVE_COORD_BIAS=1E4;a.RELATIVE_COORD_LOWER=a.RELATIVE_COORD_BIAS-1E3;a.PLAYER_COORD=a.RELATIVE_COORD_BIAS-1E3;a.LOCALGATE_PLAYER_WAIT_FRAME=5;a.STATUS_CHANGED_EFFECT_FRAME_NUM=
20;a.PASSABLE_OBJECT=1;a.APPERANCE_PARTS_MIN_INDEX=0;a.APPERANCE_PARTS_MAX_INDEX=9;a.APPERANCE_PARTS_MIN_INDEX_NO=5;a.APPERANCE_PARTS_MAX_INDEX_YES=4;a.FADEOUT_SPEED=8;a.STATUS_MINUS_BORDER=3E4;a.ITEMBOX_IS_FULL=-1;a.BATTLE_INTERVAL_FRAME_NUM=10;a.BATTLE_SPEED_CHANGE_TURN_NUM=40;a.RANDOM_MOVE_ITERATION_NUM=50;a.BATTLE_ESTIMATE_MONSTER_TYPE_MAX=8;a.SOUND_MAX=100;a.ITEM_BORDER_IMG_DATA_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAArklEQVRYR+2Y0QqAIAxFt///aENJHwxxuJUSxzeh3S7HXaNpEkly4FIRzba0GEyHeVTN7jqDWvb7V4Y1NLibZIY0NbiL5G3MZLCe / 1fn3XJgJYjB7mgg6O1VCEKwXo79JeklY62nB62kRs9BEIKkeNIDhISQEBJC4k0BBCF4D7D4cV9shf99ixdB + MrM0y3fa3zV05D45GOqhwPMGPkYlccIOEY2VKUN0UNVXxC7ADj7mDi9aFZZAAAAAElFTkSuQmCC";
a.LOAD_STAGE_MAX_EXCEPT_AUDIO=7;a.WWA_STYLE_TAG_ID="wwa-additional-style";a.DEFAULT_FRAME_COLOR_R=255;a.DEFAULT_FRAME_COLOR_G=255;a.DEFAULT_FRAME_COLOR_B=255;a.DEFAULT_FRAMEOUT_COLOR_R=96;a.DEFAULT_FRAMEOUT_COLOR_G=96;a.DEFAULT_FRAMEOUT_COLOR_B=96;a.DEFAULT_STRBACK_COLOR_R=0;a.DEFAULT_STRBACK_COLOR_G=0;a.DEFAULT_STRBACK_COLOR_B=0;a.DEFAULT_STATUS_COLOR_R=0;a.DEFAULT_STATUS_COLOR_G=0;a.DEFAULT_STATUS_COLOR_B=0;a.KEYPRESS_MESSAGE_CHANGE_FRAME_NUM=20;a.WWAP_SERVER="http://wwawing.com/wwap";a.WWAP_SERVER_AUDIO_DIR=
"audio";a.WWAP_SERVER_TITLE_IMG="cover_p.gif";a.WWAP_SERVER_LOADER_NO_WORKER="wwaload.noworker.js";return a}();c.WWAConsts=m;g=function(){return function(){}}();c.LoaderResponse=g;g=function(){return function(){}}();c.LoaderError=g;g=function(){return function(){}}();c.LoaderProgress=g;(function(a){a[a.INIT=0]="INIT";a[a.MAP_LOAD=1]="MAP_LOAD";a[a.OBJ_LOAD=2]="OBJ_LOAD";a[a.MAP_ATTR=3]="MAP_ATTR";a[a.OBJ_ATTR=4]="OBJ_ATTR";a[a.RAND_PARTS=5]="RAND_PARTS";a[a.MESSAGE=6]="MESSAGE";a[a.GAME_INIT=7]="GAME_INIT";
a[a.AUDIO=8]="AUDIO"})(c.LoadStage||(c.LoadStage={}));c.loadMessages="\u30ed\u30fc\u30c9\u306e\u6e96\u5099\u3092\u3057\u3066\u3044\u307e\u3059\u3002;\u80cc\u666f\u30d1\u30fc\u30c4\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002;\u7269\u4f53\u30d1\u30fc\u30c4\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;\u80cc\u666f\u30d1\u30fc\u30c4\u306e\u5c5e\u6027\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;\u7269\u4f53\u30d1\u30fc\u30c4\u306e\u5c5e\u6027\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;\u30e9\u30f3\u30c0\u30e0\u30d1\u30fc\u30c4\u3092\u7f6e\u63db\u3057\u3066\u3044\u307e\u3059\u3002;\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;Welcome to WWA Wing!".split(";");
(function(a){a[a.COLOR_FRAME=0]="COLOR_FRAME";a[a.COLOR_FRAMEOUT=1]="COLOR_FRAMEOUT";a[a.COLOR_STR=2]="COLOR_STR";a[a.COLOR_STATUS_STR=4]="COLOR_STATUS_STR"})(c.ChangeStyleType||(c.ChangeStyleType={}));(function(a){a[a.MESSAGE_WINDOW=0]="MESSAGE_WINDOW";a[a.SIDEBAR=1]="SIDEBAR"})(c.SelectorType||(c.SelectorType={}));g=function(){return function(){this.statusColorB=this.statusColorG=this.statusColorR=this.fontColorB=this.fontColorG=this.fontColorR=this.frameOutColorB=this.frameOutColorG=this.frameOutColorR=
this.frameColorB=this.frameColorG=this.frameColorR=this.imgClickY=this.imgClickX=this.bgm=this.delPlayerFlag=this.objectNoCollapseDefaultFlag=this.compatibleForOldMapFlag=this.disableSaveFlag=this.clickableItemSignImgPosY=this.clickableItemSignImgPosX=this.playerImgPosY=this.playerImgPosX=this.yesnoImgPosY=this.yesnoImgPosX=this.moves=this.systemMessage=this.mapCGName=this.charCGName=this.worldPassNumber=this.worldName=this.message=this.worldPassword=this.objectAttribute=this.mapAttribute=this.mapObject=
this.map=this.messageNum=this.mapWidth=this.itemBox=this.statusGold=this.statusDefence=this.statusStrength=this.statusEnergy=this.statusEnergyMax=this.isOldMap=this.objPartsMax=this.mapPartsMax=this.playerY=this.playerX=this.gameoverY=this.gameoverX=this.version=void 0}}();c.WWAData=g})(wwa_data||(wwa_data={}));var wwa_parts_player;
(function(c){var g=wwa_data.Direction,k=wwa_data.WWAConsts,e=function(){function a(a){this._position=a}a.prototype.getPosition=function(){return this._position};return a}(),b=function(a){function f(l){a.call(this,l)}__extends(f,a);return f}(e);c.PartsObject=b;e=function(a){function f(l){a.call(this,l)}__extends(f,a);return f}(e);c.PartsMap=e;var m;(function(a){a[a.CONTROLLABLE=0]="CONTROLLABLE";a[a.MOVING=1]="MOVING";a[a.CAMERA_MOVING=2]="CAMERA_MOVING";a[a.MESSAGE_WAITING=3]="MESSAGE_WAITING";a[a.LOCALGATE_JUMPED=
4]="LOCALGATE_JUMPED";a[a.BATTLE=5]="BATTLE";a[a.ESTIMATE_WINDOW_WAITING=6]="ESTIMATE_WINDOW_WAITING"})(m||(m={}));b=function(a){function f(l,d,f,b,e){this._status=b;this._equipStatus=new wwa_data.EquipmentStatus(0,0);this._itemBox=Array(k.ITEMBOX_SIZE);this._itemBoxElement=Array(k.ITEMBOX_SIZE);this._itemUsingEvent=Array(k.ITEMBOX_SIZE);for(b=0;b<this._itemBox.length;b++)this._itemBox[b]=0,this._itemBoxElement[b]=wwa_util.$qsh("#item"+b+">.item-disp");this.updateItemBox();this._energyMax=e;this._dir=
g.DOWN;this._wwa=l;this._state=m.CONTROLLABLE;this._camera=f;this._isPartsEventExecuted=!1;this._energyValueElement=wwa_util.$qsh("#disp-energy>.status-value-box");this._strengthValueElement=wwa_util.$qsh("#disp-strength>.status-value-box");this._defenceValueElement=wwa_util.$qsh("#disp-defence>.status-value-box");this._goldValueElement=wwa_util.$qsh("#disp-gold>.status-value-box");this._isClickableItemGot=this._isReadyToUseItem=!1;this._moveObjectAutoExecTimer=this._moveMacroWaitingRemainMoves=this._moves=
0;this.updateStatusValueBox();this._afterMoveMacroFlag=this._partsAppeared=!1;this._isPreparedForLookingAround=!0;this._lookingAroundTimer=k.PLAYER_LOOKING_AROUND_START_FRAME;this._speedIndex=k.DEFAULT_SPEED_INDEX;a.call(this,d)}__extends(f,a);f.prototype.move=function(){if(this.isControllable())this.controll(this._dir);else if(this._state===m.CAMERA_MOVING){try{this._camera.move(this._dir)}catch(a){}this._isOnCameraStopPosition()&&(this._state=m.CONTROLLABLE)}else if(this._state===m.MOVING){try{var d=
this._position.getNextFramePosition(this._dir,wwa_data.speedList[this._speedIndex],wwa_data.speedList[this._speedIndex])}catch(f){}d.isJustPosition()&&(this._state=m.CONTROLLABLE,this._moves++,this._isPartsEventExecuted=!1,this._samePosLastExecutedObjID=this._samePosLastExecutedMapID=void 0);this._position=d}};f.prototype.controll=function(a){var d,f;if(this.isControllable()){this._isPreparedForLookingAround=!1;this._dir=a;try{d=this._position.getNextFramePosition(this._dir,wwa_data.speedList[this._speedIndex],
wwa_data.speedList[this._speedIndex]),f=this._position.getNextJustPosition(a)}catch(b){return}if(this._isOnCameraMovingPosition()){if(0!==this._wwa.getMapIdByPosition(f)||this._wwa.isOldMap()||this._wwa.debug)try{this._camera.move(this._dir),this._state=m.CAMERA_MOVING}catch(e){this._state=m.CONTROLLABLE}}else this.canMoveTo(f)?(this._position=d,this._state=m.MOVING,this._wwa.getMapAttributeByPosition(this._position.getNextJustPosition(a),k.ATR_TYPE)!==k.MAP_LOCALGATE&&this._wwa.moveObjects(!0)):
(this._wwa.getMapTypeByPosition(f)===k.MAP_WALL&&this._wwa.checkMap(f.getPartsCoord()),this._wwa.checkObject(f.getPartsCoord()))}};f.prototype.canMoveTo=function(a){if(null===a)return!1;if(this._wwa.debug)return!0;this._wwa.getMapWidth();a.getPartsCoord();a.getOffsetCoord();return 0===this._wwa.getMapIdByPosition(a)&&!this._wwa.isOldMap()||this._wwa.getMapTypeByPosition(a)===k.MAP_WALL?!1:0===this._wwa.getObjectIdByPosition(a)||this._wwa.getObjectTypeByPosition(a)===k.OBJECT_NORMAL&&this._wwa.getObjectAttributeByPosition(a,
k.ATR_MODE)===k.PASSABLE_OBJECT?!0:this._wwa.getObjectTypeByPosition(a)===k.OBJECT_DOOR&&this._wwa.getObjectAttributeByPosition(a,k.ATR_NUMBER)===k.PASSABLE_OBJECT?this.hasItem(this._wwa.getObjectAttributeByPosition(a,k.ATR_ITEM))?!1:!0:!1};f.prototype.isMoving=function(){return this._state==m.MOVING||this._state==m.CAMERA_MOVING};f.prototype._isOnCameraMovingPosition=function(){var a=this._camera.getPosition().getPartsCoord(),d=this.getPosition().getPartsCoord();return d.x-a.x===k.H_PARTS_NUM_IN_WINDOW-
1&&this._dir===g.RIGHT||d.x===a.x&&this._dir===g.LEFT||d.y-a.y===k.V_PARTS_NUM_IN_WINDOW-1&&this._dir===g.DOWN||d.y===a.y&&this._dir===g.UP};f.prototype._isOnCameraStopPosition=function(){var a=this._camera.getPosition().getPartsCoord(),d=this.getPosition().getPartsCoord();return d.x-a.x===k.H_PARTS_NUM_IN_WINDOW-1&&this._dir===g.LEFT||d.x===a.x&&this._dir===g.RIGHT||d.y-a.y===k.V_PARTS_NUM_IN_WINDOW-1&&this._dir===g.UP||d.y===a.y&&this._dir===g.DOWN};f.prototype.isControllable=function(){var a=this._afterMoveMacroFlag;
this._afterMoveMacroFlag=!1;return this._state===m.CONTROLLABLE&&!this._partsAppeared&&(this._wwa.getMapTypeByPosition(this._position)!==k.MAP_LOCALGATE&&this._wwa.getMapTypeByPosition(this._position)!==k.MAP_URLGATE||!this._wwa.isPrevFrameEventExecuted())&&0===this._moveMacroWaitingRemainMoves&&0===this._moveObjectAutoExecTimer&&!a&&this._wwa.canInput()};f.prototype.getCopyOfItemBox=function(){return this._itemBox.slice()};f.prototype.getDir=function(){return this._dir};f.prototype.getEnergyMax=
function(){return this._energyMax};f.prototype.isJumped=function(){return this._state===m.LOCALGATE_JUMPED};f.prototype.setMessageWaiting=function(){this._state=m.MESSAGE_WAITING};f.prototype.isWaitingMessage=function(){return this._state===m.MESSAGE_WAITING};f.prototype.clearMessageWaiting=function(){this._state===m.MESSAGE_WAITING&&(this._state=m.CONTROLLABLE,this._isPartsEventExecuted=!0,this._isPreparedForLookingAround&&(this._lookingAroundTimer=k.PLAYER_LOOKING_AROUND_START_FRAME))};f.prototype.setEstimateWindowWating=
function(){this._state=m.ESTIMATE_WINDOW_WAITING};f.prototype.isWatingEstimateWindow=function(){return this._state===m.ESTIMATE_WINDOW_WAITING};f.prototype.clearEstimateWindowWaiting=function(){this._state===m.ESTIMATE_WINDOW_WAITING&&(this._state=m.CONTROLLABLE)};f.prototype.isPartsEventExecuted=function(){return this._isPartsEventExecuted};f.prototype.resetEventExecutionInfo=function(){this._isPartsEventExecuted=!1};f.prototype.getLastExecPartsIDOnSamePosition=function(a){return a===wwa_data.PartsType.MAP?
this._samePosLastExecutedMapID:this._samePosLastExecutedObjID};f.prototype.setLastExecInfoOnSamePosition=function(a,d){a===wwa_data.PartsType.MAP?this._samePosLastExecutedMapID=d:this._samePosLastExecutedObjID=d};f.prototype.processAfterJump=function(){this._state===m.LOCALGATE_JUMPED&&0===--this._jumpWaitFramesRemain&&(this._state=m.CONTROLLABLE)};f.prototype.jumpTo=function(a){var d=this._camera.getPosition();this.getPosition();if(this._position.equals(a))return!1;this._position=a;a.isInCameraRange(this._camera)||
this._camera.reset(a);this._state=m.LOCALGATE_JUMPED;this._jumpWaitFramesRemain=k.LOCALGATE_PLAYER_WAIT_FRAME;this._samePosLastExecutedObjID=this._samePosLastExecutedMapID=void 0;a.hasLocalGate()?this._dir=g.DOWN:a.getPartsCoord().y<=this._wwa.getMapWidth()-2&&a.getNextJustPosition(g.DOWN).hasLocalGate()?this._dir=g.UP:1<=a.getPartsCoord().y&&a.getNextJustPosition(g.UP).hasLocalGate()?this._dir=g.DOWN:a.getPartsCoord().x<=this._wwa.getMapWidth()-2&&a.getNextJustPosition(g.RIGHT).hasLocalGate()?this._dir=
g.LEFT:1<=a.getPartsCoord().x&&a.getNextJustPosition(g.LEFT).hasLocalGate()?this._dir=g.RIGHT:this._dir=g.DOWN;this._camera.getPosition().equals(d)||(this._isPreparedForLookingAround=!0,this._lookingAroundTimer=k.PLAYER_LOOKING_AROUND_START_FRAME);return!0};f.prototype.systemJumpTo=function(a){this._position=a;this._camera.reset(a);this._camera.resetPreviousPosition();this._state=m.LOCALGATE_JUMPED;this._jumpWaitFramesRemain=k.LOCALGATE_PLAYER_WAIT_FRAME;this._samePosLastExecutedObjID=this._samePosLastExecutedMapID=
void 0;this._dir=g.DOWN;this._isPreparedForLookingAround=!0;this._lookingAroundTimer=k.PLAYER_LOOKING_AROUND_START_FRAME};f.prototype.addStatusAll=function(a){this._status.add(a);this.isDead()&&(this._status.energy=0);0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox();return this._status};f.prototype.setEnergyMax=function(a){this._energyMax=a;0!==a&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox();
return a};f.prototype.setEnergy=function(a){this._status.energy=a;this.isDead()&&(this._status.energy=0);0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox();return a};f.prototype.damage=function(a){this._status.energy=Math.max(0,this._status.energy-a);this.isDead()&&(this._status.energy=0);0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox()};f.prototype.setStrength=function(a){return this._status.strength=
a};f.prototype.setDefence=function(a){this._status.defence=a;this.updateStatusValueBox();return a};f.prototype.setGold=function(a){this._status.gold=a;this.updateStatusValueBox();return a};f.prototype.getStatus=function(){return this._status.plus(this._equipStatus)};f.prototype.getStatusWithoutEquipments=function(){return this._status.plus(new wwa_data.EquipmentStatus(0,0))};f.prototype.updateStatusValueBox=function(){var a=this._status.plus(this._equipStatus),d=a.strength,f=a.defence,b=a.gold;this._energyValueElement.textContent=
a.energy+"";this._strengthValueElement.textContent=d+"";this._defenceValueElement.textContent=f+"";this._goldValueElement.textContent=b+""};f.prototype.updateItemBox=function(){for(var a,d,f=0;f<this._itemBoxElement.length;f++)0===this._itemBox[f]?this._itemBoxElement[f].style.backgroundPosition="-40px 0px":(a=this._wwa.getObjectCropXById(this._itemBox[f]),d=this._wwa.getObjectCropYById(this._itemBox[f]),this._itemBoxElement[f].style.backgroundPosition="-"+a+"px -"+d+"px")};f.prototype.isDead=function(){return 0>=
this._status.energy};f.prototype.addItem=function(a,d,f){void 0===d&&(d=0);void 0===f&&(f=!1);var b;b=this._wwa.getObjectAttributeById(a,k.ATR_NUMBER);0===d&&0!==b&&(d=b);if(0===d){if(0===a)return;d=this._getBlankItemPos();if(d===k.ITEMBOX_IS_FULL)throw Error("\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002");this._forceSetItemBox(d,a)}else if(!1===f)if(b=this._itemBox[d-1],this._wwa.getObjectAttributeById(b,k.ATR_NUMBER)!==this._wwa.getObjectAttributeById(a,
k.ATR_NUMBER))if(f=this._getBlankItemPos(),f!==k.ITEMBOX_IS_FULL)this._forceSetItemBox(f,b),this._forceSetItemBox(d,a);else throw Error("\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002");else this._forceSetItemBox(d,a);else this._forceSetItemBox(d,a);this._updateEquipmentStatus();this.updateItemBox()};f.prototype._forceSetItemBox=function(a,d){var f=this,b=wwa_util.$qsh("#item"+(a-1)+">.item-click-border"),e=this._wwa.getObjectAttributeById(d,k.ATR_MODE);
this.removeItemByItemPosition(a);this._itemBox[a-1]=d;0!==d&&e!==wwa_data.ItemMode.NORMAL&&(e=this._wwa.getSystemMessageById(wwa_data.SystemMessage2.CLICKABLE_ITEM),this._isClickableItemGot||("BLANK"!==e&&this._wwa.setMessageQueue(""===e?"\u3053\u306e\u30a2\u30a4\u30c6\u30e0\u306f\u53f3\u306e\u30dc\u30c3\u30af\u30b9\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3053\u3068\u3067\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002\n\u4f7f\u7528\u3067\u304d\u308b\u30a2\u30a4\u30c6\u30e0\u306f\u8272\u67a0\u3067\u56f2\u307e\u308c\u307e\u3059\u3002":
e,!1,!0),this._isClickableItemGot=!0),b.style.display="block",function(a){f._itemUsingEvent[a-1]=function(){if(f.isControllable())f._wwa.onselectitem(a)}}(a),b.addEventListener("click",this._itemUsingEvent[a-1]))};f.prototype._getBlankItemPos=function(){var a;for(a=1;a<this._itemBox.length+1;a++)if(0===this._itemBox[a-1])return a;return k.ITEMBOX_IS_FULL};f.prototype._updateEquipmentStatus=function(){var a,d=new wwa_data.EquipmentStatus(0,0);for(a=0;a<k.ITEMBOX_SIZE;a++)0!==this._itemBox[a]&&(d.strength+=
this._wwa.getObjectAttributeById(this._itemBox[a],k.ATR_STRENGTH),d.defence+=this._wwa.getObjectAttributeById(this._itemBox[a],k.ATR_DEFENCE));a=d.minus(this._equipStatus);this._wwa.setStatusChangedEffect(a);this._equipStatus=d;this.updateStatusValueBox()};f.prototype.hasItem=function(a){for(var d=0;d<k.ITEMBOX_SIZE;d++)if(this._itemBox[d]===a)return!0;return!1};f.prototype.canUseItem=function(a){a=this._itemBox[a-1];return 0===a||this._wwa.getObjectAttributeById(a,k.ATR_MODE)===wwa_data.ItemMode.NORMAL?
!1:!0};f.prototype.useItem=function(){var a;a=this._itemBox[this._readyToUseItemPos-1];this._wwa.getObjectAttributeById(a,k.ATR_MODE)!==wwa_data.ItemMode.NOT_DISAPPEAR&&this.removeItemByItemPosition(this._readyToUseItemPos);var d=wwa_util.$id("item"+(this._readyToUseItemPos-1));setTimeout(function(){d.classList.contains("onpress")&&d.classList.remove("onpress")},k.DEFAULT_FRAME_INTERVAL);this._isReadyToUseItem=!1;this._readyToUseItemPos=void 0;return a};f.prototype.canHaveMoreItems=function(){return this._getBlankItemPos()!==
k.ITEMBOX_IS_FULL};f.prototype.removeItemByItemPosition=function(a){var d;0!==this._itemBox[a-1]&&(this._wwa.getObjectAttributeById(this._itemBox[a-1],k.ATR_MODE)!==wwa_data.ItemMode.NORMAL&&(d=wwa_util.$qsh("#item"+(a-1)+">.item-click-border"),d.removeEventListener("click",this._itemUsingEvent[a-1]),d.style.display="none"),this._itemBox[a-1]=0,this._updateEquipmentStatus(),this.updateItemBox())};f.prototype.removeItemByPartsID=function(a){if(!this.hasItem(a))throw Error("\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3063\u3066\u3044\u306a\u3044");
for(var d=0;d<k.ITEMBOX_SIZE;d++)if(this._itemBox[d]===a){this._wwa.getObjectAttributeById(this._itemBox[d],k.ATR_MODE)!==wwa_data.ItemMode.NORMAL&&(a=wwa_util.$qsh("#item"+d+">.item-click-border"),a.removeEventListener("click",this._itemUsingEvent[d]),a.style.display="none");this._itemBox[d]=0;this._updateEquipmentStatus();this.updateItemBox();break}};f.prototype.clearItemBox=function(){for(var a=1;a<=k.ITEMBOX_SIZE;a++)this.removeItemByItemPosition(a);this._updateEquipmentStatus();this.updateItemBox()};
f.prototype.hasGold=function(a){return this._status.gold>=a};f.prototype.payGold=function(a){if(!this.hasGold(a))throw Error("\u304a\u91d1\u304c\u8db3\u308a\u306a\u3044");this.setGold(this._status.gold-a)};f.prototype.earnGold=function(a){this.setGold(this._status.gold+a)};f.prototype.setPartsAppearedFlag=function(){this._partsAppeared=!0};f.prototype.clearPartsAppearedFlag=function(){this._partsAppeared=!1};f.prototype.isPartsAppearedTime=function(){return!0===this._partsAppeared};f.prototype.startBattleWith=
function(a){this._isPlayerTurn=!0;this._battleFrameCounter=k.BATTLE_INTERVAL_FRAME_NUM;this._battleTurnNum=0;this._enemy=a;this._state=m.BATTLE};f.prototype.isFighting=function(){return this._state===m.BATTLE};f.prototype.isTurn=function(){return this._isPlayerTurn};f.prototype.getTurnNum=function(){return this._battleTurnNum};f.prototype.isBattleStartFrame=function(){return this._battleFrameCounter===k.BATTLE_INTERVAL_FRAME_NUM&&0===this._battleTurnNum};f.prototype.fight=function(){if(!this.isFighting())throw Error("\u30d0\u30c8\u30eb\u304c\u958b\u59cb\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002");
0===this._battleTurnNum&&this._battleFrameCounter===k.BATTLE_INTERVAL_FRAME_NUM&&this._wwa.showMonsterWindow();if(!(0<--this._battleFrameCounter)){this._battleTurnNum++;this._speedIndex===k.MAX_SPEED_INDEX||this._battleTurnNum>k.BATTLE_SPEED_CHANGE_TURN_NUM?(1===this._battleTurnNum&&this._wwa.playSound(wwa_data.SystemSound.ATTACK),this._battleFrameCounter=1):(this._battleFrameCounter=k.BATTLE_INTERVAL_FRAME_NUM,this._wwa.playSound(wwa_data.SystemSound.ATTACK));var a=this.getStatus(),d=this._enemy.status;
if(this._isPlayerTurn){if(a.strength>d.defence||a.defence<d.strength){d.energy>a.strength-d.defence?a.strength>d.defence&&this._enemy.damage(a.strength-d.defence):(this._wwa.playSound(this._wwa.getObjectAttributeById(this._enemy.partsID,k.ATR_SOUND)),this.earnGold(d.gold),this._wwa.setStatusChangedEffect(new wwa_data.Status(0,0,0,d.gold)),0!==this._enemy.item?this._wwa.setPartsOnPosition(wwa_data.PartsType.OBJECT,this._enemy.item,this._enemy.position):this._wwa.setPartsOnPosition(wwa_data.PartsType.OBJECT,
0,this._enemy.position),this._wwa.appearParts(this._enemy.position,wwa_data.AppearanceTriggerType.OBJECT,this._enemy.partsID),this._state=m.CONTROLLABLE,this._wwa.setMessageQueue(this._enemy.message,!1,!1),this._enemy.battleEndProcess(),this._battleTurnNum=0,this._enemy=null);this._isPlayerTurn=!1;return}this._enemy.battleEndProcess();this._wwa.setMessageQueue("\u76f8\u624b\u306e\u9632\u5fa1\u80fd\u529b\u304c\u9ad8\u3059\u304e\u308b\uff01",!1,!0);this._battleTurnNum=0;this._enemy=null}else d.strength>
a.defence&&(a.energy>d.strength-a.defence?this.damage(d.strength-a.defence):(this.setEnergy(0),this._enemy.battleEndProcess(),this._state=m.CONTROLLABLE,this._battleTurnNum=0,this._enemy=null,this._wwa.gameover()));this._isPlayerTurn=!0}};f.prototype.readyToUseItem=function(a){var d;if(!this.canUseItem(a))throw Error("\u30a2\u30a4\u30c6\u30e0\u304c\u306a\u3044\u304b\u3001\u30a2\u30a4\u30c6\u30e0\u304c\u4f7f\u3048\u307e\u305b\u3093\u3002");d=this._itemBox[a-1];this._wwa.getObjectAttributeById(d,k.ATR_STRING);
this._wwa.appearParts(this._position.getPartsCoord(),wwa_data.AppearanceTriggerType.OBJECT,d);this._readyToUseItemPos=a;this._isReadyToUseItem=!0};f.prototype.isReadyToUseItem=function(){return this._isReadyToUseItem};f.prototype.getDrawingCenterPosition=function(){var a=this._position.getPartsCoord(),d=this._position.getOffsetCoord(),f=this._camera.getPosition(),b=f.getPartsCoord(),f=f.getOffsetCoord();return new wwa_data.Coord((a.x-b.x)*k.CHIP_SIZE+d.x-f.x+k.CHIP_SIZE/2,(a.y-b.y)*k.CHIP_SIZE+d.y-
f.y+k.CHIP_SIZE/2)};f.prototype.getMoveCount=function(){return this._moves};f.prototype.setMoveCount=function(a){return this._moves=a};f.prototype.isMoveObjectAutoExecTime=function(){return 0===this._moveObjectAutoExecTimer};f.prototype.setMoveMacroWaiting=function(a){0>a||(this._moveMacroWaitingRemainMoves=a,this._moveObjectAutoExecTimer=0)};f.prototype.resetMoveObjectAutoExecTimer=function(){this._moveObjectAutoExecTimer=k.CHIP_SIZE/wwa_data.speedList[this._speedIndex];this._moveMacroWaitingRemainMoves--};
f.prototype.decrementMoveObjectAutoExecTimer=function(){0<=this._moveMacroWaitingRemainMoves&&0<this._moveObjectAutoExecTimer&&(this._moveObjectAutoExecTimer--,0===this._moveMacroWaitingRemainMoves&&0===this._moveObjectAutoExecTimer&&(this._afterMoveMacroFlag=!0));return 0};f.prototype.isWaitingMoveMacro=function(){return 0!==this._moveMacroWaitingRemainMoves||0!==this._moveObjectAutoExecTimer};f.prototype.decrementLookingAroundTimer=function(){return this._isPreparedForLookingAround&&0<this._lookingAroundTimer?
--this._lookingAroundTimer:0};f.prototype.isLookingAround=function(){return this._isPreparedForLookingAround&&0===this._lookingAroundTimer};f.prototype.getSpeedIndex=function(){return this._speedIndex};f.prototype.speedUp=function(){return this._speedIndex=Math.min(k.MAX_SPEED_INDEX,this._speedIndex+1)};f.prototype.speedDown=function(){return this._speedIndex=Math.max(k.MIN_SPEED_INDEX,this._speedIndex-1)};return f}(b);c.Player=b})(wwa_parts_player||(wwa_parts_player={}));var wwa_camera;
(function(c){var g=wwa_data.WWAConsts,k=function(){function e(b){this._position=null;this.reset(b)}e.prototype.setPlayer=function(b){this._player=b};e.prototype.isResetting=function(){return this._isResetting};e.prototype.getPosition=function(){return this._position};e.prototype.getPreviousPosition=function(){return this._positionPrev};e.prototype.resetPreviousPosition=function(){this._positionPrev=null};e.prototype.move=function(b){var e=wwa_data.speedList[this._player.getSpeedIndex()];this._position=
this._position.getNextFramePosition(b,e*(g.H_PARTS_NUM_IN_WINDOW-1),e*(g.V_PARTS_NUM_IN_WINDOW-1))};e.prototype.getTransitionStepNum=function(){return this._transitionStep};e.prototype.advanceTransitionStepNum=function(){++this._transitionStep;this._transitionStep===wwa_data.WWAConsts.V_PARTS_NUM_IN_WINDOW&&(this._isResetting=!1,this._transitionStep=0);return this._transitionStep};e.prototype.isFinalStep=function(){if(!1===this._isResetting)throw Error("\u30ea\u30bb\u30c3\u30c8\u4e2d\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002");
return this._transitionStep===wwa_data.WWAConsts.V_PARTS_NUM_IN_WINDOW-1};e.prototype.reset=function(b){this._positionPrev=this._position;this._position=b.getScreenTopPosition();this._transitionStep=0;this._isResetting=!0};return e}();c.Camera=k})(wwa_camera||(wwa_camera={}));var wwa_cgmanager;
(function(c){var g=wwa_data.WWAConsts,k=function(){function e(b,e,a,f){this._isLoaded=!1;this._ctx=b;this._ctxSub=e;this._fileName=a;this._loadCompleteCallBack=f;this._load()}e.prototype._load=function(){var b=this;this._isLoaded||(this._image=new Image,this._image.addEventListener("load",function(){b._loadCompleteCallBack()}),this._image.addEventListener("error",function(){throw Error("Image Load Failed!!\nfile name:"+b._fileName);}),this._image.src=this._fileName,this._isLoaded=!0)};e.prototype.drawCanvas=
function(b,e,a,f,l){void 0===l&&(l=!1);l=l?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");l.drawImage(this._image,g.CHIP_SIZE*b,g.CHIP_SIZE*e,g.CHIP_SIZE,g.CHIP_SIZE,a,f,g.CHIP_SIZE,g.CHIP_SIZE)};e.prototype.drawCanvasWithSize=function(b,e,a,f,l,d,c){void 0===c&&(c=!1);c=c?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");c.drawImage(this._image,g.CHIP_SIZE*b,g.CHIP_SIZE*e,g.CHIP_SIZE*a,g.CHIP_SIZE*f,l,d,2*g.CHIP_SIZE,2*g.CHIP_SIZE)};e.prototype.drawCanvasWithUpperYLimit=
function(b,e,a,f,l,d){void 0===d&&(d=!1);d=d?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");l=Math.max(0,f+g.CHIP_SIZE-l);l>=g.CHIP_SIZE||d.drawImage(this._image,g.CHIP_SIZE*b,g.CHIP_SIZE*e,g.CHIP_SIZE,g.CHIP_SIZE-l,a,f,g.CHIP_SIZE,g.CHIP_SIZE)};e.prototype.drawCanvasWithLowerYLimit=function(b,e,a,f,l,d){void 0===d&&(d=!1);d=d?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");l=Math.max(0,l-f);l>=g.CHIP_SIZE||d.drawImage(this._image,g.CHIP_SIZE*
b,g.CHIP_SIZE*e+l,g.CHIP_SIZE,g.CHIP_SIZE-l,a,f+l,g.CHIP_SIZE,g.CHIP_SIZE)};e.prototype.clearCanvas=function(b,e,a,f,l){void 0===l&&(l=!1);(l?this._ctxSub:this._ctx).clearRect(b,e,a,f)};e.prototype.drawBase=function(b,e,a,f,l){void 0===l&&(l=!1);l=l?this._ctxSub:this._ctx;l.fillStyle="#9E9E9E";l.fillRect(b,e,a,f)};return e}();c.CGManager=k})(wwa_cgmanager||(wwa_cgmanager={}));var wwa_util;
(function(c){c.$id=function(c){return document.getElementById(c)};c.$class=function(c){return document.getElementsByClassName(c)};c.$tag=function(c){return document.getElementsByTagName(c)};c.$qs=function(c){return document.querySelector(c)};c.$qsh=function(c){return document.querySelector(c)};c.$qsAll=function(c){return document.querySelectorAll(c)};c.$localPos=function(g,k){var e,b;e=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft;b=window.pageYOffset||document.body.scrollTop||
document.documentElement.scrollTop;e=g-c.$id("wwa-wrapper").offsetLeft+e;b=k-c.$id("wwa-wrapper").offsetTop+b;return new wwa_data.Coord(e,b)};c.$escapedURI=function(c){return c.match(/^https?:\/\//)||c.match(/^\.\.\//)?c:location.href="./"+c}})(wwa_util||(wwa_util={}));var wwa_message;
(function(c){var g=function(){return function(a,f,b,d){this.message=a;this.isSystemMessage=f;this.isEndOfPartsEvent=b;this.macro=d;void 0===this.macro&&(this.macro=[])}}();c.MessageInfo=g;c.strArrayToMessageInfoArray=function(a,f){var b=[];a.forEach(function(a){b.push(new g(a,f))});return b};var k=function(){function a(a,b,d,e,c,g){this._wwa=a;this._triggerPartsID=b;this._triggerPartsType=d;this._triggerPartsPosition=e;this.macroType=c;this.macroArgs=g}a.prototype.execute=function(){try{this.macroType===
wwa_data.MacroType.IMGPLAYER?this._executeImgPlayerMacro():this.macroType===wwa_data.MacroType.IMGYESNO?this._executeImgYesNoMacro():this.macroType===wwa_data.MacroType.HPMAX?this._executeHPMaxMacro():this.macroType===wwa_data.MacroType.SAVE?this._executeSaveMacro():this.macroType===wwa_data.MacroType.ITEM?this._executeItemMacro():this.macroType===wwa_data.MacroType.DEFAULT?this._executeDefaultMacro():this.macroType===wwa_data.MacroType.OLDMAP?this._executeOldMapMacro():this.macroType===wwa_data.MacroType.PARTS?
this._executePartsMacro():this.macroType===wwa_data.MacroType.MOVE?this._executeMoveMacro():this.macroType===wwa_data.MacroType.MAP?this._executeMapMacro():this.macroType===wwa_data.MacroType.DIRMAP?this._executeDirMapMacro():this.macroType===wwa_data.MacroType.IMGFRAME?this._executeImgFrameMacro():this.macroType===wwa_data.MacroType.IMGBOM?this._executeImgBomMacro():this.macroType===wwa_data.MacroType.DELPLAYER?this._executeDelPlayerMacro():this.macroType===wwa_data.MacroType.FACE?this._executeFaceMacro():
this.macroType===wwa_data.MacroType.EFFECT?this._executeEffectMacro():this.macroType===wwa_data.MacroType.GAMEOVER?this._executeGameOverMacro():this.macroType===wwa_data.MacroType.IMGCLICK?this._executeImgClickMacro():this.macroType===wwa_data.MacroType.STATUS?this._executeStatusMacro():this.macroType===wwa_data.MacroType.COLOR?this._executeColorMacro():this.macroType===wwa_data.MacroType.WAIT?this._executeWaitMacro():this.macroType===wwa_data.MacroType.SOUND&&this._executeSoundMacro()}catch(a){}};
a.prototype._concatEmptyArgs=function(a){if(this.macroArgs.length<a){a=Array(a-this.macroArgs.length);for(var b=0;b<a.length;b++)a[b]="";this.macroArgs=this.macroArgs.concat(a)}};a.prototype._parseInt=function(a,b){void 0===b&&(b=0);var d=parseInt(this.macroArgs[a]);return isNaN(d)?b:d};a.prototype._executeImgPlayerMacro=function(){this._concatEmptyArgs(2);var a=this._parseInt(0),b=this._parseInt(1);this._wwa.setPlayerImgCoord(new wwa_data.Coord(a,b))};a.prototype._executeImgYesNoMacro=function(){this._concatEmptyArgs(2);
var a=this._parseInt(0),b=this._parseInt(1);this._wwa.setYesNoImgCoord(new wwa_data.Coord(a,b))};a.prototype._executeHPMaxMacro=function(){this._concatEmptyArgs(1);var a=Math.max(0,this._parseInt(0));this._wwa.setPlayerEnergyMax(a)};a.prototype._executeSaveMacro=function(){this._concatEmptyArgs(1);var a=!!this._parseInt(0);this._wwa.disableSave(a)};a.prototype._executeItemMacro=function(){this._concatEmptyArgs(2);var a=this._parseInt(0),b=this._parseInt(1);this._wwa.setPlayerGetItem(a,b)};a.prototype._executeDefaultMacro=
function(){this._concatEmptyArgs(1);var a=!!this._parseInt(0);this._wwa.setObjectNotCollapseOnPartsOnPlayer(a)};a.prototype._executeOldMapMacro=function(){this._concatEmptyArgs(1);var a=!!this._parseInt(0);this._wwa.setOldMap(a)};a.prototype._executePartsMacro=function(){this._concatEmptyArgs(4);var a=this._parseInt(0),b=this._parseInt(1),d=this._parseInt(2,wwa_data.PartsType.OBJECT),e=this._parseInt(3);if(d!==wwa_data.PartsType.OBJECT&&d!==wwa_data.PartsType.MAP)throw Error("\u30d1\u30fc\u30c4\u7a2e\u5225\u304c\u4e0d\u660e\u3067\u3059");
0!==e&&1!==e&&(e=1);if(0>a||0>b)throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");if(d===wwa_data.PartsType.OBJECT){if(a>=this._wwa.getObjectPartsNum()||b>=this._wwa.getObjectPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");}else if(a>=this._wwa.getMapPartsNum()||b>=this._wwa.getMapPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");this._wwa.replaceParts(a,b,d,!!e)};a.prototype._executeMoveMacro=function(){this._concatEmptyArgs(1);
var a=this._parseInt(0);this._wwa.setMoveMacroWaitingToPlayer(a)};a.prototype._executeMapMacro=function(){this._concatEmptyArgs(4);var a=this._parseInt(0),b=this.macroArgs[1],d=this.macroArgs[2],e=this._parseInt(3,wwa_data.PartsType.OBJECT);if(0>a)throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");if(e===wwa_data.PartsType.OBJECT){if(a>=this._wwa.getObjectPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");}else if(a>=this._wwa.getMapPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");
this._wwa.appearPartsEval(this._triggerPartsPosition,b,d,a,e)};a.prototype._executeDirMapMacro=function(){this._concatEmptyArgs(3);var a=this._parseInt(0),b=this._parseInt(1),d=this._parseInt(2,wwa_data.PartsType.OBJECT);if(isNaN(a)||isNaN(b)||isNaN(d))throw Error("\u5f15\u6570\u304c\u6574\u6570\u3067\u306f\u3042\u308a\u307e\u305b\u3093");if(0>a)throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");if(d===wwa_data.PartsType.OBJECT){if(a>=this._wwa.getObjectPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");
}else if(a>=this._wwa.getMapPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");this._wwa.appearPartsByDirection(b,a,d)};a.prototype._executeImgFrameMacro=function(){this._concatEmptyArgs(3);var a=this._parseInt(0),b=this._parseInt(1),d=this._parseInt(2),e=b*wwa_data.WWAConsts.CHIP_SIZE,c=d*wwa_data.WWAConsts.CHIP_SIZE;if(0>b||0>d)throw Error("\u5ea7\u6a19\u306f\u6b63\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");if(a===wwa_data.MacroImgFrameIndex.ENERGY)wwa_util.$qsh("#disp-energy>.status-icon").style.backgroundPosition=
"-"+e+"px -"+c+"px";else if(a===wwa_data.MacroImgFrameIndex.STRENGTH)wwa_util.$qsh("#disp-strength>.status-icon").style.backgroundPosition="-"+e+"px -"+c+"px";else if(a===wwa_data.MacroImgFrameIndex.DEFENCE)wwa_util.$qsh("#disp-defence>.status-icon").style.backgroundPosition="-"+e+"px -"+c+"px";else if(a===wwa_data.MacroImgFrameIndex.GOLD)wwa_util.$qsh("#disp-gold>.status-icon").style.backgroundPosition="-"+e+"px -"+c+"px";else if(a===wwa_data.MacroImgFrameIndex.WIDE_CELL_ROW)Array.prototype.forEach.call(wwa_util.$qsAll("div.wide-cell-row"),
function(a){a.style.backgroundPosition="-"+e+"px -"+c+"px"});else if(a===wwa_data.MacroImgFrameIndex.ITEM_BG)Array.prototype.forEach.call(wwa_util.$qsAll("div.item-cell"),function(a){a.style.backgroundPosition="-"+e+"px -"+c+"px"});else if(a===wwa_data.MacroImgFrameIndex.MAIN_FRAME)this._wwa.setFrameCoord(new wwa_data.Coord(b,d));else throw Error("\u7a2e\u5225\u304c\u4e0d\u6b63\u3067\u3059\u3002");};a.prototype._executeImgBomMacro=function(){this._concatEmptyArgs(2);var a=this._parseInt(0),b=this._parseInt(1);
if(0>a||0>b)throw Error("\u5ea7\u6a19\u306f\u6b63\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");this._wwa.setBattleEffectCoord(new wwa_data.Coord(a,b))};a.prototype._executeDelPlayerMacro=function(){this._concatEmptyArgs(1);var a=parseInt(this.macroArgs[0]);this._wwa.setDelPlayer(!!a)};a.prototype._executeFaceMacro=function(){this._concatEmptyArgs(6);var a=this._parseInt(0),b=this._parseInt(1),d=this._parseInt(2),e=this._parseInt(3),c=this._parseInt(4),g=this._parseInt(5);if(0>
a||0>b||0>d||0>e||0>c||0>g)throw Error("\u5404\u5f15\u6570\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");a=new wwa_data.Face(new wwa_data.Coord(a,b),new wwa_data.Coord(d,e),new wwa_data.Coord(c,g));this._wwa.addFace(a)};a.prototype._executeEffectMacro=function(){this._concatEmptyArgs(1);var a=this._parseInt(0);if(0>a)throw Error("\u5f85\u3061\u6642\u9593\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");
0===a&&this._wwa.stopEffect();for(var b=[],d=1;d<this.macroArgs.length;d+=2){var e=this._parseInt(d),c=0;if(0>e)throw Error("\u753b\u50cf\u306e\u30d1\u30fc\u30c4\u5ea7\u6a19\u6307\u5b9a\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");if(d+1===this.macroArgs.length)throw Error("\u753b\u50cf\u306e\u30d1\u30fc\u30c4\u5ea7\u6a19\u6307\u5b9a\u3067\u3001Y\u5ea7\u6a19\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002");c=this._parseInt(d+
1);if(0>c)throw Error("\u753b\u50cf\u306e\u30d1\u30fc\u30c4\u5ea7\u6a19\u6307\u5b9a\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");b.push(new wwa_data.Coord(e,c))}this._wwa.setEffect(a,b)};a.prototype._executeGameOverMacro=function(){this._concatEmptyArgs(2);var a=this._parseInt(0),b=this._parseInt(1);if(0>a||a>=this._wwa.getMapWidth()||0>b||b>=this._wwa.getMapWidth())throw Error("\u30de\u30c3\u30d7\u306e\u7bc4\u56f2\u5916\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059!");
this._wwa.setGameOverPosition(new wwa_data.Coord(a,b))};a.prototype._executeImgClickMacro=function(){this._concatEmptyArgs(2);if(1>this.macroArgs.length)throw Error("\u5f15\u6570\u304c\u5c11\u306a\u3059\u304e\u307e\u3059");var a=this._parseInt(0),b=this._parseInt(1);if(0>a||0>b)throw Error("\u5f15\u6570\u304c0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306f\u3042\u308a\u307e\u305b\u3093");this._wwa.setImgClick(new wwa_data.Coord(a,b))};a.prototype._executeStatusMacro=function(){this._concatEmptyArgs(2);
var a=this._parseInt(0),b=this._parseInt(1);if(0>a||4<a)throw Error("\u30b9\u30c6\u30fc\u30bf\u30b9\u7a2e\u5225\u304c\u7bc4\u56f2\u5916\u3067\u3059\u3002");this._wwa.setPlayerStatus(a,b)};a.prototype._executeColorMacro=function(){this._concatEmptyArgs(4);var a=this._parseInt(0),b=this._parseInt(1),d=this._parseInt(2),e=this._parseInt(3);if(0>a||5<a)throw Error("\u7a2e\u5225\u306f0\u304b\u30895\u307e\u3067\u3067\u3059");if(0>b||255<b||0>d||255<d||0>e||255<e)throw Error("\u8272\u304c\u7bc4\u56f2\u5916\u3067\u3059");
this._wwa.changeStyleRule(a,b,d,e)};a.prototype._executeWaitMacro=function(){throw Error("Not implemented!");};a.prototype._executeSoundMacro=function(){this._concatEmptyArgs(1);var a=parseInt(this.macroArgs[0]);this._wwa.playSound(a)};return a}();c.Macro=k;c.parseMacro=function(a,b,e,d,c){c=c.match(/^\$([a-zA-Z_][a-zA-Z0-9_]*)\=(.*)$/);if(null===c||3!==c.length)throw Error("\u30de\u30af\u30ed\u3067\u306f\u3042\u308a\u307e\u305b\u3093");var g=wwa_data.macrotable["$"+c[1].toLowerCase()];return void 0===
g?new k(a,b,e,d,wwa_data.MacroType.UNDEFINED,c[2].split(",")):new k(a,b,e,d,g,c[2].split(",").map(function(a){return a.trim()}))};var e=function(){function a(a,b,d,e,c,g,k){this._wwa=a;this._coord=b;this._width=d;this._height=e;this._isVisible=c;this._parentElement=g;this._element=document.createElement("div");this._element.style.position="absolute";this._element.style.borderWidth="2px";this._element.style.borderStyle="solid";this._element.style.borderRadius="10px";this._element.classList.add("wwa-message-window");
this._element.style.zIndex=k+"";this._element.style.left=this._coord.x+"px";this._element.style.top=this._coord.y+"px";this._element.style.width=this._width+"px";this._element.style.height=this._height+"px";this._parentElement.appendChild(this._element)}a.prototype.update=function(a){};a.prototype.show=function(){this._isVisible=!0;this._element.style.display="block";this.update()};a.prototype.hide=function(){this._isVisible=!1;this._element.style.display="none";this.update()};a.prototype.isVisible=
function(){return this._isVisible};return a}(),b=function(a){function b(e,d,f,c,g,k,m){a.call(this,e,new wwa_data.Coord(d.x,d.y),f,c,g,k,201);this._cgFileName=m;this._monsterBox=document.createElement("div");this._monsterBox.style.width=wwa_data.WWAConsts.CHIP_SIZE+"px";this._monsterBox.style.height=wwa_data.WWAConsts.CHIP_SIZE+"px";this._monsterBox.style.position="absolute";this._monsterBox.style.left="10px";this._monsterBox.style.top="10px";this._monsterBox.style.backgroundImage="url("+this._cgFileName.replace("(",
"\\(").replace(")","\\)")+")";this._monsterBox.style.backgroundPosition="0 0";this._element.appendChild(this._monsterBox);this._energyBox=document.createElement("div");this._energyBox.style.position="absolute";this._energyBox.style.left="80px";this._energyBox.style.top="10px";this._energyBox.textContent="\u751f\u547d\u529b 0";this._element.appendChild(this._energyBox);this._strengthBox=document.createElement("div");this._strengthBox.style.position="absolute";this._strengthBox.style.left="80px";this._strengthBox.style.top=
"30px";this._strengthBox.textContent="\u653b\u6483\u529b 0";this._element.appendChild(this._strengthBox);this._defenceBox=document.createElement("div");this._defenceBox.style.position="absolute";this._defenceBox.style.left="180px";this._defenceBox.style.top="30px";this._defenceBox.textContent="\u9632\u5fa1\u529b 0";this._element.appendChild(this._defenceBox);this._element.style.display=this._isVisible?"block":"none"}__extends(b,a);b.prototype.update=function(a){void 0!==a&&(this._monsterBox.style.backgroundPosition=
"-"+a.imgCoord.x+"px -"+a.imgCoord.y+"px",this._energyBox.textContent="\u751f\u547d\u529b "+a.status.energy,this._strengthBox.textContent="\u653b\u6483\u529b "+a.status.strength,this._defenceBox.textContent="\u9632\u5fa1\u529b "+a.status.defence)};return b}(e);c.MosterWindow=b;e=function(a){function b(e,d,f,c){a.call(this,e,new wwa_data.Coord(d.x,d.y),340,30,f,c,202);this._element.style.textAlign="center";this._element.style.display=this._isVisible?"block":"none";this.update(0)}__extends(b,a);b.prototype.update=
function(a){void 0!==a&&(this._element.textContent="Score: "+a)};return b}(e);c.ScoreWindow=e;(function(a){a[a.TOP=0]="TOP";a[a.CENTER=1]="CENTER";a[a.BOTTOM=2]="BOTTOM";a[a.SCORE=3]="SCORE"})(c.Positioning||(c.Positioning={}));var m=c.Positioning,e=function(){function a(a,b,d,e,c,g,k,m,y,E){var n=this,q=k.replace("(","\\(").replace(")","\\)");this._wwa=a;this._cgFileName=k;this._x=b;this._y=d;this._width=e;this._height=c;this._message=g;this._isVisible=m;this._isYesno=y;this._element=document.createElement("div");
this._element.style.position="absolute";this._element.style.borderWidth="2px";this._element.style.borderStyle="solid";this._element.style.borderRadius="10px";this._element.classList.add("wwa-message-window");this._element.style.zIndex="400";this._msgWrapperElement=document.createElement("div");this._msgWrapperElement.style.padding="7px";this._msgWrapperElement.style.margin="0";this._msgWrapperElement.style.textAlign="left";this._msgWrapperElement.style.wordWrap="break-word";this._element.appendChild(this._msgWrapperElement);
this._dummyElement=document.createElement("div");this._dummyElement.style.display="none";this._dummyElement.style.padding="0";this._dummyElement.style.margin="0";this._dummyElement.style.height="55px";this._element.appendChild(this._dummyElement);this._ynWrapperElement=document.createElement("div");this._ynWrapperElement.style.padding="0";this._ynWrapperElement.style.margin="0";this._ynWrapperElement.style.position="absolute";this._ynWrapperElement.style.left="246px";this._ynWrapperElement.style.bottom=
"10px";this._ynWrapperElement.style.width="80px";this._ynWrapperElement.style.height="40px";this._ynWrapperElement.style.zIndex="10";this._element.appendChild(this._ynWrapperElement);this._parentElement=E;this._parentElement.appendChild(this._element);this._divYesElement=document.createElement("div");this._divYesElement.style.padding="0";this._divYesElement.style.margin="0";this._divYesElement.style.cssFloat="left";this._divYesElement.style.width="40px";this._divYesElement.style.height="40px";this._divYesElement.style.background=
"url("+q+")";this._divYesElement.onclick=function(){n._isInputDisable||(a.setYesNoInput(wwa_data.YesNoState.YES),n.update())};this._divYesElement.style.cursor="pointer";this._divNoElement=document.createElement("div");this._divNoElement.style.padding="0";this._divNoElement.style.margin="0";this._divNoElement.style.cssFloat="left";this._divNoElement.style.width="40px";this._divNoElement.style.height="40px";this._divNoElement.style.background="url("+q+")";this._divNoElement.onclick=function(){n._isInputDisable||
(a.setYesNoInput(wwa_data.YesNoState.NO),n.update())};this._divNoElement.style.cursor="pointer";this._ynWrapperElement.appendChild(this._divYesElement);this._ynWrapperElement.appendChild(this._divNoElement);n._isInputDisable=!1;this.update()}a.prototype.setPosition=function(a,b,d,e){this._x=a;this._y=b;this._width=d;this._height=e;this.update()};a.prototype.setPositionByPlayerPosition=function(a,b,d,e,g){e=e.getPartsCoord().substract(g.getPartsCoord()).y;a=a?c.Positioning.BOTTOM:b?c.Positioning.SCORE:
d?c.Positioning.CENTER:e>=Math.ceil(wwa_data.WWAConsts.V_PARTS_NUM_IN_WINDOW/2)?c.Positioning.TOP:c.Positioning.BOTTOM;this.setPositionEasy(a)};a.prototype.setPositionEasy=function(a){var b=Math.floor(this._element.clientHeight/2);a===m.CENTER?(this._y=wwa_data.WWAConsts.MAP_WINDOW_HEIGHT/2-b,this.update()):a===m.TOP?(this._y=Math.max(20,wwa_data.WWAConsts.MAP_WINDOW_HEIGHT/4-b)+10,this.update()):a===m.BOTTOM?(this._y=Math.min(wwa_data.WWAConsts.MAP_WINDOW_HEIGHT-20-this._element.clientHeight,3*wwa_data.WWAConsts.MAP_WINDOW_HEIGHT/
4-b),this.update()):a===m.SCORE&&(this._y=80,this.update())};a.prototype.setMessage=function(a){this._message=a;this.update()};a.prototype.setYesNoChoice=function(a){this._isInputDisable=!1;this._isYesno=a;this.update();return this._isYesno};a.prototype.isYesNoChoice=function(){return this._isYesno};a.prototype.setInputDisable=function(){this._isInputDisable=!0};a.prototype.isInputDisable=function(){return this._isInputDisable};a.prototype.show=function(){this._isVisible=!0;this.update()};a.prototype.hide=
function(){this._isVisible=!1;this.update()};a.prototype.isVisible=function(){return this._isVisible};a.prototype.update=function(){var a=this._wwa.getYesNoImgCoord();this._isYesno?(this._wwa.getYesNoState()===wwa_data.YesNoState.YES?(this._divYesElement.style.backgroundPosition="-"+(a.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_YESP_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+a.y*wwa_data.WWAConsts.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(a.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_NO_X)*wwa_data.WWAConsts.CHIP_SIZE+
"px -"+a.y*wwa_data.WWAConsts.CHIP_SIZE+"px"):this._wwa.getYesNoState()===wwa_data.YesNoState.NO?(this._divYesElement.style.backgroundPosition="-"+(a.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_YES_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+a.y*wwa_data.WWAConsts.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(a.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_NOP_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+a.y*wwa_data.WWAConsts.CHIP_SIZE+"px"):(this._divYesElement.style.backgroundPosition="-"+(a.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_YES_X)*
wwa_data.WWAConsts.CHIP_SIZE+"px -"+a.y*wwa_data.WWAConsts.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(a.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_NO_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+a.y*wwa_data.WWAConsts.CHIP_SIZE+"px"),this._ynWrapperElement.style.display="block"):this._ynWrapperElement.style.display="none";this._msgWrapperElement.textContent="";for(var a=this._message.split("\n"),b=0;b<a.length;b++){var d=document.createElement("span");d.textContent=a[b];this._msgWrapperElement.appendChild(d);
this._msgWrapperElement.appendChild(document.createElement("br"))}this._isVisible?(this._element.style.left=this._x+"px",this._element.style.top=this._y+"px"):(this._element.style.left="-999999px",this._element.style.top="-999999px");this._element.style.width=this._width+"px";this._element.style.minHeight=this._height+"px";this._dummyElement.style.display=this._isYesno?"block":"none"};return a}();c.MessageWindow=e})(wwa_message||(wwa_message={}));var wwa_monster;
(function(c){var g=function(){function c(e,b,g,a,f,k,d){this._partsID=e;this._position=b;this._imgCoord=g;this._status=a;this._message=f;this._item=k;this._battleEndCallback=d}Object.defineProperty(c.prototype,"partsID",{get:function(){return this._partsID},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"imgCoord",{get:function(){return this._imgCoord},enumerable:!0,
configurable:!0});Object.defineProperty(c.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"item",{get:function(){return this._item},enumerable:!0,configurable:!0});c.prototype.damage=function(e){this._status.energy=Math.max(0,this._status.energy-e)};c.prototype.battleEndProcess=function(){this._battleEndCallback()};
return c}();c.Monster=g})(wwa_monster||(wwa_monster={}));var wwa_motion;
(function(c){var g=function(){function e(b,e,a,f,c){this._player=b;this._objectID=e;this._srcPos=a;this._destPos=f;this._dir=c;this._currentPos=this._srcPos.clone()}e.prototype.update=function(){var b=this._player.getSpeedIndex();return this._currentPos=this._currentPos.getNextFramePosition(this._dir,wwa_data.speedList[b],wwa_data.speedList[b])};Object.defineProperty(e.prototype,"isAchievedDestination",{get:function(){return this._currentPos.equals(this._destPos)},enumerable:!0,configurable:!0});
Object.defineProperty(e.prototype,"currentPosition",{get:function(){return this._currentPos},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"beforePosition",{get:function(){return this._srcPos},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"destination",{get:function(){return this._destPos},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"objID",{get:function(){return this._objectID},enumerable:!0,configurable:!0});return e}();c.ObjectMovingData=
g;var k=function(){function e(b,e){this._wwa=b;this._player=e;this.clear()}e.prototype.add=function(b,e,a,f){this._queue.push(new g(this._player,b,e,a,f))};e.prototype.update=function(){for(var b=[],e=[],a=0;a<this._queue.length;a++)this._queue[a].update(),this._queue[a].isAchievedDestination?(b.push(this._queue[a]),this._wwa.setPartsOnPosition(wwa_data.PartsType.OBJECT,0,this._queue[a].beforePosition.getPartsCoord()),this._wwa.setPartsOnPosition(wwa_data.PartsType.OBJECT,this._queue[a].objID,this._queue[a].destination.getPartsCoord())):
e.push(this._queue[a]);this._queue=e;return b};e.prototype.clear=function(){this._queue=[]};Object.defineProperty(e.prototype,"objectMovingData",{get:function(){return this.objectMovingData},enumerable:!0,configurable:!0});e.prototype.getOffsetByBeforePartsCoord=function(b){var e=this._queue.filter(function(a){return a.beforePosition.getPartsCoord().equals(b)});return 0===e.length?null:e[0].currentPosition.getOffsetCoord()};return e}();c.ObjectMovingDataManager=k})(wwa_motion||(wwa_motion={}));var wwa_estimate_battle;
(function(c){var g=function(){function b(b,a,e){this.id=b;this.imgFileName=a;this.parent=e;this.elem=document.createElement("div");this.elem.classList.add("est");this.elem.setAttribute("id","wwa-est-"+b);this.imgElem=document.createElement("div");this.imgElem.classList.add("est-img-wrapper");this.imgElem.style.backgroundImage="url("+this.imgFileName.replace("(","\\(").replace(")","\\)")+")";this.statusElem=document.createElement("div");this.statusElem.classList.add("est-status-wrapper");this.energyElem=
document.createElement("div");this.energyElem.classList.add("est-energy");this.energyDispElem=document.createElement("span");this.energyDispElem.classList.add("est-energy-disp");this.energyElem.appendChild(this.energyDispElem);this.statusElem.appendChild(this.energyElem);this.strengthElem=document.createElement("div");this.strengthElem.classList.add("est-strength");this.strengthDispElem=document.createElement("span");this.strengthDispElem.classList.add("est-strength-disp");this.strengthElem.appendChild(this.strengthDispElem);
this.statusElem.appendChild(this.strengthElem);this.defenceElem=document.createElement("div");this.defenceElem.classList.add("est-defence");this.defenceDispElem=document.createElement("span");this.defenceDispElem.classList.add("est-defence-disp");this.defenceElem.appendChild(this.defenceDispElem);this.statusElem.appendChild(this.defenceElem);this.damageElem=document.createElement("div");this.damageElem.classList.add("est-damage");this.damageDispElem=document.createElement("span");this.damageDispElem.classList.add("est-damage-disp");
this.damageElem.appendChild(this.damageDispElem);this.statusElem.appendChild(this.damageElem);this.elem.appendChild(this.imgElem);this.elem.appendChild(this.statusElem)}b.prototype.hide=function(){this.elem.style.display="none"};b.prototype.show=function(){this.elem.style.display="block"};b.prototype.setResult=function(b,a,e){this.imgElem.style.backgroundPosition="-"+b.x+"px -"+b.y+"px";this.energyDispElem.textContent="\u751f\u547d\u529b "+a.energy;this.strengthDispElem.textContent="\u653b\u6483\u529b "+
a.strength;this.defenceDispElem.textContent="\u9632\u5fa1\u529b "+a.defence;this.damageDispElem.textContent=e.isNoEffect?"\u653b\u6483\u7121\u52b9":e.isOverMaxTurn?"\u9577\u671f\u6226\u304c\u4e88\u60f3\u3055\u308c\u307e\u3059":"\u4e88\u60f3\u30c0\u30e1\u30fc\u30b8 "+e.damage};return b}(),k=function(){function b(b,a,e){var c=this;this._wwa=b;this._imgFileName=a;this._parent=e;this._element=document.createElement("div");this._element.setAttribute("id","wwa-battle-estimate");this._element.style.display=
"none";this._edes=[];for(a=0;a<wwa_data.WWAConsts.BATTLE_ESTIMATE_MONSTER_TYPE_MAX;a++)b=new g(a,this._imgFileName,this._element),this._edes.push(b),this._element.appendChild(b.elem);this._element.addEventListener("click",function(){c._wwa.hideBattleEstimateWindow()});this._parent.appendChild(this._element)}b.prototype.update=function(b,a){for(var f=0;f<wwa_data.WWAConsts.BATTLE_ESTIMATE_MONSTER_TYPE_MAX;f++)if(f>=a.length)this._edes[f].hide();else{var c=this._wwa.getObjectAttributeById(a[f],wwa_data.WWAConsts.ATR_X),
d=this._wwa.getObjectAttributeById(a[f],wwa_data.WWAConsts.ATR_Y),c=new wwa_data.Coord(c,d),d=this._wwa.getObjectAttributeById(a[f],wwa_data.WWAConsts.ATR_ENERGY),g=this._wwa.getObjectAttributeById(a[f],wwa_data.WWAConsts.ATR_STRENGTH),k=this._wwa.getObjectAttributeById(a[f],wwa_data.WWAConsts.ATR_DEFENCE),d=new wwa_data.Status(d,g,k,0);a:{var g=d.energy,k=b.strength-d.defence,C=Math.max(0,d.strength-b.defence),p=0,v=0;if(0<k)for(;;){p++;g-=k;if(0>=g){g=new e(!1,!1,v);break a}v+=C;if(1E4<p){g=new e(!1,
!0,0);break a}}else g=new e(!0,!1,0)}this._edes[f].setResult(c,d,g);this._edes[f].show()}};b.prototype.show=function(){this._element.style.display="block"};b.prototype.hide=function(){this._element.style.display="none"};return b}();c.BattleEstimateWindow=k;var e=function(){return function(b,e,a){this.isNoEffect=b;this.isOverMaxTurn=e;this.damage=a}}()})(wwa_estimate_battle||(wwa_estimate_battle={}));var wwa_inject_html;
(function(c){c.inject=function(c,k){var e=document.createElement("style");e.type="text/css";e.setAttribute("id",wwa_data.WWAConsts.WWA_STYLE_TAG_ID);wwa_util.$tag("head")[0].appendChild(e);c.innerHTML='            <canvas id="wwa-map" class="wwa-canvas" width="440" height="440">                \u3053\u306e\u30d6\u30e9\u30a6\u30b6\u306f\u3001Canvas\u8981\u7d20\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u305b\u3093\u3002            </canvas>            <canvas id="wwa-map-sub" class="wwa-canvas" width="440" height="440"></canvas>            <div id="wwa-sidebar">                <div class="wide-cell-row" id="disp-energy"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="wide-cell-row" id="disp-strength"><div class="status-icon"></div><div class="status-value-box"> 0 </div></div>                <div class="wide-cell-row" id="disp-defence"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="wide-cell-row" id="disp-gold"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="item-cell" id="item0"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item1"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item2"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item3"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item4"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item5"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item6"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item7"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item8"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item9"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item10"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item11"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="wide-cell-row" id="cell-load">Quick Load</div><div class="wide-button" id="button-load"></div>                <div class="wide-cell-row" id="cell-save">Quick Save</div><div class="wide-button" id="button-save"></div>                <div class="wide-cell-row" id="cell-restart">Restart Game</div><div class="wide-button" id="button-restart"></div>                <div class="wide-cell-row" id="cell-gotowwa">Go to WWA</div><div class="wide-button" id="button-gotowwa"></div>            </div>            <div id="wwa-controller"></div>            <div id="wwa-fader"></div>            <div id="wwa-cover">                 <div id="version"></div>                 <div id="progress-message-container">\u958b\u59cb\u3057\u3066\u3044\u307e\u3059...</div>                 <div id="progress-bar-bg"></div>                 <div id="progress-bar" class="progress-bar"></div>                 <div id="progress-bar-audio" class="progress-bar"></div>                 <div id="progress-disp">---</div>            </div>            <div id="wwa-audio-wrapper"></div>    ';
e=document.createElement("img");e.src=k;wwa_util.$id("wwa-cover").appendChild(e)}})(wwa_inject_html||(wwa_inject_html={}));var postMessage_noWorker=function(c){},wwa_main;
(function(c){function g(a,n,d){var b=new wwa_data.LoaderProgress;b.current=a;b.total=n;b.stage=d;return b}function k(){void 0===window.wwap_mode&&(wwap_mode=!1);Array.prototype.forEach.call(p.$qsAll("a.wwa-copyright"),function(a){a.addEventListener("click",function(){y=!0})});window.addEventListener("beforeunload",function(a){if(y)return y=!1,a.returnValue="\u3053\u306e\u30da\u30fc\u30b8\u3092\u96e2\u308c\u307e\u3059\u304b\uff1f"});var a=wwap_mode?d.WWAP_SERVER+"/"+d.WWAP_SERVER_TITLE_IMG:p.$id("wwa-wrapper").getAttribute("data-wwa-title-img");
wwa_inject_html.inject(p.$id("wwa-wrapper"),null===a?"cover.gif":a);var a=p.$id("wwa-wrapper").getAttribute("data-wwa-mapdata"),n=p.$id("wwa-wrapper").getAttribute("data-wwa-loader"),b=!0;p.$id("wwa-wrapper").getAttribute("data-wwa-urlgate-enable").match(/^false$/i)&&(b=!1);new v(a,n,b)}var e=wwa_input.KeyCode,b=wwa_input.KeyState,m=wwa_input.KeyStore,a=wwa_input.MouseState,f=wwa_input.MouseStore,l=wwa_cgmanager.CGManager,d=wwa_data.WWAConsts,r=wwa_data.Coord,x=wwa_data.Position,C=wwa_camera.Camera,
p=wwa_util;c.getProgress=g;var v=function(){function c(a,q,A){var h=this;void 0===A&&(A=!1);try{p.$id("version").textContent="WWA Wing Ver."+d.VERSION_WWAJS}catch(H){}this._isURLGateEnable=A;this._animationCounter=this._mainCallCounter=0;this._statusPressCounter=new wwa_data.Status(0,0,0,0);var B=(new Date).getTime();location.href.match(/^file/)&&alert("\u3010\u8b66\u544a\u3011\u76f4\u63a5HTML\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u3044\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u6b63\u5e38\u306b\u52d5\u4f5c\u3057\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u306e\u78ba\u8a8d\u3092\u884c\u3046\u5834\u5408\u306b\u306f\u540c\u68b1\u306e\u300cWWA Debugger\u300d\u3092\u3054\u5229\u7528\u304f\u3060\u3055\u3044\u3002");
if(void 0===window.audiojs)alert("Audio.js\u306e\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002audio\u30d5\u30a9\u30eb\u30c0\u306e\u4e2d\u306baudio.min.js\u306f\u914d\u7f6e\u3055\u308c\u3066\u3044\u307e\u3059\u304b\uff1f");else if(this._loadHandler=function(a){if(null!==a.data.error&&void 0!==a.data.error)alert("\u4e0b\u8a18\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002: \n"+a.data.error.message);else if(null!==a.data.progress&&void 0!==a.data.progress)h._setProgressBar(a.data.progress);
else{h._wwaData=a.data.wwaData;h.initCSSRule();h._setProgressBar(g(0,4,wwa_data.LoadStage.GAME_INIT));a=new Image;a.src=h._wwaData.mapCGName;a.addEventListener("error",function(){alert("\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u300c"+h._wwaData.mapCGName+"\u300d\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u7ba1\u7406\u8005\u306e\u65b9\u3078: \u30c7\u30fc\u30bf\u304c\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u308b\u304b\u3001\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3092\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044\u3002")});
h._restartData=JSON.parse(JSON.stringify(h._wwaData));var n=h._wwaData.mapCGName.replace("(","\\(").replace(")","\\)");Array.prototype.forEach.call(p.$qsAll("div.item-cell"),function(a){a.style.backgroundPosition="-40px -80px";a.style.backgroundImage="url("+n+")"});Array.prototype.forEach.call(p.$qsAll("div.wide-cell-row"),function(a){a.style.backgroundPosition="-160px -120px";a.style.backgroundImage="url("+n+")"});Array.prototype.forEach.call(p.$qsAll(".item-cell>.item-click-border"),function(a){a.style.backgroundImage=
"url('"+d.ITEM_BORDER_IMG_DATA_URL+"')";a.style.backgroundPosition="0 0";a.style.display="none";a.style.cursor="pointer"});Array.prototype.forEach.call(p.$qsAll(".item-cell>.item-disp"),function(a){a.style.backgroundImage="url("+n+")"});a=p.$qsh("#disp-energy>.status-icon");a.style.backgroundPosition="-120px -80px";a.style.backgroundImage="url("+n+")";a=p.$qsh("#disp-strength>.status-icon");a.style.backgroundPosition="-160px -80px";a.style.backgroundImage="url("+n+")";a=p.$qsh("#disp-defence>.status-icon");
a.style.backgroundPosition="-200px -80px";a.style.backgroundImage="url("+n+")";a=p.$qsh("#disp-gold>.status-icon");a.style.backgroundPosition="-240px -80px";a.style.backgroundImage="url("+n+")";h._setProgressBar(g(1,4,wwa_data.LoadStage.GAME_INIT));h._replaceAllRandomObjects();a=(new Date).getTime();console.log("Loading Complete!"+(a-B)+"ms");h._cvs=p.$id("wwa-map");h._cvsSub=p.$id("wwa-map-sub");a=h._cvs.getContext("2d");var q=h._cvsSub.getContext("2d");a.fillStyle="rgba( 255, 255, 255, 0.5)";a.fillRect(0,
0,440,440);var c=new x(h,h._wwaData.playerX,h._wwaData.playerY);h._camera=new C(c);var A=new wwa_data.Status(h._wwaData.statusEnergy,h._wwaData.statusStrength,h._wwaData.statusDefence,h._wwaData.statusGold);h._player=new wwa_parts_player.Player(h,c,h._camera,A,h._wwaData.statusEnergyMax);h._objectMovingDataManager=new wwa_motion.ObjectMovingDataManager(h,h._player);h._camera.setPlayer(h._player);h._keyStore=new m;h._mouseStore=new f;h._messageQueue=[];h._yesNoJudge=wwa_data.YesNoState.UNSELECTED;
h._yesNoJudgeInNextFrame=wwa_data.YesNoState.UNSELECTED;h._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.NONE;h._prevFrameEventExected=!1;h._lastMessage=new wwa_message.MessageInfo("",!1,!1,[]);h._execMacroListInNextFrame=[];h._setProgressBar(g(2,4,wwa_data.LoadStage.GAME_INIT));window.addEventListener("keydown",function(a){h._keyStore.setPressInfo(a.keyCode);a.keyCode!==e.KEY_DOWN&&a.keyCode!==e.KEY_LEFT&&a.keyCode!==e.KEY_RIGHT&&a.keyCode!==e.KEY_UP&&a.keyCode!==e.KEY_SHIFT&&a.keyCode!==e.KEY_ENTER&&
a.keyCode!==e.KEY_1&&a.keyCode!==e.KEY_2&&a.keyCode!==e.KEY_3&&a.keyCode!==e.KEY_A&&a.keyCode!==e.KEY_C&&a.keyCode!==e.KEY_D&&a.keyCode!==e.KEY_E&&a.keyCode!==e.KEY_M&&a.keyCode!==e.KEY_N&&a.keyCode!==e.KEY_Q&&a.keyCode!==e.KEY_S&&a.keyCode!==e.KEY_W&&a.keyCode!==e.KEY_X&&a.keyCode!==e.KEY_Y&&a.keyCode!==e.KEY_Z&&a.keyCode!==e.KEY_ESC&&a.keyCode!==e.KEY_F1&&a.keyCode!==e.KEY_F3&&a.keyCode!==e.KEY_F4&&a.keyCode!==e.KEY_F5&&a.keyCode!==e.KEY_F6&&a.keyCode!==e.KEY_F7&&a.keyCode!==e.KEY_F8&&a.keyCode!==
e.KEY_F12&&a.keyCode!==e.KEY_SPACE||a.preventDefault()});window.addEventListener("keyup",function(a){h._keyStore.setReleaseInfo(a.keyCode);a.keyCode!==e.KEY_DOWN&&a.keyCode!==e.KEY_LEFT&&a.keyCode!==e.KEY_RIGHT&&a.keyCode!==e.KEY_UP&&a.keyCode!==e.KEY_SHIFT&&a.keyCode!==e.KEY_ENTER&&a.keyCode!==e.KEY_1&&a.keyCode!==e.KEY_2&&a.keyCode!==e.KEY_3&&a.keyCode!==e.KEY_A&&a.keyCode!==e.KEY_C&&a.keyCode!==e.KEY_D&&a.keyCode!==e.KEY_E&&a.keyCode!==e.KEY_M&&a.keyCode!==e.KEY_N&&a.keyCode!==e.KEY_Q&&a.keyCode!==
e.KEY_S&&a.keyCode!==e.KEY_W&&a.keyCode!==e.KEY_X&&a.keyCode!==e.KEY_Y&&a.keyCode!==e.KEY_Z&&a.keyCode!==e.KEY_ESC&&a.keyCode!==e.KEY_F1&&a.keyCode!==e.KEY_F3&&a.keyCode!==e.KEY_F4&&a.keyCode!==e.KEY_F5&&a.keyCode!==e.KEY_F6&&a.keyCode!==e.KEY_F7&&a.keyCode!==e.KEY_F8&&a.keyCode!==e.KEY_F12&&a.keyCode!==e.KEY_SPACE||a.preventDefault()});window.addEventListener("blur",function(a){h._keyStore.allClear();h._mouseStore.clear()});window.addEventListener("contextmenu",function(a){h._keyStore.allClear();
h._mouseStore.clear()});window.addEventListener("help",function(a){a.preventDefault()});h._wwaWrapperElement=wwa_util.$id("wwa-wrapper");h._mouseControllerElement=wwa_util.$id("wwa-controller");h._mouseControllerElement.addEventListener("mousedown",function(a){if(1===a.which){if(h._mouseStore.getMouseState()===wwa_input.MouseState.NONE){var n=wwa_util.$localPos(a.clientX,a.clientY),d=h._player.getDrawingCenterPosition(),n=n.substract(d),d=Math.abs(n.x),b=Math.abs(n.y),q;0<n.y&&b>d?q=wwa_data.Direction.DOWN:
0>n.y&&b>d?q=wwa_data.Direction.UP:0<n.x&&b<d?q=wwa_data.Direction.RIGHT:0>n.x&&b<d&&(q=wwa_data.Direction.LEFT);h._mouseStore.setPressInfo(q)}a.preventDefault()}});h._mouseControllerElement.addEventListener("mouseleave",function(a){h._mouseStore.clear()});h._mouseControllerElement.addEventListener("mouseup",function(a){1===a.which&&(h._mouseStore.setReleaseInfo(),a.preventDefault())});window.TouchEvent&&(h._mouseControllerElement.addEventListener("touchstart",function(a){if(h._mouseStore.getMouseState()!==
wwa_input.MouseState.NONE)a.preventDefault();else{var n=wwa_util.$localPos(a.changedTouches[0].clientX,a.changedTouches[0].clientY),d=h._player.getDrawingCenterPosition(),n=n.substract(d),d=Math.abs(n.x),b=Math.abs(n.y),q;0<n.y&&b>d?q=wwa_data.Direction.DOWN:0>n.y&&b>d?q=wwa_data.Direction.UP:0<n.x&&b<d?q=wwa_data.Direction.RIGHT:0>n.x&&b<d&&(q=wwa_data.Direction.LEFT);h._mouseStore.setPressInfo(q,a.changedTouches[0].identifier);a.cancelable&&a.preventDefault()}}),h._mouseControllerElement.addEventListener("touchend",
function(a){for(var n=0;n<a.changedTouches.length;n++)if(h._mouseStore.getTouchID()===a.changedTouches[n].identifier){h._mouseStore.setReleaseInfo();a.preventDefault();break}}),h._mouseControllerElement.addEventListener("touchcancel",function(a){for(var n=0;n<a.changedTouches.length;n++)if(h._mouseStore.getTouchID()===a.changedTouches[n].identifier){h._mouseStore.setReleaseInfo();a.preventDefault();break}}));p.$id("button-load").addEventListener("click",function(){if(h._player.isControllable())h.onselectbutton(wwa_data.SidebarButton.QUICK_LOAD)});
p.$id("button-save").addEventListener("click",function(){if(h._player.isControllable())h.onselectbutton(wwa_data.SidebarButton.QUICK_SAVE)});p.$id("button-restart").addEventListener("click",function(){if(h._player.isControllable())h.onselectbutton(wwa_data.SidebarButton.RESTART_GAME)});p.$id("button-gotowwa").addEventListener("click",function(){if(h._player.isControllable())h.onselectbutton(wwa_data.SidebarButton.GOTO_WWA)});Array.prototype.forEach.call(p.$qsAll(".wide-cell-row"),function(a){a.addEventListener("click",
function(){h._displayHelp()})});h._frameCoord=new r(d.IMGPOS_DEFAULT_FRAME_X,d.IMGPOS_DEFAULT_YESNO_Y);h._battleEffectCoord=new r(d.IMGPOS_DEFAULT_BATTLE_EFFECT_X,d.IMGPOS_DEFAULT_BATTLE_EFFECT_Y);h._battleEstimateWindow=new wwa_estimate_battle.BattleEstimateWindow(h,h._wwaData.mapCGName,wwa_util.$id("wwa-wrapper"));h._messageWindow=new wwa_message.MessageWindow(h,50,180,340,0,"",h._wwaData.mapCGName,!1,!0,p.$id("wwa-wrapper"));h._monsterWindow=new wwa_message.MosterWindow(h,new r(50,180),340,60,
!1,p.$id("wwa-wrapper"),h._wwaData.mapCGName);h._scoreWindow=new wwa_message.ScoreWindow(h,new r(50,50),!1,p.$id("wwa-wrapper"));h._setProgressBar(g(3,4,wwa_data.LoadStage.GAME_INIT));h._isLoadedSound=!1;h._temporaryInputDisable=!1;h._paintSkipByDoorOpen=!1;h._clearFacesInNextFrame=!1;h._useConsole=!1;h.clearFaces();h._cgManager=new l(a,q,h._wwaData.mapCGName,function(){if("ON"===h._wwaData.systemMessage[wwa_data.SystemMessage2.LOAD_SE])h._isLoadedSound=!0,h.setMessageQueue("\u30b2\u30fc\u30e0\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\u753b\u9762\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n\u203biOS, Android\u7aef\u672b\u3067\u306f\u3001\u97f3\u697d\u306f\u518d\u751f\u3055\u308c\u306a\u3044\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002",
!1,!0),h.loadSound(),setTimeout(h.soundCheckCaller,d.DEFAULT_FRAME_INTERVAL,h);else if("OFF"===h._wwaData.systemMessage[wwa_data.SystemMessage2.LOAD_SE])h._isLoadedSound=!1,h.setMessageQueue("\u30b2\u30fc\u30e0\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\u753b\u9762\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u304f\u3060\u3055\u3044\u3002",!1,!0),h.openGameWindow();else{h._messageWindow.setMessage((""===h._wwaData.systemMessage[wwa_data.SystemMessage2.LOAD_SE]?"\u52b9\u679c\u97f3\u30fb\uff22\uff27\uff2d\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30c9\u3057\u307e\u3059\u304b\uff1f":
h._wwaData.systemMessage[wwa_data.SystemMessage2.LOAD_SE])+"\n\u203biOS, Android\u7aef\u672b\u3067\u306f\u3001\u9078\u629e\u306b\u95a2\u308f\u3089\u305a\u97f3\u697d\u304c\u518d\u751f\u3055\u308c\u306a\u3044\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002");h._messageWindow.show();h._setProgressBar(g(4,4,wwa_data.LoadStage.GAME_INIT));var a=setInterval(function(){h._keyStore.update();if(h._yesNoJudgeInNextFrame===wwa_data.YesNoState.UNSELECTED)if(h._keyStore.getKeyState(e.KEY_ENTER)===b.KEYDOWN||h._keyStore.getKeyState(e.KEY_Y)===
b.KEYDOWN)h._yesNoJudgeInNextFrame=wwa_data.YesNoState.YES;else if(h._keyStore.getKeyState(e.KEY_N)===b.KEYDOWN||h._keyStore.getKeyState(e.KEY_ESC)===b.KEYDOWN)h._yesNoJudgeInNextFrame=wwa_data.YesNoState.NO;h._yesNoJudgeInNextFrame===wwa_data.YesNoState.YES?(clearInterval(a),h._messageWindow.update(),h._yesNoJudge=h._yesNoJudgeInNextFrame,h._messageWindow.setInputDisable(),setTimeout(function(){h._messageWindow.update();setTimeout(function(){h._messageWindow.hide();h._yesNoJudge=wwa_data.YesNoState.UNSELECTED;
h._yesNoJudgeInNextFrame=wwa_data.YesNoState.UNSELECTED;h._isLoadedSound=!0;h.loadSound();setTimeout(h.soundCheckCaller,d.DEFAULT_FRAME_INTERVAL,h)},d.YESNO_PRESS_DISP_FRAME_NUM*d.DEFAULT_FRAME_INTERVAL)},d.DEFAULT_FRAME_INTERVAL)):h._yesNoJudgeInNextFrame===wwa_data.YesNoState.NO&&(clearInterval(a),h._messageWindow.update(),h._yesNoJudge=h._yesNoJudgeInNextFrame,h._messageWindow.setInputDisable(),setTimeout(function(){h._messageWindow.update();setTimeout(function(){h._messageWindow.hide();h._yesNoJudge=
wwa_data.YesNoState.UNSELECTED;h._yesNoJudgeInNextFrame=wwa_data.YesNoState.UNSELECTED;h._isLoadedSound=!1;h.openGameWindow()},d.YESNO_PRESS_DISP_FRAME_NUM*d.DEFAULT_FRAME_INTERVAL)},d.DEFAULT_FRAME_INTERVAL))},d.DEFAULT_FRAME_INTERVAL)}})}},wwap_mode||void 0===Worker){if(external_script_inject_mode){if(q=document.getElementById("wwaloader-ex"),!q.src.match(/^http:\/\/wwawing\.com/)&&!q.src.match(/^http:\/\/www\.wwawing\.com/))throw Error("SCRIPT ORIGIN ERROR");}else q=document.createElement("script"),
q.src=wwap_mode?d.WWAP_SERVER+"/"+d.WWAP_SERVER_LOADER_NO_WORKER:"wwaload.noworker.js",document.getElementsByTagName("head")[0].appendChild(q);var k=this;postMessage_noWorker=function(a){k._loadHandler(a)};try{loader_start({data:{fileName:a+"?date="+B}})}catch(F){alert(F.message),q.onload=function(){loader_start({data:{fileName:a+"?date="+B}})}}}else try{var D=new Worker(q+"?date="+B);D.postMessage({fileName:a+"?date="+B});D.addEventListener("message",this._loadHandler)}catch(G){alert("\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u306e\u30ed\u30fc\u30c9\u6642\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002:\nWebWorker\u306e\u751f\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"+
G.message)}}c.prototype._setProgressBar=function(a){a.stage<=d.LOAD_STAGE_MAX_EXCEPT_AUDIO?(wwa_util.$id("progress-message-container").textContent=a.stage===d.LOAD_STAGE_MAX_EXCEPT_AUDIO?"World Name: "+this._wwaData.worldName:wwa_data.loadMessages[a.stage],wwa_util.$id("progress-bar").style.width=(1*a.stage+a.current/a.total*1)/(d.LOAD_STAGE_MAX_EXCEPT_AUDIO+1)*d.MAP_WINDOW_WIDTH+"px",wwa_util.$id("progress-disp").textContent=((1*a.stage+a.current/a.total*1)/(d.LOAD_STAGE_MAX_EXCEPT_AUDIO+1)*100).toFixed(2)+
"%"):(wwa_util.$id("progress-message-container").textContent="\u52b9\u679c\u97f3/BGM\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002(\u30b9\u30da\u30fc\u30b9\u30ad\u30fc\u3067\u30b9\u30ad\u30c3\u30d7\uff09",wwa_util.$id("progress-bar-audio").style.width=a.current*d.MAP_WINDOW_WIDTH/a.total+"px",wwa_util.$id("progress-disp").textContent=(a.current/a.total*100).toFixed(2)+"%")};c.prototype.createAudioJSInstance=function(a,b){if(0!==a&&void 0===this._audioJSInstances[a]&&a!==wwa_data.SystemSound.NO_SOUND){var c=
wwap_mode?d.WWAP_SERVER+"/"+d.WWAP_SERVER_AUDIO_DIR+"/"+a+".mp3":"./audio/"+a+".mp3",h=new Audio(c);h.preload="auto";a>=wwa_data.SystemSound.BGM_LB&&(h.loop=!0);p.$id("wwa-audio-wrapper").appendChild(h);this._audioJSInstances[a]=audiojs.create(h);a<wwa_data.SystemSound.BGM_LB&&(c=new Audio(c),c.preload="auto",p.$id("wwa-audio-wrapper").appendChild(c),this._audioJSInstancesSub[a]=audiojs.create(c))}};c.prototype.loadSound=function(){this._audioJSInstances=Array(d.SOUND_MAX+1);this._audioJSInstancesSub=
Array(d.SOUND_MAX+1);this.createAudioJSInstance(wwa_data.SystemSound.DECISION);this.createAudioJSInstance(wwa_data.SystemSound.ATTACK);for(var a=1;a<this._wwaData.mapPartsMax;a++){var b=this._wwaData.mapAttribute[a][d.ATR_SOUND];this.createAudioJSInstance(b)}for(a=1;a<this._wwaData.objPartsMax;a++)this._wwaData.objectAttribute[a][d.ATR_TYPE]!==d.OBJECT_RANDOM&&(b=this._wwaData.objectAttribute[a][d.ATR_SOUND],this.createAudioJSInstance(b));this._wwaData.bgm=0;this._soundLoadSkipFlag=!1};c.prototype.checkAllSoundLoaded=
function(){var a=0,b=0;this._keyStore.update();this._keyStore.getKeyState(wwa_input.KeyCode.KEY_SPACE)===wwa_input.KeyState.KEYDOWN&&(this._soundLoadSkipFlag=!0);for(var c=1;c<=d.SOUND_MAX;c++)void 0===this._audioJSInstances[c]||this._audioJSInstances[c].wrapper.classList.contains("error")||(b++,this._audioJSInstances[c].wrapper.classList.contains("loading")||a++);a<b&&!this._soundLoadSkipFlag?(this._setProgressBar(g(a,b,wwa_data.LoadStage.AUDIO)),setTimeout(this.soundCheckCaller,d.DEFAULT_FRAME_INTERVAL,
this)):(this._setProgressBar(g(d.SOUND_MAX,d.SOUND_MAX,wwa_data.LoadStage.AUDIO)),this.openGameWindow())};c.prototype.playSound=function(a){var b=this;if(this._isLoadedSound){if(0>a||a>d.SOUND_MAX)throw Error("\u30b5\u30a6\u30f3\u30c9\u756a\u53f7\u304c\u7bc4\u56f2\u5916\u3067\u3059\u3002");if(!(a>=wwa_data.SystemSound.BGM_LB&&this._wwaData.bgm===a)&&((a===wwa_data.SystemSound.NO_SOUND||a>=wwa_data.SystemSound.BGM_LB)&&0!==this._wwaData.bgm&&(this._audioJSInstances[this._wwaData.bgm].wrapper.classList.contains("loading")||
this._audioJSInstances[this._wwaData.bgm].pause(),this._wwaData.bgm=0),0!==a&&a!==wwa_data.SystemSound.NO_SOUND))if(this._audioJSInstances[a].wrapper.classList.contains("loading")){if(a>=wwa_data.SystemSound.BGM_LB){var c=function(a,n){var d=setInterval(function(){n._wwaData.bgm===a?n._audioJSInstances[a].wrapper.classList.contains("loading")||(b._audioJSInstances[a].skipTo(0),b._audioJSInstances[a].play(),b._wwaData.bgm=a,clearInterval(d)):(clearInterval(d),n._wwaData.bgm!==wwa_data.SystemSound.NO_SOUND&&
c(n._wwaData.bgm,n))},4)};c(a,this)}this._wwaData.bgm=a}else 0===a||this._audioJSInstances[a].wrapper.classList.contains("error")||(a>=wwa_data.SystemSound.BGM_LB?(this._audioJSInstances[a].skipTo(0),this._audioJSInstances[a].play(),this._wwaData.bgm=a):this._nextSoundIsSub?(this._audioJSInstancesSub[a].skipTo(0),this._audioJSInstancesSub[a].play(),this._nextSoundIsSub=!1):(this._audioJSInstances[a].skipTo(0),this._audioJSInstances[a].play(),this._nextSoundIsSub=!0))}};c.prototype.openGameWindow=
function(){var a=this,b=this._player.getPosition();p.$id("wwa-cover").style.opacity="0";0!==this.getObjectIdByPosition(b)&&this._player.setPartsAppearedFlag();setTimeout(function(){p.$id("wwa-wrapper").removeChild(p.$id("wwa-cover"));a._main()},d.SPLASH_SCREEN_DISP_MILLS)};c.prototype.mainCaller=function(a){a._main()};c.prototype.soundCheckCaller=function(a){a.checkAllSoundLoaded()};c.prototype.onselectitem=function(a){if(this._player.canUseItem(a))if(wwa_util.$id("item"+(a-1)).classList.add("onpress"),
this.playSound(wwa_data.SystemSound.DECISION),"BLANK"===this._wwaData.message[wwa_data.SystemMessage1.USE_ITEM]){this._player.readyToUseItem(a);a=this._player.useItem();var b=this.getObjectAttributeById(a,d.ATR_STRING);this.setMessageQueue(this.getMessageById(b),!1,!1,a,wwa_data.PartsType.OBJECT,this._player.getPosition().getPartsCoord())}else this.setMessageQueue(""===this._wwaData.message[wwa_data.SystemMessage1.USE_ITEM]?"\u3053\u306e\u30a2\u30a4\u30c6\u30e0\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b?":
this._wwaData.message[wwa_data.SystemMessage1.USE_ITEM],!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_ITEM_USE,this._yesNoUseItemPos=a};c.prototype.onselectbutton=function(a){var d=wwa_util.$id(wwa_data.sidebarButtonCellElementID[a]);this.playSound(wwa_data.SystemSound.DECISION);d.classList.add("onpress");a===wwa_data.SidebarButton.QUICK_LOAD?void 0!==this._quickSaveData?(this.setMessageQueue("\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u304b\uff1f\n\u203b\u30d1\u30b9\u30ef\u30fc\u30c9\u30ed\u30fc\u30c9\u306f\u3001\u73fe\u5728\u3054\u5229\u7528\u306b\u306a\u308c\u307e\u305b\u3093\u3002",
!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_QUICK_LOAD):this.setMessageQueue("\u30bb\u30fc\u30d6\u30c7\u30fc\u30bf\u304c\u3042\u308a\u307e\u305b\u3093\u3002\n\u203b\u30d1\u30b9\u30ef\u30fc\u30c9\u30ed\u30fc\u30c9\u306f\u3001\u73fe\u5728\u3054\u5229\u7528\u306b\u306a\u308c\u307e\u305b\u3093\u3002",!1,!0):a===wwa_data.SidebarButton.QUICK_SAVE?this._wwaData.disableSaveFlag?this.setMessageQueue("\u3053\u3053\u3067\u306f\u30bb\u30fc\u30d6\u6a5f\u80fd\u306f\n\u4f7f\u7528\u3067\u304d\u307e\u305b\u3093\u3002",
!1,!0):(this.setMessageQueue("\u30c7\u30fc\u30bf\u306e\u4e00\u6642\u4fdd\u5b58\u3092\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f\n\u203b\u30d1\u30b9\u30ef\u30fc\u30c9\u30bb\u30fc\u30d6\u306f\u3001\u73fe\u5728\u3054\u5229\u7528\u306b\u306a\u308c\u307e\u305b\u3093\u3002",!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_QUICK_SAVE):a===wwa_data.SidebarButton.RESTART_GAME?(this.setMessageQueue("\u521d\u3081\u304b\u3089\u30b9\u30bf\u30fc\u30c8\u3057\u306a\u304a\u3057\u307e\u3059\u304b\uff1f",
!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_RESTART_GAME):a===wwa_data.SidebarButton.GOTO_WWA&&(this.setMessageQueue("\uff37\uff37\uff21\u306e\u516c\u5f0f\u30b5\u30a4\u30c8\u3092\u958b\u304d\u307e\u3059\u304b\uff1f",!0,!0),this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_GOTO_WWA)};c.prototype.onchangespeed=function(a){a=a===wwa_data.SpeedChange.UP?this._player.speedUp():this._player.speedDown();this.setMessageQueue("\u79fb\u52d5\u901f\u5ea6\u3092\u3010"+wwa_data.speedNameList[a]+
"\u3011\u306b\u5207\u308a\u66ff\u3048\u307e\u3057\u305f\u3002\n"+(a===d.MAX_SPEED_INDEX?"\u6226\u95d8\u3082\u901f\u304f\u306a\u308a\u307e\u3059\u3002\n":"")+"("+(d.MAX_SPEED_INDEX+1)+"\u6bb5\u968e\u4e2d"+(a+1)+"\uff09 \u901f\u5ea6\u3092\u843d\u3068\u3059\u306b\u306fI\u30ad\u30fc, \u901f\u5ea6\u3092\u4e0a\u3052\u308b\u306b\u306fP\u30ad\u30fc\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044\u3002",!1,!0)};c.prototype._main=function(){var n=this;this._temporaryInputDisable=!1;this._waitTimeInCurrentFrame=
d.DEFAULT_FRAME_INTERVAL;this._stopUpdateByLoadFlag=!1;this._keyStore.update();this._mouseStore.update();void 0!==this._yesNoJudgeInNextFrame&&(this._yesNoJudge=this._yesNoJudgeInNextFrame,this._yesNoJudgeInNextFrame=void 0);this._clearFacesInNextFrame&&(this.clearFaces(),this._clearFacesInNextFrame=!1);for(var q=0;q<this._execMacroListInNextFrame.length;q++)this._execMacroListInNextFrame[q].execute();""===this._lastMessage.message&&this._lastMessage.isEndOfPartsEvent&&void 0!==this._reservedMoveMacroTurn&&
(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=void 0);this._execMacroListInNextFrame=[];this._player.getPosition();q=this._player.getDir();if(this._player.isControllable()){if(this._keyStore.getKeyStateForControllPlayer(e.KEY_LEFT)===wwa_input.KeyState.KEYDOWN||this._mouseStore.getMouseStateForControllPlayer(wwa_data.Direction.LEFT)===wwa_input.MouseState.MOUSEDOWN)this._player.controll(wwa_data.Direction.LEFT),this._objectMovingDataManager.update();else if(this._keyStore.getKeyStateForControllPlayer(e.KEY_UP)===
wwa_input.KeyState.KEYDOWN||this._mouseStore.getMouseStateForControllPlayer(wwa_data.Direction.UP)===wwa_input.MouseState.MOUSEDOWN)this._player.controll(wwa_data.Direction.UP),this._objectMovingDataManager.update();else if(this._keyStore.getKeyStateForControllPlayer(e.KEY_RIGHT)===wwa_input.KeyState.KEYDOWN||this._mouseStore.getMouseStateForControllPlayer(wwa_data.Direction.RIGHT)===wwa_input.MouseState.MOUSEDOWN)this._player.controll(wwa_data.Direction.RIGHT),this._objectMovingDataManager.update();
else if(this._keyStore.getKeyStateForControllPlayer(e.KEY_DOWN)===wwa_input.KeyState.KEYDOWN||this._mouseStore.getMouseStateForControllPlayer(wwa_data.Direction.DOWN)===wwa_input.MouseState.MOUSEDOWN)this._player.controll(wwa_data.Direction.DOWN),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(wwa_data.dirToKey[q]))this._player.controll(q),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(e.KEY_LEFT)||this._mouseStore.checkClickMouse(wwa_data.Direction.LEFT))this._player.controll(wwa_data.Direction.LEFT),
this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(e.KEY_UP)||this._mouseStore.checkClickMouse(wwa_data.Direction.UP))this._player.controll(wwa_data.Direction.UP),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(e.KEY_RIGHT)||this._mouseStore.checkClickMouse(wwa_data.Direction.RIGHT))this._player.controll(wwa_data.Direction.RIGHT),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(e.KEY_DOWN)||this._mouseStore.checkClickMouse(wwa_data.Direction.DOWN))this._player.controll(wwa_data.Direction.DOWN),
this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(e.KEY_LEFT)||this._mouseStore.checkClickMouse(wwa_data.Direction.LEFT))this._player.controll(wwa_data.Direction.LEFT),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(e.KEY_UP)||this._mouseStore.checkClickMouse(wwa_data.Direction.UP))this._player.controll(wwa_data.Direction.UP),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(e.KEY_RIGHT)||this._mouseStore.checkClickMouse(wwa_data.Direction.RIGHT))this._player.controll(wwa_data.Direction.RIGHT),
this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(e.KEY_DOWN)||this._mouseStore.checkClickMouse(wwa_data.Direction.DOWN))this._player.controll(wwa_data.Direction.DOWN),this._objectMovingDataManager.update();else if(this._keyStore.getKeyState(e.KEY_1)===wwa_input.KeyState.KEYDOWN)this.onselectitem(1);else if(this._keyStore.getKeyState(e.KEY_2)===wwa_input.KeyState.KEYDOWN)this.onselectitem(2);else if(this._keyStore.getKeyState(e.KEY_3)===wwa_input.KeyState.KEYDOWN)this.onselectitem(3);
else if(this._keyStore.getKeyState(e.KEY_Q)===wwa_input.KeyState.KEYDOWN)this.onselectitem(4);else if(this._keyStore.getKeyState(e.KEY_W)===wwa_input.KeyState.KEYDOWN)this.onselectitem(5);else if(this._keyStore.getKeyState(e.KEY_E)===wwa_input.KeyState.KEYDOWN)this.onselectitem(6);else if(this._keyStore.getKeyState(e.KEY_A)===wwa_input.KeyState.KEYDOWN)this.onselectitem(7);else if(this._keyStore.getKeyState(e.KEY_S)===wwa_input.KeyState.KEYDOWN)this.onselectitem(8);else if(this._keyStore.getKeyState(e.KEY_D)===
wwa_input.KeyState.KEYDOWN)this.onselectitem(9);else if(this._keyStore.getKeyState(e.KEY_Z)===wwa_input.KeyState.KEYDOWN)this.onselectitem(10);else if(this._keyStore.getKeyState(e.KEY_X)===wwa_input.KeyState.KEYDOWN)this.onselectitem(11);else if(this._keyStore.getKeyState(e.KEY_C)===wwa_input.KeyState.KEYDOWN)this.onselectitem(12);else if(this._keyStore.getKeyState(e.KEY_I))this.onchangespeed(wwa_data.SpeedChange.DOWN);else if(this._keyStore.checkHitKey(e.KEY_P))this.onchangespeed(wwa_data.SpeedChange.UP);
else if(this._keyStore.getKeyState(e.KEY_F1)===wwa_input.KeyState.KEYDOWN||this._keyStore.getKeyState(e.KEY_M)===wwa_input.KeyState.KEYDOWN)this.launchBattleEstimateWindow();else if(!this._keyStore.checkHitKey(e.KEY_F3)&&!this._keyStore.checkHitKey(e.KEY_F4))if(this._keyStore.checkHitKey(e.KEY_F5))this.onselectbutton(wwa_data.SidebarButton.QUICK_LOAD);else if(this._keyStore.checkHitKey(e.KEY_F6))this.onselectbutton(wwa_data.SidebarButton.QUICK_SAVE);else if(this._keyStore.checkHitKey(e.KEY_F7))this.onselectbutton(wwa_data.SidebarButton.RESTART_GAME);
else if(this._keyStore.checkHitKey(e.KEY_F8))this.onselectbutton(wwa_data.SidebarButton.GOTO_WWA);else this._keyStore.checkHitKey(e.KEY_F12)&&this._displayHelp();this._keyStore.memorizeKeyStateOnControllableFrame();this._mouseStore.memorizeMouseStateOnControllableFrame()}else if(this._player.isJumped())this._camera.isResetting()||this._player.processAfterJump();else if(this._player.isMoving())this._player.move(),this._objectMovingDataManager.update();else if(this._player.isWaitingMessage())if(this._messageWindow.isVisible()||
this._messageWindow.show(),!this._messageWindow.isYesNoChoice()){var q=this._keyStore.getKeyStateForMessageCheck(e.KEY_ENTER),c=this._keyStore.getKeyStateForMessageCheck(e.KEY_SPACE),h=this._keyStore.getKeyStateForMessageCheck(e.KEY_ESC);if(q===b.KEYDOWN||q===b.KEYPRESS_MESSAGECHANGE||c===b.KEYDOWN||c===b.KEYPRESS_MESSAGECHANGE||h===b.KEYDOWN||h===b.KEYPRESS_MESSAGECHANGE||this._mouseStore.getMouseState()===a.MOUSEDOWN){for(q=0;q<wwa_data.sidebarButtonCellElementID.length;q++)c=wwa_util.$id(wwa_data.sidebarButtonCellElementID[q]),
c.classList.contains("onpress")&&c.classList.remove("onpress");this._setNextMessage()}}else{if(!this._messageWindow.isInputDisable()){if(this._yesNoJudge===wwa_data.YesNoState.UNSELECTED)if(this._keyStore.getKeyState(e.KEY_ENTER)===b.KEYDOWN||this._keyStore.getKeyState(e.KEY_Y)===b.KEYDOWN)this._yesNoJudge=wwa_data.YesNoState.YES;else if(this._keyStore.getKeyState(e.KEY_N)===b.KEYDOWN||this._keyStore.getKeyState(e.KEY_ESC)===b.KEYDOWN)this._yesNoJudge=wwa_data.YesNoState.NO;this._yesNoJudge===wwa_data.YesNoState.YES?
(this.playSound(wwa_data.SystemSound.DECISION),this._yesNoDispCounter=d.YESNO_PRESS_DISP_FRAME_NUM,this._messageWindow.setInputDisable(),this._messageWindow.update()):this._yesNoJudge===wwa_data.YesNoState.NO&&(this.playSound(wwa_data.SystemSound.DECISION),this._yesNoDispCounter=d.YESNO_PRESS_DISP_FRAME_NUM,this._messageWindow.setInputDisable(),this._messageWindow.update())}}else this._player.isWatingEstimateWindow()?this._keyStore.getKeyState(e.KEY_ENTER)!==b.KEYDOWN&&this._keyStore.getKeyState(e.KEY_SPACE)!==
b.KEYDOWN||this.hideBattleEstimateWindow():this._player.isFighting()?(this._player.fight(),this._monsterWindow.update(this._monster)):this._player.isWaitingMoveMacro()&&(this._player.isMoveObjectAutoExecTime()&&(this.moveObjects(!1),this._player.resetMoveObjectAutoExecTimer()),this._objectMovingDataManager.update());this._prevFrameEventExected=!1;this._player.getPosition().isJustPosition()&&this._camera.getPosition().isScreenTopPosition()&&(this._player.isJumped()||this._player.isWaitingMessage()||
this._player.isWaitingMoveMacro()||this._player.isFighting()||(this._player.isPartsAppearedTime()&&this._player.clearPartsAppearedFlag(),this._replaceRandomObjectsInScreen(),(q=this.checkMap())||this.checkObject(),this._prevFrameEventExected=q),this._player.isWaitingMessage()&&this._messageWindow.isYesNoChoice()&&this._yesNoJudge!==wwa_data.YesNoState.UNSELECTED&&!this._player.isWaitingMoveMacro()&&!this._player.isFighting()&&this._execChoiceWindowRunningEvent());this._drawAll();this._mainCallCounter++;
this._mainCallCounter%=1E9;this._animationCounter=(this._animationCounter+1)%(2*d.ANIMATION_REP_HALF_FRAME);this._camera.isResetting()&&this._camera.advanceTransitionStepNum();this._player.isWaitingMessage()||(this._player.decrementLookingAroundTimer(),0<this._statusPressCounter.energy&&0===--this._statusPressCounter.energy&&wwa_util.$id("disp-energy").classList.remove("onpress"),0<this._statusPressCounter.strength&&0===--this._statusPressCounter.strength&&wwa_util.$id("disp-strength").classList.remove("onpress"),
0<this._statusPressCounter.defence&&0===--this._statusPressCounter.defence&&wwa_util.$id("disp-defence").classList.remove("onpress"),0<this._statusPressCounter.gold&&0===--this._statusPressCounter.gold&&wwa_util.$id("disp-gold").classList.remove("onpress"));this._player.isWaitingMoveMacro()&&this._player.decrementMoveObjectAutoExecTimer();this._stopUpdateByLoadFlag?this._fadeout(function(){n._loadType===wwa_data.LoadType.QUICK_LOAD?n._quickLoad():n._loadType===wwa_data.LoadType.RESTART_GAME&&n._restartGame();
setTimeout(n.mainCaller,n._waitTimeInCurrentFrame,n)}):setTimeout(this.mainCaller,this._waitTimeInCurrentFrame,this)};c.prototype._drawAll=function(){var a=this._camera.getPosition().getPartsCoord(),b=this._camera.getPosition().getOffsetCoord(),c=d.MAP_WINDOW_HEIGHT,h;h=this._player.getPosition().getPartsCoord();if(this._paintSkipByDoorOpen)this._paintSkipByDoorOpen=!1;else{this._cgManager.clearCanvas(0,0,d.MAP_WINDOW_WIDTH,d.MAP_WINDOW_HEIGHT);this._cgManager.drawBase(0,0,d.MAP_WINDOW_WIDTH,d.MAP_WINDOW_HEIGHT);
if(this._camera.isResetting()){if(null!==this._camera.getPreviousPosition())var e=this._camera.getPreviousPosition().getPartsCoord(),f=this._camera.getPreviousPosition().getOffsetCoord();c=this._camera.getTransitionStepNum()*d.CHIP_SIZE;this._drawMap(e,f,c,!0);this._drawPlayer(e,f,c,!0);this._drawObjects(e,f,c,!0);if(this._camera.isFinalStep())var g=255,k=setInterval(function(){var a=wwa_util.$id("wwa-fader");g-=3*d.FADEOUT_SPEED;0>=g?(clearInterval(k),a.style.backgroundColor="transparent",a.removeAttribute("style"),
a.style.display="none"):a.style.opacity=g/255+""},20)}this._drawMap(a,b,c);this._drawPlayer(a,b,c);this._drawObjects(a,b,c);this._player.isFighting()&&!this._player.isBattleStartFrame()&&(c=this._player.isTurn()?this._monster.position.x:h.x,h=this._player.isTurn()?this._monster.position.y:h.y,this._cgManager.drawCanvas(this._battleEffectCoord.x,this._battleEffectCoord.y,d.CHIP_SIZE*(c-a.x)-b.x,d.CHIP_SIZE*(h-a.y)-b.y,!1));this._drawEffect();this._drawFaces();this._drawFrame()}};c.prototype._drawMap=
function(a,b,c,h){void 0===h&&(h=!1);if(void 0!==a)for(var e=Math.max(0,a.x-1),f=Math.min(this._wwaData.mapWidth-1,a.x+d.H_PARTS_NUM_IN_WINDOW),g=Math.max(0,a.y-1),k=Math.min(this._wwaData.mapWidth-1,a.y+d.V_PARTS_NUM_IN_WINDOW);e<=f;e++)for(var l=g;l<=k;l++){var m=this._wwaData.map[l][e],p=this._wwaData.mapAttribute[m][d.ATR_X]/d.CHIP_SIZE,m=this._wwaData.mapAttribute[m][d.ATR_Y]/d.CHIP_SIZE,r=d.CHIP_SIZE*(e-a.x)-b.x,t=d.CHIP_SIZE*(l-a.y)-b.y;h?this._cgManager.drawCanvasWithLowerYLimit(p,m,r,t,c):
this._cgManager.drawCanvasWithUpperYLimit(p,m,r,t,c)}};c.prototype._drawPlayer=function(a,b,c,h){void 0===h&&(h=!1);if(void 0!==a&&!this._wwaData.delPlayerFlag){var e=this._player.getPosition().getPartsCoord(),f=this._player.getPosition().getOffsetCoord(),g=wwa_data.dirToPos[this._player.getDir()],k=(e.x-a.x)*d.CHIP_SIZE+f.x-b.x;a=(e.y-a.y)*d.CHIP_SIZE+f.y-b.y;Math.abs(f.x);Math.abs(f.y);b=this._player.getDir();e=[2,3,4,5,0,1,6,7];f=this._player.isLookingAround()&&!this._player.isWaitingMessage()?
this._wwaData.playerImgPosX+e[Math.floor(this._mainCallCounter%64/8)]:(b===wwa_data.Direction.LEFT||b===wwa_data.Direction.RIGHT)&&Math.abs(f.x)>Math.floor(d.CHIP_SIZE/2)||(b===wwa_data.Direction.UP||b===wwa_data.Direction.DOWN)&&Math.abs(f.y)>Math.floor(d.CHIP_SIZE/2)?this._wwaData.playerImgPosX+g+1:this._wwaData.playerImgPosX+g;h?this._cgManager.drawCanvasWithLowerYLimit(f,this._wwaData.playerImgPosY,k,a,c):this._cgManager.drawCanvasWithUpperYLimit(f,this._wwaData.playerImgPosY,k,a,c)}};c.prototype._drawObjects=
function(a,b,c,h){void 0===h&&(h=!1);if(void 0!==a)for(var e=Math.max(0,a.x-1),f=Math.min(this._wwaData.mapWidth-1,a.x+d.H_PARTS_NUM_IN_WINDOW),g=Math.max(0,a.y-1),k=Math.min(this._wwaData.mapWidth-1,a.y+d.V_PARTS_NUM_IN_WINDOW),l;e<=f;e++)for(var m=g;m<=k;m++)if(!(this._player.isFighting()&&this._player.isTurn()&&this._player.getPosition().getPartsCoord().equals(this._monster.position)&&(new wwa_data.Coord(e,m)).equals(this._monster.position))){var p=this._wwaData.mapObject[m][e];l=new r(0,0);if(this._wwaData.objectAttribute[p][d.ATR_MOVE]!==
wwa_data.MoveType.STATIC){var u=this._objectMovingDataManager.getOffsetByBeforePartsCoord(new r(e,m));null!==u&&(l=u)}var t=this._animationCounter>d.ANIMATION_REP_HALF_FRAME||0===this._wwaData.objectAttribute[p][d.ATR_X2]&&0===this._wwaData.objectAttribute[p][d.ATR_Y2],u=this._wwaData.objectAttribute[p][t?d.ATR_X:d.ATR_X2]/d.CHIP_SIZE,t=this._wwaData.objectAttribute[p][t?d.ATR_Y:d.ATR_Y2]/d.CHIP_SIZE,x=d.CHIP_SIZE*(e-a.x)+l.x-b.x;l=d.CHIP_SIZE*(m-a.y)+l.y-b.y;var v=this._wwaData.objectAttribute[p][d.ATR_TYPE],
z=this._wwaData.objectAttribute[p][d.ATR_NUMBER];0===p||this._checkNoDrawObject(new r(e,m),v,z)||(h?this._cgManager.drawCanvasWithLowerYLimit(u,t,x,l,c):this._cgManager.drawCanvasWithUpperYLimit(u,t,x,l,c))}};c.prototype._drawEffect=function(){if(0!==this._wwaData.effectCoords.length)for(var a=Math.floor(this._mainCallCounter%(this._wwaData.effectCoords.length*this._wwaData.effectWaits)/this._wwaData.effectWaits),b=0;b<d.V_PARTS_NUM_IN_WINDOW;b++)for(var c=0;c<d.H_PARTS_NUM_IN_WINDOW;c++)this._cgManager.drawCanvas(this._wwaData.effectCoords[a].x,
this._wwaData.effectCoords[a].y,c*d.CHIP_SIZE,b*d.CHIP_SIZE,!1)};c.prototype._drawFaces=function(){for(var a=0;a<this._faces.length;a++)this._cgManager.drawCanvasWithSize(this._faces[a].srcPos.x,this._faces[a].srcPos.y,this._faces[a].srcSize.x,this._faces[a].srcSize.y,this._faces[a].destPos.x,this._faces[a].destPos.y,!1)};c.prototype._drawFrame=function(){this._cgManager.drawCanvas(this._frameCoord.x,this._frameCoord.y,0,0,!1);this._cgManager.drawCanvas(this._frameCoord.x+2,this._frameCoord.y,d.MAP_WINDOW_WIDTH-
d.CHIP_SIZE,0,!1);this._cgManager.drawCanvas(this._frameCoord.x,this._frameCoord.y+2,0,d.MAP_WINDOW_HEIGHT-d.CHIP_SIZE,!1);this._cgManager.drawCanvas(this._frameCoord.x+2,this._frameCoord.y+2,d.MAP_WINDOW_WIDTH-d.CHIP_SIZE,d.MAP_WINDOW_HEIGHT-d.CHIP_SIZE,!1);for(var a=1;a<d.H_PARTS_NUM_IN_WINDOW-1;a++)this._cgManager.drawCanvas(this._frameCoord.x+1,this._frameCoord.y,d.CHIP_SIZE*a,0,!1),this._cgManager.drawCanvas(this._frameCoord.x+1,this._frameCoord.y+2,d.CHIP_SIZE*a,d.MAP_WINDOW_HEIGHT-d.CHIP_SIZE,
!1);for(a=1;a<d.V_PARTS_NUM_IN_WINDOW-1;a++)this._cgManager.drawCanvas(this._frameCoord.x,this._frameCoord.y+1,0,d.CHIP_SIZE*a,!1),this._cgManager.drawCanvas(this._frameCoord.x+2,this._frameCoord.y+1,d.MAP_WINDOW_WIDTH-d.CHIP_SIZE,d.CHIP_SIZE*a,!1)};c.prototype._checkNoDrawObject=function(a,b,c){var h=this._player.getPosition(),e=h.getPartsCoord();return!h.isJustPosition()||e.x!==a.x||e.y!==a.y||this._wwaData.objectNoCollapseDefaultFlag?!1:b===d.OBJECT_DOOR&&0===c?!0:b===d.OBJECT_STATUS||b===d.OBJECT_MESSAGE||
b===d.OBJECT_ITEM||b===d.OBJECT_SELL||b===d.OBJECT_BUY||b===d.OBJECT_SELL||b===d.OBJECT_LOCALGATE};c.prototype.getMapWidth=function(){if(void 0===this._wwaData)throw Error("\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u304c\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u307e\u305b\u3093");return this._wwaData.mapWidth};c.prototype.getMapIdByPosition=function(a){a=a.getPartsCoord();return this._wwaData.map[a.y][a.x]};c.prototype.getObjectIdByPosition=function(a){a=a.getPartsCoord();return this._wwaData.mapObject[a.y][a.x]};
c.prototype.getMapTypeByPosition=function(a){a=a.getPartsCoord();return this._wwaData.mapAttribute[this._wwaData.map[a.y][a.x]][d.ATR_TYPE]};c.prototype.getObjectTypeByPosition=function(a){a=a.getPartsCoord();return this._wwaData.objectAttribute[this._wwaData.mapObject[a.y][a.x]][d.ATR_TYPE]};c.prototype.getMapAttributeByPosition=function(a,d){var b=a.getPartsCoord();return this._wwaData.mapAttribute[this._wwaData.map[b.y][b.x]][d]};c.prototype.isCurrentPosMapPartsIncludingMessage=function(a){return 0!==
this.getMapAttributeByPosition(a,d.ATR_STRING)};c.prototype.getObjectAttributeByPosition=function(a,d){var b=a.getPartsCoord();return this._wwaData.objectAttribute[this._wwaData.mapObject[b.y][b.x]][d]};c.prototype.getMapAttributeById=function(a,d){return this._wwaData.mapAttribute[a][d]};c.prototype.getObjectAttributeById=function(a,d){return this._wwaData.objectAttribute[a][d]};c.prototype.getObjectCropXById=function(a){return this._wwaData.objectAttribute[a][d.ATR_X]};c.prototype.getObjectCropYById=
function(a){return this._wwaData.objectAttribute[a][d.ATR_Y]};c.prototype.getMessageById=function(a){return this._wwaData.message[a]};c.prototype.getSystemMessageById=function(a){return this._wwaData.systemMessage[a]};c.prototype.checkMap=function(a){var b=this._player.getPosition().getPartsCoord();a=void 0!==a&&null!==a?a:b;var c=this._wwaData.map[a.y][a.x],h=this._wwaData.mapAttribute[c][d.ATR_TYPE],b=a.x===b.x&&a.y===b.y,e=!1;if(b&&this._player.getLastExecPartsIDOnSamePosition(wwa_data.PartsType.MAP)===
c)return!1;h===d.MAP_STREET?e=this._execMapStreetEvent(a,c,h):h===d.MAP_WALL?e=this._execMapWallEvent(a,c,h):h===d.MAP_LOCALGATE?e=this._execMapLocalGateEvent(a,c,h):h===d.MAP_URLGATE&&(e=this._execMapUrlGateEvent(a,c,h));b&&!this._player.isJumped()&&this._player.setLastExecInfoOnSamePosition(wwa_data.PartsType.MAP,c);return e};c.prototype.checkObject=function(a){var b=this._player.getPosition().getPartsCoord();a=void 0!==a&&null!==a?a:b;var c=this._wwaData.mapObject[a.y][a.x],h=this._wwaData.objectAttribute[c][d.ATR_TYPE],
b=a.x===b.x&&a.y===b.y;b&&this._player.getLastExecPartsIDOnSamePosition(wwa_data.PartsType.OBJECT)===c||(h===d.OBJECT_NORMAL?this._execObjectNormalEvent(a,c,h):h===d.OBJECT_MESSAGE?this._execObjectMessageEvent(a,c,h):h===d.OBJECT_MONSTER?this._execObjectMonsterEvent(a,c,h):h===d.OBJECT_ITEM?this._execObjectItemEvent(a,c,h):h===d.OBJECT_DOOR?this._execObjectDoorEvent(a,c,h):h===d.OBJECT_STATUS?this._execObjectStatusEvent(a,c,h):h===d.OBJECT_BUY?this._execObjectBuyEvent(a,c,h):h===d.OBJECT_SELL?this._execObjectSellEvent(a,
c,h):h===d.OBJECT_URLGATE?this._execObjectUrlGateEvent(a,c,h):h===d.OBJECT_SCORE?this._execObjectScoreEvent(a,c,h):h===d.OBJECT_SELECT?this._execObjectYesNoChoiceEvent(a,c,h):h===d.OBJECT_LOCALGATE&&this._execObjectLocalGateEvent(a,c,h),b&&!this._player.isJumped()&&this._player.setLastExecInfoOnSamePosition(wwa_data.PartsType.OBJECT,c))};c.prototype._execMapStreetEvent=function(a,b,c){c=this._wwaData.mapAttribute[b][d.ATR_ITEM];if(0!==c&&!this._player.hasItem(c))return!1;this.appearParts(a,wwa_data.AppearanceTriggerType.MAP);
c=this._wwaData.mapAttribute[b][d.ATR_STRING];var h=this._wwaData.message[c];this._waitTimeInCurrentFrame+=100*this._wwaData.mapAttribute[b][d.ATR_NUMBER];this._temporaryInputDisable=!0;a=this.setMessageQueue(h,!1,!1,b,wwa_data.PartsType.MAP,a.clone());this.playSound(this._wwaData.mapAttribute[b][d.ATR_SOUND]);return 0!==c&&a};c.prototype._execMapWallEvent=function(a,b,c){c=this.getObjectIdByPosition(a.convertIntoPosition(this));var h=this.getObjectAttributeById(c,d.ATR_TYPE);0!==c&&h!==d.OBJECT_NORMAL&&
(h!==d.OBJECT_DOOR||this._player.hasItem(this.getObjectAttributeById(c,d.ATR_ITEM))&&this.getObjectAttributeById(h,d.ATR_MODE)!==d.PASSABLE_OBJECT)||(this.appearParts(a,wwa_data.AppearanceTriggerType.MAP),this.setMessageQueue(this._wwaData.message[this._wwaData.mapAttribute[b][d.ATR_STRING]],!1,!1,b,wwa_data.PartsType.MAP,a.clone()),this.playSound(this._wwaData.mapAttribute[b][d.ATR_SOUND]));return!1};c.prototype._execMapLocalGateEvent=function(a,b,c){c=this._player.getPosition().getPartsCoord();
var h=this._wwaData.mapAttribute[b][d.ATR_JUMP_X],e=this._wwaData.mapAttribute[b][d.ATR_JUMP_Y];h>d.RELATIVE_COORD_LOWER&&(h=a.x+h-d.RELATIVE_COORD_BIAS);e>d.RELATIVE_COORD_LOWER&&(e=a.y+e-d.RELATIVE_COORD_BIAS);this.appearParts(a,wwa_data.AppearanceTriggerType.MAP);return 0<=h&&0<=e&&h<this._wwaData.mapWidth&&e<this._wwaData.mapWidth&&(h!==c.x||e!==c.y)?(this._player.jumpTo(new x(this,h,e,0,0)),this.playSound(this._wwaData.mapAttribute[b][d.ATR_SOUND]),!0):!1};c.prototype._execMapUrlGateEvent=function(a,
b,c){c=this._wwaData.mapAttribute[b][d.ATR_STRING];if(!this._isURLGateEnable)return!0;if("BLANK"===this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK])location.href=wwa_util.$escapedURI(this._wwaData.message[c].split(/\s/g)[0]);else return this.setMessageQueue(""===this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK]?"\u4ed6\u306e\u30da\u30fc\u30b8\u306b\u30ea\u30f3\u30af\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f":this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK],
!0,!0),this._yesNoChoicePartsCoord=a,this._yesNoChoicePartsID=b,this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_MAP_PARTS,this._yesNoURL=this._wwaData.message[c].split(/\s/g)[0],!0};c.prototype._execObjectNormalEvent=function(a,d,b){};c.prototype._execObjectMessageEvent=function(a,b,c){c=this._wwaData.message[this._wwaData.objectAttribute[b][d.ATR_STRING]];var h=this._player.getPosition().getPartsCoord(),e=this._wwaData.objectAttribute[b][d.ATR_SOUND];a.x!==h.x||a.y!==h.y||this._wwaData.objectNoCollapseDefaultFlag||
(this._wwaData.mapObject[a.y][a.x]=0);this.setMessageQueue(c,!1,!1,b,wwa_data.PartsType.OBJECT,a);this._waitTimeInCurrentFrame+=100*this._wwaData.objectAttribute[b][d.ATR_NUMBER];this._temporaryInputDisable=!0;this.appearParts(a,wwa_data.AppearanceTriggerType.OBJECT,b);this.playSound(e)};c.prototype._execObjectStatusEvent=function(a,b,c){c=new wwa_data.Status(this._wwaData.objectAttribute[b][d.ATR_ENERGY],this._wwaData.objectAttribute[b][d.ATR_STRENGTH],this._wwaData.objectAttribute[b][d.ATR_DEFENCE],
this._wwaData.objectAttribute[b][d.ATR_GOLD]);var h=this._wwaData.message[this._wwaData.objectAttribute[b][d.ATR_STRING]],e=this._player.getStatusWithoutEquipments();c.strength>d.STATUS_MINUS_BORDER&&e.strength<c.strength-d.STATUS_MINUS_BORDER||c.defence>d.STATUS_MINUS_BORDER&&e.defence<c.defence-d.STATUS_MINUS_BORDER||c.gold>d.STATUS_MINUS_BORDER&&e.gold<c.gold-d.STATUS_MINUS_BORDER?this._wwaData.mapObject[a.y][a.x]=0:(c.energy=c.energy>d.STATUS_MINUS_BORDER?d.STATUS_MINUS_BORDER-c.energy:c.energy,
c.strength=c.strength>d.STATUS_MINUS_BORDER?d.STATUS_MINUS_BORDER-c.strength:c.strength,c.defence=c.defence>d.STATUS_MINUS_BORDER?d.STATUS_MINUS_BORDER-c.defence:c.defence,c.gold=c.gold>d.STATUS_MINUS_BORDER?d.STATUS_MINUS_BORDER-c.gold:c.gold,this._player.addStatusAll(c),this.setStatusChangedEffect(c),this._player.isDead()&&0!==this._wwaData.objectAttribute[b][d.ATR_ENERGY]?this.gameover():(this.setMessageQueue(h,!1,!1,b,wwa_data.PartsType.OBJECT,a.clone()),this._wwaData.mapObject[a.y][a.x]=0,this.appearParts(a,
wwa_data.AppearanceTriggerType.OBJECT,b),this.playSound(this._wwaData.objectAttribute[b][d.ATR_SOUND])))};c.prototype._execObjectMonsterEvent=function(a,b,c){var e=this;c=new wwa_data.Coord(this._wwaData.objectAttribute[b][d.ATR_X],this._wwaData.objectAttribute[b][d.ATR_Y]);var f=new wwa_data.Status(this._wwaData.objectAttribute[b][d.ATR_ENERGY],this._wwaData.objectAttribute[b][d.ATR_STRENGTH],this._wwaData.objectAttribute[b][d.ATR_DEFENCE],this._wwaData.objectAttribute[b][d.ATR_GOLD]);this._monster=
new wwa_monster.Monster(b,a,c,f,this._wwaData.message[this._wwaData.objectAttribute[b][d.ATR_STRING]],this._wwaData.objectAttribute[b][d.ATR_ITEM],function(){e._monsterWindow.hide()});this._player.startBattleWith(this._monster)};c.prototype._execObjectBuyEvent=function(a,b,c){c=this._wwaData.message[this._wwaData.objectAttribute[b][d.ATR_STRING]];var e=this._player.getPosition().getPartsCoord();a.x!==e.x||a.y!==e.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=0);
this.setMessageQueue(c,!0,!1,b,wwa_data.PartsType.OBJECT,a.clone());this._yesNoChoicePartsCoord=a;this._yesNoChoicePartsID=b;this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS;this.playSound(this._wwaData.objectAttribute[b][d.ATR_SOUND])};c.prototype._execObjectSellEvent=function(a,b,c){c=this._wwaData.message[this._wwaData.objectAttribute[b][d.ATR_STRING]];var e=this._player.getPosition().getPartsCoord();a.x!==e.x||a.y!==e.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=
0);this.setMessageQueue(c,!0,!1,b,wwa_data.PartsType.OBJECT,a.clone());this._yesNoChoicePartsCoord=a;this._yesNoChoicePartsID=b;this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS;this.playSound(this._wwaData.objectAttribute[b][d.ATR_SOUND])};c.prototype._execObjectItemEvent=function(a,b,c){c=this._wwaData.message[this._wwaData.objectAttribute[b][d.ATR_STRING]];try{this._player.addItem(b,this._wwaData.objectAttribute[b][d.ATR_NUMBER]),this._wwaData.mapObject[a.y][a.x]=0,0===this._wwaData.objectAttribute[b][d.ATR_MODE]&&
(this.setMessageQueue(c,!1,!1,b,wwa_data.PartsType.OBJECT,a.clone()),this.appearParts(a,wwa_data.AppearanceTriggerType.OBJECT,b))}catch(e){"BLANK"!==this._wwaData.systemMessage[wwa_data.SystemMessage2.FULL_ITEM]&&this.setMessageQueue(""===this._wwaData.systemMessage[wwa_data.SystemMessage2.FULL_ITEM]?"\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002":this._wwaData.systemMessage[wwa_data.SystemMessage2.FULL_ITEM],!1,!0)}this.playSound(this._wwaData.objectAttribute[b][d.ATR_SOUND])};
c.prototype._execObjectDoorEvent=function(a,b,c){c=this._wwaData.objectAttribute[b][d.ATR_ITEM];var e=this._wwaData.message[this._wwaData.objectAttribute[b][d.ATR_STRING]];this._player.hasItem(c)&&(0===this._wwaData.objectAttribute[b][d.ATR_MODE]&&this._player.removeItemByPartsID(c),this.playSound(this._wwaData.objectAttribute[b][d.ATR_SOUND]),this.setMessageQueue(e,!1,!1,b,wwa_data.PartsType.OBJECT,a.clone()),this._wwaData.mapObject[a.y][a.x]=0,this.appearParts(a,wwa_data.AppearanceTriggerType.OBJECT,
b),this._paintSkipByDoorOpen=!0)};c.prototype._execObjectYesNoChoiceEvent=function(a,b,c){c=this._wwaData.message[this._wwaData.objectAttribute[b][d.ATR_STRING]];var e=this._player.getPosition().getPartsCoord();a.x!==e.x||a.y!==e.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=0);this.setMessageQueue(c,!0,!1,b,wwa_data.PartsType.OBJECT,a.clone());this._yesNoChoicePartsCoord=a;this._yesNoChoicePartsID=b;this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS;
this.playSound(this._wwaData.objectAttribute[b][d.ATR_SOUND])};c.prototype._execObjectLocalGateEvent=function(a,b,c){c=this._player.getPosition().getPartsCoord();a.x!==c.x||a.y!==c.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=0);var e=this._wwaData.objectAttribute[b][d.ATR_JUMP_X],f=this._wwaData.objectAttribute[b][d.ATR_JUMP_Y];e>d.RELATIVE_COORD_LOWER&&(e=c.x+e-d.RELATIVE_COORD_BIAS);f>d.RELATIVE_COORD_LOWER&&(f=c.y+f-d.RELATIVE_COORD_BIAS);this.appearParts(a,
wwa_data.AppearanceTriggerType.OBJECT,b);0<=e&&0<=f&&e<this._wwaData.mapWidth&&f<this._wwaData.mapWidth&&(e!==c.x||f!==c.y)&&(this._player.jumpTo(new x(this,e,f,0,0)),this.playSound(this._wwaData.objectAttribute[b][d.ATR_SOUND]))};c.prototype._execObjectUrlGateEvent=function(a,b,c){c=this._wwaData.objectAttribute[b][d.ATR_STRING];this._isURLGateEnable&&("BLANK"===this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK]?location.href=wwa_util.$escapedURI(this._wwaData.message[c].split(/\s/g)[0]):(this.setMessageQueue(""===
this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK]?"\u4ed6\u306e\u30da\u30fc\u30b8\u306b\u30ea\u30f3\u30af\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f":this._wwaData.message[wwa_data.SystemMessage1.ASK_LINK],!0,!0),this._yesNoChoicePartsCoord=a,this._yesNoChoicePartsID=b,this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS,this._yesNoURL=this._wwaData.message[c].split(/\s/g)[0]))};c.prototype._execObjectScoreEvent=function(a,b,c){a=this._wwaData.objectAttribute[b][d.ATR_STRING];
this._player.getPosition().getPartsCoord();c=this._player.getStatus();var e;e=0+this._wwaData.objectAttribute[b][d.ATR_ENERGY]*c.energy;e+=this._wwaData.objectAttribute[b][d.ATR_STRENGTH]*c.strength;e+=this._wwaData.objectAttribute[b][d.ATR_DEFENCE]*c.defence;e+=this._wwaData.objectAttribute[b][d.ATR_GOLD]*c.gold;this._scoreWindow.update(e);this._scoreWindow.show();this.setMessageQueue(0===a?"\u30b9\u30b3\u30a2\u3092\u8868\u793a\u3057\u307e\u3059\u3002":this._wwaData.message[a],!1,!1);this.playSound(this._wwaData.objectAttribute[b][d.ATR_SOUND])};
c.prototype._execChoiceWindowRunningEvent=function(){var a;if(0===--this._yesNoDispCounter)if(this._yesNoJudge===wwa_data.YesNoState.YES){if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_MAP_PARTS)a=this._wwaData.mapAttribute[this._yesNoChoicePartsID][d.ATR_TYPE],a===d.MAP_URLGATE&&(location.href=wwa_util.$escapedURI(this._yesNoURL));else if(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS)if(a=this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_TYPE],
a===d.OBJECT_BUY)this._player.hasItem(this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_ITEM])?(this._player.removeItemByPartsID(this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_ITEM]),a=this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_GOLD],this._player.earnGold(a),this.setStatusChangedEffect(new wwa_data.Status(0,0,0,a)),this.appearParts(this._yesNoChoicePartsCoord,wwa_data.AppearanceTriggerType.OBJECT,this._yesNoChoicePartsID)):"BLANK"!==this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM]&&
this._messageQueue.push(new wwa_message.MessageInfo(""===this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM]?"\u30a2\u30a4\u30c6\u30e0\u3092\u3082\u3063\u3066\u3044\u306a\u3044\u3002":this._wwaData.message[wwa_data.SystemMessage1.NO_ITEM],!0));else if(a===d.OBJECT_SELL)if(this._player.hasGold(this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_GOLD]))if(this._player.canHaveMoreItems()){this._player.addItem(this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_ITEM]);a=new wwa_data.Status(this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_ENERGY],
this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_STRENGTH],this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_DEFENCE],-this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_GOLD]);this._player.getStatusWithoutEquipments();a.energy=a.energy>d.STATUS_MINUS_BORDER?d.STATUS_MINUS_BORDER-a.energy:a.energy;this.setStatusChangedEffect(a);this._player.addStatusAll(a);if(this._player.isDead()&&0!==this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_ENERGY]){this.gameover();
return}this.appearParts(this._yesNoChoicePartsCoord,wwa_data.AppearanceTriggerType.OBJECT,this._yesNoChoicePartsID)}else this._messageQueue.push(new wwa_message.MessageInfo("\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002",!0));else"BLANK"!==this._wwaData.message[wwa_data.SystemMessage1.NO_MONEY]&&this._messageQueue.push(new wwa_message.MessageInfo(""===this._wwaData.message[wwa_data.SystemMessage1.NO_MONEY]?"\u6240\u6301\u91d1\u304c\u8db3\u308a\u306a\u3044\u3002":
this._wwaData.message[wwa_data.SystemMessage1.NO_MONEY],!0));else a===d.OBJECT_SELECT?this.appearParts(this._yesNoChoicePartsCoord,wwa_data.AppearanceTriggerType.CHOICE_YES,this._yesNoChoicePartsID):a===d.OBJECT_URLGATE&&(location.href=wwa_util.$escapedURI(this._yesNoURL));else this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_ITEM_USE?this._player.readyToUseItem(this._yesNoUseItemPos):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_QUICK_LOAD?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_LOAD]).classList.remove("onpress"),
this._stopUpdateByLoadFlag=!0,this._loadType=wwa_data.LoadType.QUICK_LOAD):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_QUICK_SAVE?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_SAVE]).classList.remove("onpress"),this._quickSave()):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_RESTART_GAME?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.RESTART_GAME]).classList.remove("onpress"),this._stopUpdateByLoadFlag=!0,this._loadType=
wwa_data.LoadType.RESTART_GAME):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_GOTO_WWA&&(location.href=wwa_util.$escapedURI(d.WWA_HOME),wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.GOTO_WWA]).classList.remove("onpress"));this._yesNoJudge=wwa_data.YesNoState.UNSELECTED;this._setNextMessage();this._yesNoUseItemPos=this._yesNoChoicePartsID=this._yesNoChoicePartsCoord=void 0;this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.NONE;this._messageWindow.setYesNoChoice(!1)}else this._yesNoJudge===
wwa_data.YesNoState.NO&&(this._yesNoChoiceCallInfo!==wwa_data.ChoiceCallInfo.CALL_BY_MAP_PARTS&&(this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_OBJECT_PARTS?(a=this._wwaData.objectAttribute[this._yesNoChoicePartsID][d.ATR_TYPE],a!==d.OBJECT_BUY&&a!==d.OBJECT_SELL&&a===d.OBJECT_SELECT&&this.appearParts(this._yesNoChoicePartsCoord,wwa_data.AppearanceTriggerType.CHOICE_NO,this._yesNoChoicePartsID)):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_ITEM_USE?wwa_util.$id("item"+
(this._yesNoUseItemPos-1)).classList.remove("onpress"):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_QUICK_LOAD?wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_LOAD]).classList.remove("onpress"):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_QUICK_SAVE?wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.QUICK_SAVE]).classList.remove("onpress"):this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_RESTART_GAME?wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.RESTART_GAME]).classList.remove("onpress"):
this._yesNoChoiceCallInfo===wwa_data.ChoiceCallInfo.CALL_BY_GOTO_WWA&&wwa_util.$id(wwa_data.sidebarButtonCellElementID[wwa_data.SidebarButton.GOTO_WWA]).classList.remove("onpress")),this._yesNoJudge=wwa_data.YesNoState.UNSELECTED,this._setNextMessage(),this._yesNoUseItemPos=this._yesNoChoicePartsID=this._yesNoChoicePartsCoord=void 0,this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.NONE,this._messageWindow.setYesNoChoice(!1))};c.prototype.setMessageQueue=function(a,b,d,c,e,f,g){void 0===c&&(c=0);
void 0===e&&(e=wwa_data.PartsType.OBJECT);void 0===f&&(f=new r(0,0));void 0===g&&(g=!1);this._messageQueue=this._messageQueue.concat(this.getMessageQueueByRawMessage(a,c,e,f));this._lastMessage.isEndOfPartsEvent&&void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=void 0);if(0!==this._messageQueue.length){a=this._messageQueue.shift();for(c=0;c<a.macro.length;c++)this._execMacroListInNextFrame.push(a.macro[c]);this._lastMessage=
a;if(""!==a.message)return this._messageWindow.setMessage(a.message),this._messageWindow.setYesNoChoice(b),this._messageWindow.setPositionByPlayerPosition(0!==this._faces.length,this._scoreWindow.isVisible(),d,this._player.getPosition(),this._camera.getPosition()),this._player.setMessageWaiting(),!0;0===this._messageQueue.length?this._hideMessageWindow(g):this._setNextMessage()}return!1};c.prototype.getMessageQueueByRawMessage=function(a,b,d,c,e){void 0===e&&(e=!1);var f=a.split(/\n\<c\>/i)[0].split(/\<c\>/i)[0].replace(/\n\<p\>\n/ig,
"<P>").replace(/\n\<p\>/ig,"<P>").replace(/\<p\>\n/ig,"<P>").replace(/\<p\>/ig,"<P>");a=[];if(""!==f)for(var f=f.split(/\<p\>/ig),g=0;g<f.length;g++){for(var k=f[g].split("\n"),l=[],m=[],p=0;p<k.length;p++){var r=k[p].match(/(\$(?:[a-zA-Z_][a-zA-Z0-9_]*)\=(?:.*))/);null!==r&&2<=r.length?(r=wwa_message.parseMacro(this,b,d,c,r[1]),m.push(r)):k[p].match(/^\$/)||l.push(k[p])}a.push(new wwa_message.MessageInfo(l.join("\n"),e,g===f.length-1,m))}return a};c.prototype.appearParts=function(a,b,c){void 0===
c&&(c=0);var e=b===wwa_data.AppearanceTriggerType.CHOICE_NO?d.APPERANCE_PARTS_MIN_INDEX_NO:d.APPERANCE_PARTS_MIN_INDEX,f=b===wwa_data.AppearanceTriggerType.CHOICE_YES?d.APPERANCE_PARTS_MAX_INDEX_YES:d.APPERANCE_PARTS_MAX_INDEX,g,k,l,m;b===wwa_data.AppearanceTriggerType.MAP?(c=0===c?this._wwaData.map[a.y][a.x]:c,b=wwa_data.PartsType.MAP):(c=0===c?this._wwaData.mapObject[a.y][a.x]:c,b=wwa_data.PartsType.OBJECT);for(;e<=f;e++)if(k=d.ATR_APPERANCE_BASE+e*d.REL_ATR_APPERANCE_UNIT_LENGTH,g=k+d.REL_ATR_APPERANCE_ID,
l=k+d.REL_ATR_APPERANCE_X,m=k+d.REL_ATR_APPERANCE_Y,k+=d.REL_ATR_APPERANCE_TYPE,g=b===wwa_data.PartsType.MAP?this._wwaData.mapAttribute[c][g]:this._wwaData.objectAttribute[c][g],k=b===wwa_data.PartsType.MAP?this._wwaData.mapAttribute[c][k]:this._wwaData.objectAttribute[c][k],l=b===wwa_data.PartsType.MAP?this._wwaData.mapAttribute[c][l]:this._wwaData.objectAttribute[c][l],m=b===wwa_data.PartsType.MAP?this._wwaData.mapAttribute[c][m]:this._wwaData.objectAttribute[c][m],l===d.PLAYER_COORD?(l=this._player.getPosition().getPartsCoord().x,
this._player.resetEventExecutionInfo()):l>d.RELATIVE_COORD_LOWER&&(l=a.x+l-d.RELATIVE_COORD_BIAS),m===d.PLAYER_COORD?(m=this._player.getPosition().getPartsCoord().y,this._player.resetEventExecutionInfo()):m>d.RELATIVE_COORD_LOWER&&(m=a.y+m-d.RELATIVE_COORD_BIAS),0!==l||0!==m)try{if(new wwa_data.Position(this,l,m,0,0),k===wwa_data.PartsType.MAP){if(g>=this._wwaData.mapPartsMax)throw Error("\u80cc\u666f\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.map[m][l]=
g}else{if(g>=this._wwaData.objPartsMax)throw Error("\u7269\u4f53\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.mapObject[m][l]=g;this._replaceRandomObject(new r(l,m));l===this._player.getPosition().getPartsCoord().x&&m===this._player.getPosition().getPartsCoord().y&&this._player.setPartsAppearedFlag()}}catch(p){}};c.prototype.appearPartsByDirection=function(a,b,d){var c=this._player.getPosition().getPartsCoord(),e=this._player.getDir(),
f=wwa_data.vx[e],e=wwa_data.vy[e];this.appearPartsEval(c,(0<=f?"+":"-")+Math.abs(f)*a,(0<=e?"+":"-")+Math.abs(e)*a,b,d)};c.prototype.appearPartsEval=function(a,b,d,c,e){var f=this._player.getPosition().getPartsCoord();if("P"===b||"p"===b)b=f.x;else if("+"===b[0])b=a.x+parseInt(b.substr(1));else if("-"===b[0])b=a.x-parseInt(b.substr(1));else if(b=parseInt(b),isNaN(b))throw Error("\u5ea7\u6a19\u3068\u3057\u3066\u89e3\u91c8\u3067\u304d\u306a\u3044\u6587\u5b57\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002");
if("P"===d||"p"===d)a=f.y;else if("+"===d[0])a=a.y+parseInt(d.substr(1));else if("-"===d[0])a=a.y-parseInt(d.substr(1));else if(a=parseInt(d),isNaN(a))throw Error("\u5ea7\u6a19\u3068\u3057\u3066\u89e3\u91c8\u3067\u304d\u306a\u3044\u6587\u5b57\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002");try{if(new wwa_data.Position(this,b,a,0,0),e===wwa_data.PartsType.MAP){if(c>=this._wwaData.mapPartsMax)throw Error("\u80cc\u666f\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");
this._wwaData.map[a][b]=c}else{if(c>=this._wwaData.objPartsMax)throw Error("\u7269\u4f53\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.mapObject[a][b]=c;this._replaceRandomObject(new r(b,a));b===this._player.getPosition().getPartsCoord().x&&a===this._player.getPosition().getPartsCoord().y&&this._player.setPartsAppearedFlag()}}catch(g){}};c.prototype._replaceRandomObject=function(a){var b=this._wwaData.mapObject[a.y][a.x],c;if(this._wwaData.objectAttribute[b][d.ATR_TYPE]===
d.OBJECT_RANDOM){for(var e=0;e<d.RANDOM_ITERATION_MAX;e++){c=Math.floor(10*Math.random());c=this._wwaData.objectAttribute[b][d.ATR_RANDOM_BASE+c];if(c>=this._wwaData.objPartsMax){c=0;break}if(this._wwaData.objectAttribute[c][d.ATR_TYPE]!==d.OBJECT_RANDOM)break;b=c}this._wwaData.mapObject[a.y][a.x]=c}};c.prototype._replaceRandomObjectsInScreen=function(){for(var a=this._camera.getPosition().getPartsCoord(),b=Math.max(0,a.x-1),c=Math.min(this._wwaData.mapWidth-1,a.x+d.H_PARTS_NUM_IN_WINDOW),e=Math.max(0,
a.y-1),a=Math.min(this._wwaData.mapWidth-1,a.y+d.V_PARTS_NUM_IN_WINDOW);b<=c;b++)for(var f=e;f<a;f++)this._replaceRandomObject(new r(b,f))};c.prototype._replaceAllRandomObjects=function(){for(var a=0;a<this._wwaData.mapWidth;a++)for(var b=0;b<this._wwaData.mapWidth;b++)this._replaceRandomObject(new r(a,b))};c.prototype.gameover=function(){var a=this._wwaData.gameoverX,b=this._wwaData.gameoverY;this._messageWindow.isVisible()&&(this._yesNoJudge=wwa_data.YesNoState.UNSELECTED,this._messageQueue=[],
this._messageWindow.hide(),this._yesNoUseItemPos=this._yesNoChoicePartsID=this._yesNoChoicePartsCoord=void 0,this._yesNoChoiceCallInfo=wwa_data.ChoiceCallInfo.NONE,this._messageWindow.setYesNoChoice(!1));this._waitTimeInCurrentFrame=d.GAMEOVER_FRAME_INTERVAL;this._temporaryInputDisable=!0;this._player.jumpTo(new x(this,a,b,0,0))};c.prototype.setYesNoInput=function(a){this._yesNoJudgeInNextFrame=a};c.prototype.getYesNoState=function(){return void 0!==this._yesNoJudgeInNextFrame?this._yesNoJudgeInNextFrame:
this._yesNoJudge};c.prototype.setStatusChangedEffect=function(a){0!==a.strength&&(wwa_util.$id("disp-strength").classList.add("onpress"),this._statusPressCounter.strength=d.STATUS_CHANGED_EFFECT_FRAME_NUM);0!==a.defence&&(wwa_util.$id("disp-defence").classList.add("onpress"),this._statusPressCounter.defence=d.STATUS_CHANGED_EFFECT_FRAME_NUM);a instanceof wwa_data.Status&&(0!==a.energy&&(wwa_util.$id("disp-energy").classList.add("onpress"),this._statusPressCounter.energy=d.STATUS_CHANGED_EFFECT_FRAME_NUM),
0!==a.gold&&(wwa_util.$id("disp-gold").classList.add("onpress"),this._statusPressCounter.gold=d.STATUS_CHANGED_EFFECT_FRAME_NUM))};c.prototype.setPartsOnPosition=function(a,b,d){a===wwa_data.PartsType.MAP?(b>=this._wwaData.mapPartsMax&&(this._wwaData.map[d.y][d.x]=0),this._wwaData.map[d.y][d.x]=b):(b>=this._wwaData.objPartsMax&&(this._wwaData.mapObject[d.y][d.x]=0),this._wwaData.mapObject[d.y][d.x]=b)};c.prototype._quickSave=function(){var a=JSON.parse(JSON.stringify(this._wwaData)),b=this._player.getPosition().getPartsCoord(),
d=this._player.getStatusWithoutEquipments();a.itemBox=this._player.getCopyOfItemBox();a.playerX=b.x;a.playerY=b.y;a.statusEnergyMax=this._player.getEnergyMax();a.statusEnergy=d.energy;a.statusStrength=d.strength;a.statusDefence=d.defence;a.statusGold=d.gold;a.moves=this._player.getMoveCount();this._quickSaveData=a};c.prototype._quickLoad=function(a){void 0===a&&(a=!1);if(!a&&void 0===this._quickSaveData)throw Error("\u30bb\u30fc\u30d6\u30c7\u30fc\u30bf\u304c\u3042\u308a\u307e\u305b\u3093\u3002");
a=JSON.parse(JSON.stringify(a?this._restartData:this._quickSaveData));this._player.setEnergyMax(a.statusEnergyMax);this._player.setEnergy(a.statusEnergy);this._player.setStrength(a.statusStrength);this._player.setDefence(a.statusDefence);this._player.setGold(a.statusGold);this._player.setMoveCount(a.moves);this._player.clearItemBox();for(var b=0;b<a.itemBox.length;b++)this._player.addItem(a.itemBox[b],b+1,!0);this._player.systemJumpTo(new wwa_data.Position(this,a.playerX,a.playerY,0,0));0===a.bgm?
this.playSound(wwa_data.SystemSound.NO_SOUND):this.playSound(a.bgm);this.setImgClick(new r(a.imgClickX,a.imgClickY));0!==this.getObjectIdByPosition(this._player.getPosition())&&this._player.setPartsAppearedFlag();this._wwaData=a;this.updateCSSRule()};c.prototype._restartGame=function(){this._quickLoad(!0)};c.prototype._fadeout=function(a){var b=0,c=d.MAP_WINDOW_WIDTH,e=d.FADEOUT_SPEED,f=wwa_util.$id("wwa-fader");f.style.display="block";var g=setInterval(function(){b+=e;c-=2*e;0>=c||2*b>d.MAP_WINDOW_WIDTH?
(f.removeAttribute("style"),f.style.display="block",f.style.borderWidth="0",f.style.width=d.MAP_WINDOW_WIDTH+"px",f.style.height=d.MAP_WINDOW_HEIGHT+"px",f.style.backgroundColor="#808080",clearInterval(g),a()):(f.style.width=c+"px",f.style.height=c+"px",f.style.borderWidth=b+"px")},20)};c.prototype.moveObjects=function(a){var b=this._camera.getPosition();this._player.getPosition();b.getPartsCoord();var c=b.getPartsCoord().x,b=b.getPartsCoord().y,e,f,g;if(this.getMapAttributeByPosition(this._player.getPosition(),
d.ATR_TYPE)!==d.MAP_LOCALGATE&&this.getObjectAttributeByPosition(this._player.getPosition(),d.ATR_TYPE)!==d.OBJECT_LOCALGATE){e=Array(d.V_PARTS_NUM_IN_WINDOW+2);this.hoge=Array(d.V_PARTS_NUM_IN_WINDOW+2);for(g=-1;g<=d.V_PARTS_NUM_IN_WINDOW;g++)for(e[g+1]=Array(d.H_PARTS_NUM_IN_WINDOW+2),this.hoge[g+1]=Array(d.H_PARTS_NUM_IN_WINDOW+2),f=-1;f<=d.H_PARTS_NUM_IN_WINDOW;f++)if(0>b+g||b+g>=this._wwaData.mapWidth||0>c+f||c+f>=this._wwaData.mapWidth)e[g+1][f+1]=0,this.hoge[g+1][f+1]=0;else{try{var k=new x(this,
c+f,b+g,0,0),l=k.getPartsCoord()}catch(m){e[g+1][f+1]=0;this.hoge[g+1][f+1]=0;continue}e[g+1][f+1]=this._wwaData.mapObject[l.y][l.x];this.hoge[g+1][f+1]=-this._wwaData.mapObject[l.y][l.x]}for(f=-1;f<=d.H_PARTS_NUM_IN_WINDOW;f++)if(!(0>c+f||c+f>=this._wwaData.mapWidth))for(g=-1;g<=d.V_PARTS_NUM_IN_WINDOW;g++)if(!(0>b+g||b+g>=this._wwaData.mapWidth)){try{k=new x(this,c+f,b+g,0,0),l=k.getPartsCoord()}catch(p){continue}var w=this._wwaData.mapObject[l.y][l.x];if(0!==w&&this._wwaData.objectAttribute[w][d.ATR_MOVE]!==
wwa_data.MoveType.STATIC&&this._wwaData.objectAttribute[w][d.ATR_TYPE]!==d.OBJECT_LOCALGATE){var u=this._wwaData.objectAttribute[w][d.ATR_MOVE];if(u!==wwa_data.MoveType.HANG_AROUND){var t=this._getCandidateCoord(a,k,u),v=new r(t.x,l.y),y=new r(l.x,t.y),z=null;this._objectCanMoveTo(a,t,e)?this._setObjectsInNextFrame(l,t,c,b,e,w):(z=this._getSecondCandidateMoveMode(a,l,t,v,y,this._wwaData.objectAttribute[w][d.ATR_TYPE]===d.OBJECT_MONSTER,e),z===wwa_data.SecondCandidateMoveType.MODE_X?this._setObjectsInNextFrame(l,
v,c,b,e,w):z===wwa_data.SecondCandidateMoveType.MODE_Y?this._setObjectsInNextFrame(l,y,c,b,e,w):(z=this._getThirdCandidate(a,k,t,u,e),null!==z?this._setObjectsInNextFrame(l,z,c,b,e,w):(u=this._getRandomMoveCoord(a,k,e),this._setObjectsInNextFrame(l,u,c,b,e,w))))}else u=this._getRandomMoveCoord(a,k,e),this._setObjectsInNextFrame(l,u,c,b,e,w)}}}};c.prototype._getCandidateCoord=function(a,b,d){b=b.getPartsCoord();this._player.getPosition().getOffsetCoord();this._player.getPosition().getPartsCoord();
try{var c=a?this._player.getPosition().getNextJustPosition().getPartsCoord():this._player.getPosition().getPartsCoord()}catch(e){throw Error("\u4e88\u671f\u305b\u306c\u65b9\u5411\u3078\u306e\u79fb\u52d5\u306e\u3088\u3046\u3067\u3059\u3002");}a=b.clone();var f=0,g=0;d===wwa_data.MoveType.CHASE_PLAYER?(f=b.x>c.x?1:b.x<c.x?-1:0,g=b.y>c.y?1:b.y<c.y?-1:0):d===wwa_data.MoveType.RUN_OUT&&(f=b.x>c.x?-1:b.x<c.x?1:0,g=b.y>c.y?-1:b.y<c.y?1:0);a.x-=f;a.y-=g;a.x=Math.min(this._wwaData.mapWidth-1,Math.max(0,a.x));
a.y=Math.min(this._wwaData.mapWidth-1,Math.max(0,a.y));return a};c.prototype._getSecondCandidateMoveMode=function(a,b,d,c,e,f,g){return!a||(this._player.getDir()!==wwa_data.Direction.UP&&this._player.getDir()!==wwa_data.Direction.DOWN||!f)&&(this._player.getDir()!==wwa_data.Direction.LEFT&&this._player.getDir()!==wwa_data.Direction.RIGHT||f)?this._objectCanMoveTo(a,c,g)?wwa_data.SecondCandidateMoveType.MODE_X:this._objectCanMoveTo(a,e,g)?wwa_data.SecondCandidateMoveType.MODE_Y:wwa_data.SecondCandidateMoveType.UNDECIDED:
this._objectCanMoveTo(a,e,g)?wwa_data.SecondCandidateMoveType.MODE_Y:this._objectCanMoveTo(a,c,g)?wwa_data.SecondCandidateMoveType.MODE_X:wwa_data.SecondCandidateMoveType.UNDECIDED};c.prototype._getThirdCandidate=function(a,b,d,c,e){c=c===wwa_data.MoveType.CHASE_PLAYER?1:c===wwa_data.MoveType.RUN_OUT?-1:0;var f=a?this._player.getPosition().getNextJustPosition().getPartsCoord():this._player.getPosition().getPartsCoord();b=b.getPartsCoord();var g;if(f.x!==b.x){g=new r(d.x,b.y+1*c);if(this._objectCanMoveTo(a,
g,e))return g;g=new r(d.x,b.y-1*c);if(this._objectCanMoveTo(a,g,e))return g;g=new r(b.x,b.y+1*c);if(this._objectCanMoveTo(a,g,e))return g;g=new r(b.x,b.y-1*c);if(this._objectCanMoveTo(a,g,e))return g}if(f.y!==b.y){g=new r(b.x+1*c,d.y);if(this._objectCanMoveTo(a,g,e))return g;g=new r(b.x-1*c,d.y);if(this._objectCanMoveTo(a,g,e))return g;g=new r(b.x+1*c,b.y);if(this._objectCanMoveTo(a,g,e))return g;g=new r(b.x-1*c,b.y);if(this._objectCanMoveTo(a,g,e))return g}return null};c.prototype._getRandomMoveCoord=
function(a,b,c){b=b.getPartsCoord();for(var e=b.clone(),f=0;f<d.RANDOM_MOVE_ITERATION_NUM;f++){var g=Math.floor(8*Math.random());e.x=b.x+wwa_data.vx[g];e.y=b.y+wwa_data.vy[g];if(this._objectCanMoveTo(a,e,c))return e}return b};c.prototype.isPrevFrameEventExecuted=function(){return this._prevFrameEventExected};c.prototype._objectCanMoveTo=function(a,b,c){if(0>b.x||0>b.y||this._wwaData.mapWidth<=b.x||this._wwaData.mapWidth<=b.y)return!1;var e=this._wwaData.map[b.y][b.x],f=this._wwaData.mapObject[b.y][b.x],
g=this._wwaData.mapAttribute[e][d.ATR_TYPE],k=this._camera.getPosition(),l=k.getPartsCoord().x,k=k.getPartsCoord().y;if(0===e&&!this.isOldMap()||g===d.MAP_WALL)return!1;e=b.x-l+1;g=b.y-k+1;if(0<=e&&0<=g&&e<c.length&&g<c.length){if(0!==c[g][e])return!1}else if(0!==f)return!1;if(a){if(this._player.getPosition().getNextJustPosition().getPartsCoord().equals(b))return!1}else if(this._player.getPosition().getPartsCoord().equals(b))return!1;return!0};c.prototype._setObjectsInNextFrame=function(a,b,c,d,e,
f){var g=b.x-c+1,k=b.y-d+1;0<=b.x&&b.x<=this._wwaData.mapWidth&&0<=b.y&&b.y<=this._wwaData.mapWidth&&(0<=g&&g<e.length&&0<=k&&k<e.length&&(e[a.y-d+1][a.x-c+1]=0,e[b.y-d+1][b.x-c+1]=f,this.hoge[b.y-d+1][b.x-c+1]=f),this._objectMovingDataManager.add(f,a.convertIntoPosition(this),b.convertIntoPosition(this),a.getDirectionTo(b)))};c.prototype.launchBattleEstimateWindow=function(){var a=this._camera.getPosition().getPartsCoord(),b=Math.max(0,a.x),c=Math.min(this._wwaData.mapWidth-1,a.x+d.H_PARTS_NUM_IN_WINDOW-
1),e=Math.max(0,a.y),a=Math.min(this._wwaData.mapWidth-1,a.y+d.V_PARTS_NUM_IN_WINDOW)-1,f=[];for(this.playSound(wwa_data.SystemSound.DECISION);b<=c;b++)for(var g=e;g<=a;g++){var k=this._wwaData.mapObject[g][b];this._wwaData.objectAttribute[k][d.ATR_TYPE]===d.OBJECT_MONSTER&&-1===f.indexOf(k)&&f.push(k)}if(0===f.length)return!1;this._battleEstimateWindow.update(this._player.getStatus(),f);this._battleEstimateWindow.show();this._player.setEstimateWindowWating();return!0};c.prototype.hideBattleEstimateWindow=
function(){this._battleEstimateWindow.hide();this._player.clearEstimateWindowWaiting()};c.prototype._displayHelp=function(){this._player.isControllable()&&this.setMessageQueue("\u3010\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30ad\u30fc\u306e\u4e00\u89a7\u3011\n\uff26\uff11\u3001\uff2d\uff1a\u6226\u95d8\u7d50\u679c\u4e88\u6e2c\u306e\u8868\u793a\n\uff26\uff15\uff1a\u4e00\u6642\u4fdd\u5b58\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u8fbc\u307f\n\uff26\uff16\uff1a\u30c7\u30fc\u30bf\u306e\u4e00\u6642\u4fdd\u5b58\n\uff26\uff17\uff1a\u521d\u3081\u304b\u3089\u30b9\u30bf\u30fc\u30c8\n\uff26\uff18\uff1a\uff37\uff37\uff21\u516c\u5f0f\u30da\u30fc\u30b8\u306b\u30ea\u30f3\u30af\n\uff26\uff11\uff12\uff1a\u3053\u306e\u30ea\u30b9\u30c8\u306e\u8868\u793a\n\u30ad\u30fc\u30dc\u30fc\u30c9\u306e\u300c\uff11\uff12\uff13\u3001\uff31\uff37\uff25\u3001\uff21\uff33\uff24\u3001\uff3a\uff38\uff23\u300d\u306f\u53f3\u306e\u30a2\u30a4\u30c6\u30e0\u30dc\u30c3\u30af\u30b9\u306b\u5bfe\u5fdc\u3002\n\u300c\uff25\uff4e\uff54\uff45\uff52\u3001\uff39\u300d\u306f\uff39\uff45\uff53,\u300c\uff25\uff53\uff43\u3001\uff2e\u300d\u306f\uff2e\uff4f\u306b\u5bfe\u5fdc\u3002\n I : \u79fb\u52d5\u901f\u5ea6\u3092\u843d\u3068\u3059\uff0f\uff30: \u79fb\u52d5\u901f\u5ea6\u3092\u4e0a\u3052\u308b\n\u73fe\u5728\u306e\u79fb\u52d5\u56de\u6570\uff1a"+
this._player.getMoveCount()+"\nWWA Wing \u30d0\u30fc\u30b8\u30e7\u30f3:"+d.VERSION_WWAJS,!1,!0)};c.prototype._setNextMessage=function(a){void 0===a&&(a=!1);this._clearFacesInNextFrame=!0;this._scoreWindow.isVisible()&&this._scoreWindow.hide();this._lastMessage.isEndOfPartsEvent&&void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=void 0);if(0===this._messageQueue.length)this._hideMessageWindow();else{var b=this._messageQueue.shift(),
c=b.message,d=b.macro;this._lastMessage=b;for(b=0;b<d.length;b++)this._execMacroListInNextFrame.push(d[b]);""!==c?(this._messageWindow.hide(),this._messageWindow.setMessage(c),this._messageWindow.setPositionByPlayerPosition(0!==this._faces.length,this._scoreWindow.isVisible(),a,this._player.getPosition(),this._camera.getPosition()),this._messageWindow.show()):0===this._messageQueue.length?this._hideMessageWindow():this._setNextMessage()}};c.prototype._hideMessageWindow=function(a){void 0===a&&(a=
!0);var b=0;this._player.isReadyToUseItem()&&(b=this._player.useItem());var c=this.getObjectAttributeById(b,d.ATR_STRING);this.clearFaces();0===c?(a&&(this._messageWindow.hide(),this._keyStore.allClear(),this._mouseStore.clear()),this._player.clearMessageWaiting()):this.setMessageQueue(this.getMessageById(c),!1,!1,b,wwa_data.PartsType.OBJECT,this._player.getPosition().getPartsCoord(),!0)};c.prototype.replaceParts=function(a,b,c,e){void 0===c&&(c=wwa_data.PartsType.OBJECT);void 0===e&&(e=!1);var f=
this._camera.getPosition().getPartsCoord(),g=e?Math.max(0,f.x):0,k=e?Math.min(this._wwaData.mapWidth-1,f.x+d.H_PARTS_NUM_IN_WINDOW-1):this._wwaData.mapWidth-1,l=e?Math.max(0,f.y):0;for(e=e?Math.min(this._wwaData.mapWidth-1,f.y+d.V_PARTS_NUM_IN_WINDOW)-1:this._wwaData.mapWidth-1;g<=k;g++)for(f=l;f<=e;f++)if(c===wwa_data.PartsType.OBJECT){var m=this._wwaData.mapObject[f][g];m===a&&(this._wwaData.mapObject[f][g]=b)}else m=this._wwaData.map[f][g],m===a&&(this._wwaData.map[f][g]=b)};c.prototype.getYesNoImgCoord=
function(){return new r(this._wwaData.yesnoImgPosX,this._wwaData.yesnoImgPosY)};c.prototype.setYesNoImgCoord=function(a){this._wwaData.yesnoImgPosX=a.x;this._wwaData.yesnoImgPosY=a.y;return a};c.prototype.getPlayerImgCoord=function(){return new r(this._wwaData.playerImgPosX,this._wwaData.playerImgPosY)};c.prototype.setPlayerImgCoord=function(a){this._wwaData.playerImgPosX=a.x;this._wwaData.playerImgPosY=a.y;return a};c.prototype.setPlayerEnergyMax=function(a){return this._player.setEnergyMax(a)};
c.prototype.getMapPartsNum=function(){return this._wwaData.mapPartsMax};c.prototype.getObjectPartsNum=function(){return this._wwaData.objPartsMax};c.prototype.setMoveMacroWaitingToPlayer=function(a){this._reservedMoveMacroTurn=a};c.prototype.disableSave=function(a){return this._wwaData.disableSaveFlag=a};c.prototype.isOldMap=function(){return this._wwaData.isOldMap};c.prototype.setOldMap=function(a){return this._wwaData.isOldMap=a};c.prototype.setObjectNotCollapseOnPartsOnPlayer=function(a){return this._wwaData.objectNoCollapseDefaultFlag=
a};c.prototype.setGameOverPosition=function(a){if(0>a.x||a.x>=this.getMapWidth()||0>a.y||a.y>=this.getMapWidth())throw Error("\u30de\u30c3\u30d7\u306e\u7bc4\u56f2\u5916\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059!");this._wwaData.gameoverX=a.x;this._wwaData.gameoverY=a.y;return a};c.prototype.setPlayerStatus=function(a,b){if(a===wwa_data.MacroStatusIndex.ENERGY)this._player.setEnergy(b);else if(a===wwa_data.MacroStatusIndex.STRENGTH)this._player.setStrength(b);else if(a===wwa_data.MacroStatusIndex.DEFENCE)this._player.setDefence(b);
else if(a===wwa_data.MacroStatusIndex.GOLD)this._player.setGold(b);else if(a===wwa_data.MacroStatusIndex.MOVES)this._player.setMoveCount(b);else throw Error("\u672a\u5b9a\u7fa9\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u30bf\u30a4\u30d7\u3067\u3059");};c.prototype.setDelPlayer=function(a){return this._wwaData.delPlayerFlag=a};c.prototype.setPlayerGetItem=function(a,b){try{this._player.addItem(b,a,!0)}catch(c){}};c.prototype.setFrameCoord=function(a){return this._frameCoord=a.clone()};c.prototype.setBattleEffectCoord=
function(a){return this._battleEffectCoord=a.clone()};c.prototype.canInput=function(){return!this._temporaryInputDisable};c.prototype.setWaitTime=function(a){this._waitTimeInCurrentFrame+=a;this._temporaryInputDisable=!0};c.prototype.setEffect=function(a,b){this._wwaData.effectWaits=a;this._wwaData.effectCoords=b};c.prototype.stopEffect=function(){this._wwaData.effectCoords=[]};c.prototype.setImgClick=function(a){this._wwaData.imgClickX=a.x;this._wwaData.imgClickY=a.y;if(a.equals(new r(0,0)))Array.prototype.forEach.call(wwa_util.$qsAll(".item-cell>.item-click-border"),
function(a){a.style.backgroundImage="url('"+wwa_data.WWAConsts.ITEM_BORDER_IMG_DATA_URL+"')";a.style.backgroundPosition="0 0"});else{var b=this._wwaData.mapCGName.replace("(","\\(").replace(")","\\)");Array.prototype.forEach.call(wwa_util.$qsAll(".item-cell>.item-click-border"),function(c){c.style.backgroundImage="url('"+b+"')";c.style.backgroundPosition="-"+a.x*d.CHIP_SIZE+"px -"+a.y*d.CHIP_SIZE+"px"})}};c.prototype.addFace=function(a){this._faces.push(a)};c.prototype.clearFaces=function(){this._faces=
[]};c.prototype.initCSSRule=function(){console.log(this);this._styleElm=wwa_util.$id(d.WWA_STYLE_TAG_ID);this._sheet=this._styleElm.sheet;this.updateCSSRule()};c.prototype.updateCSSRule=function(){if(void 0===this._stylePos)this._stylePos=Array(2);else if(void 0!==this._sheet.addRule)for(var a=0;a<this._stylePos.length;a++)this._sheet.removeRule(this._stylePos[this._styleElm[a]]);else for(a=0;a<this._stylePos.length;a++)this._sheet.deleteRule(this._stylePos[this._styleElm[a]]);void 0!==this._sheet.addRule?
(this._stylePos[wwa_data.SelectorType.MESSAGE_WINDOW]=this._sheet.addRule("div.wwa-message-window, div#wwa-battle-estimate","background-color: rgba("+this._wwaData.frameColorR+","+this._wwaData.frameColorG+","+this._wwaData.frameColorB+",0.9);border-color: rgba("+this._wwaData.frameOutColorR+","+this._wwaData.frameOutColorG+","+this._wwaData.frameOutColorB+",1);color: rgba("+this._wwaData.fontColorR+","+this._wwaData.fontColorG+","+this._wwaData.fontColorB+",1);"),this._stylePos[wwa_data.SelectorType.SIDEBAR]=
this._sheet.addRule("div#wwa-sidebar","color: rgba("+this._wwaData.statusColorR+","+this._wwaData.statusColorG+","+this._wwaData.statusColorB+",1);font-weight: bold;")):(this._stylePos[wwa_data.SelectorType.MESSAGE_WINDOW]=this._sheet.insertRule("div.wwa-message-window, div#wwa-battle-estimate {\nbackground-color: rgba("+this._wwaData.frameColorR+","+this._wwaData.frameColorG+","+this._wwaData.frameColorB+",0.9);\nborder-color: rgba("+this._wwaData.frameOutColorR+","+this._wwaData.frameOutColorG+
","+this._wwaData.frameOutColorB+",1);\ncolor: rgba("+this._wwaData.fontColorR+","+this._wwaData.fontColorG+","+this._wwaData.fontColorB+",1);\n}",0),this._stylePos[wwa_data.SelectorType.SIDEBAR]=this._sheet.insertRule("div#wwa-sidebar {\ncolor: rgba("+this._wwaData.statusColorR+","+this._wwaData.statusColorG+","+this._wwaData.statusColorB+",1);\nfont-weight: bold;\n}",1))};c.prototype.changeStyleRule=function(a,b,c,d){a===wwa_data.ChangeStyleType.COLOR_FRAME?(this._wwaData.frameColorR=b,this._wwaData.frameColorG=
c,this._wwaData.frameColorB=d):a===wwa_data.ChangeStyleType.COLOR_FRAMEOUT?(this._wwaData.frameOutColorR=b,this._wwaData.frameOutColorG=c,this._wwaData.frameOutColorB=d):a===wwa_data.ChangeStyleType.COLOR_STR?(this._wwaData.fontColorR=b,this._wwaData.fontColorG=c,this._wwaData.fontColorB=d):a===wwa_data.ChangeStyleType.COLOR_STATUS_STR&&(this._wwaData.statusColorR=b,this._wwaData.statusColorG=c,this._wwaData.statusColorB=d);this.updateCSSRule()};c.prototype.showMonsterWindow=function(){this._monsterWindow.show()};
c.prototype.isConsoleOutputMode=function(){return this._useConsole};return c}();c.WWA=v;var y=!1;"complete"===document.readyState?k():window.addEventListener("load",k)})(wwa_main||(wwa_main={}));
