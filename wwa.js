var wwa_input;
(function(e){(function(d){d[d.NONE=0]="NONE";d[d.KEYDOWN=1]="KEYDOWN";d[d.KEYPRESS=2]="KEYPRESS";d[d.KEYUP=3]="KEYUP";d[d.KEYPRESS_MESSAGECHANGE=4]="KEYPRESS_MESSAGECHANGE"})(e.KeyState||(e.KeyState={}));(function(d){d[d.KEY_ENTER=13]="KEY_ENTER";d[d.KEY_SHIFT=16]="KEY_SHIFT";d[d.KEY_ESC=27]="KEY_ESC";d[d.KEY_SPACE=32]="KEY_SPACE";d[d.KEY_LEFT=37]="KEY_LEFT";d[d.KEY_UP=38]="KEY_UP";d[d.KEY_RIGHT=39]="KEY_RIGHT";d[d.KEY_DOWN=40]="KEY_DOWN";d[d.KEY_1=49]="KEY_1";d[d.KEY_2=50]="KEY_2";d[d.KEY_3=51]=
"KEY_3";d[d.KEY_A=65]="KEY_A";d[d.KEY_C=67]="KEY_C";d[d.KEY_D=68]="KEY_D";d[d.KEY_E=69]="KEY_E";d[d.KEY_I=73]="KEY_I";d[d.KEY_M=77]="KEY_M";d[d.KEY_N=78]="KEY_N";d[d.KEY_P=80]="KEY_P";d[d.KEY_Q=81]="KEY_Q";d[d.KEY_S=83]="KEY_S";d[d.KEY_W=87]="KEY_W";d[d.KEY_X=88]="KEY_X";d[d.KEY_Y=89]="KEY_Y";d[d.KEY_Z=90]="KEY_Z";d[d.KEY_F1=112]="KEY_F1";d[d.KEY_F3=114]="KEY_F3";d[d.KEY_F4=115]="KEY_F4";d[d.KEY_F5=116]="KEY_F5";d[d.KEY_F6=117]="KEY_F6";d[d.KEY_F7=118]="KEY_F7";d[d.KEY_F8=119]="KEY_F8";d[d.KEY_F12=
123]="KEY_F12"})(e.KeyCode||(e.KeyCode={}));var c=function(){function d(){var c;this._nextKeyState=Array(d.KEY_BUFFER_MAX);this._keyState=Array(d.KEY_BUFFER_MAX);this._prevKeyState=Array(d.KEY_BUFFER_MAX);this._prevKeyStateOnControllable=Array(d.KEY_BUFFER_MAX);this._keyInputContinueFrameNum=Array(d.KEY_BUFFER_MAX);for(c=0;c<d.KEY_BUFFER_MAX;c++)this._nextKeyState[c]=!1,this._keyState[c]=!1,this._prevKeyState[c]=!1,this._prevKeyStateOnControllable[c]=!1,this._keyInputContinueFrameNum[c]=0}d.prototype.checkHitKey=
function(c){c=this.getKeyState(c);return 1===c||2===c};d.prototype.getKeyState=function(c){return this._prevKeyState[c]?this._keyState[c]?2:3:this._keyState[c]?1:0};d.prototype.getKeyStateForControllPlayer=function(c){return this._prevKeyStateOnControllable[c]?this._keyState[c]?2:3:this._keyState[c]?1:0};d.prototype.getKeyStateForMessageCheck=function(c){return this._prevKeyState[c]?this._keyState[c]?this._keyInputContinueFrameNum[c]>=wwa_data.WWAConsts.KEYPRESS_MESSAGE_CHANGE_FRAME_NUM?4:2:3:this._keyState[c]?
1:0};d.prototype.setPressInfo=function(c){this._nextKeyState[c]=!0;this._keyInputContinueFrameNum[c]=-1};d.prototype.setReleaseInfo=function(c){this._nextKeyState[c]=!1;this._keyInputContinueFrameNum[c]=-1};d.prototype.update=function(){var c;this._prevKeyState=this._keyState.slice();this._keyState=this._nextKeyState.slice();for(c=0;c<d.KEY_BUFFER_MAX;c++)this._keyState[c]&&this._keyInputContinueFrameNum[c]++};d.prototype.memorizeKeyStateOnControllableFrame=function(){this._prevKeyStateOnControllable=
this._keyState.slice()};d.prototype.allClear=function(){var c;this._nextKeyState=Array(d.KEY_BUFFER_MAX);for(c=0;c<d.KEY_BUFFER_MAX;c++)this._nextKeyState[c]=!1};d.KEY_BUFFER_MAX=256;return d}();e.KeyStore=c;(function(c){c[c.NONE=0]="NONE";c[c.MOUSEDOWN=1]="MOUSEDOWN";c[c.MOUSEPRESS=2]="MOUSEPRESS";c[c.MOUSEUP=3]="MOUSEUP"})(e.MouseState||(e.MouseState={}));c=function(){function c(){this._nextMouseState=this._mouseState=this._prevMouseState=!1}c.prototype.checkClickMouse=function(c){c=void 0!==c?
this.getMouseState(c):this.getMouseState();return 1===c||2===c};c.prototype.getMouseState=function(c){return void 0!==c&&this._inputDir!==c?0:this._prevMouseState?this._mouseState?2:3:this._mouseState?1:0};c.prototype.getMouseStateForControllPlayer=function(c){return void 0!==c&&this._inputDir!==c?0:this._prevMouseStateOnControllable?this._mouseState?2:3:this._mouseState?1:0};c.prototype.setPressInfo=function(c,d){this._nextMouseState=!0;this._inputDir=c;this._touchID=d};c.prototype.setReleaseInfo=
function(){this._touchID=void 0;this._nextMouseState=!1};c.prototype.memorizeMouseStateOnControllableFrame=function(){this._prevMouseStateOnControllable=this._mouseState};c.prototype.update=function(){this._prevMouseState=this._mouseState;this._mouseState=this._nextMouseState};c.prototype.clear=function(){this._nextMouseState=!1};c.prototype.getTouchID=function(){return this._touchID};return c}();e.MouseStore=c})(wwa_input||(wwa_input={}));
var __extends=this.__extends||function(e,c){function d(){this.constructor=e}for(var l in c)c.hasOwnProperty(l)&&(e[l]=c[l]);d.prototype=c.prototype;e.prototype=new d},wwa_data;
(function(e){var c=function(){function a(b,a){this.strength=b;this.defence=a}a.prototype.add=function(b){this.strength+=b.strength;this.defence+=b.defence;return this};a.prototype.plus=function(b){return new a(this.strength+b.strength,this.defence+b.defence)};a.prototype.minus=function(b){return new a(this.strength-b.strength,this.defence-b.defence)};a.prototype.equals=function(b){return this.strength===b.strength&&this.defence===b.defence};return a}();e.EquipmentStatus=c;c=function(a){function b(b,
c,d,e){this.energy=b;this.gold=e;a.call(this,c,d)}__extends(b,a);b.prototype.add=function(a){a instanceof b&&(this.energy+=a.energy,this.gold+=a.gold);this.strength+=a.strength;this.defence+=a.defence;return this};b.prototype.plus=function(a){return a instanceof b?new b(this.energy+a.energy,this.strength+a.strength,this.defence+a.defence,this.gold+a.gold):new b(this.energy,this.strength+a.strength,this.defence+a.defence,this.gold)};b.prototype.minus=function(a){return a instanceof b?new b(this.energy-
a.energy,this.strength-a.strength,this.defence-a.defence,this.gold-a.gold):new b(this.energy,this.strength-a.strength,this.defence-a.defence,this.gold)};b.prototype.equals=function(b){return this.energy===b.energy&&this.strength===b.strength&&this.defence===b.defence&&this.gold===b.gold};return b}(c);e.Status=c;var d=function(){function a(b,a){void 0===b&&(b=0);void 0===a&&(a=0);this.x=b;this.y=a}a.prototype.equals=function(b){return this.x===b.x&&this.y===b.y};a.prototype.substract=function(b){return new a(this.x-
b.x,this.y-b.y)};a.prototype.clone=function(){return new a(this.x,this.y)};a.prototype.convertIntoPosition=function(b){return new l(b,this.x,this.y,0,0)};a.prototype.getDirectionTo=function(b){return this.x<b.x?this.y>b.y?7:this.y===b.y?1:6:this.x===b.x?this.y>b.y?3:this.y===b.y?8:2:this.y>b.y?5:this.y===b.y?0:4};return a}();e.Coord=d;var l=function(){function a(b,a,c,p,e){void 0===p&&(p=0);void 0===e&&(e=0);this._wwa=b;if(void 0===this._wwa)throw Error("WWA\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u304c\u5b58\u5728\u3057\u307e\u305b\u3093. ");
b=this._wwa.getMapWidth();if(0>a||a>=b||a>=b-1&&0<p||0>c||c>=b||c>=b-1&&0<e)throw Error("\u7bc4\u56f2\u5916\u306e\u5ea7\u6a19\u3067\u3059!! parts:("+a+", "+c+"), offset:("+p+", "+e+"), mapWidth = "+b);this._partsCoord=new d(a,c);this._offsetCoord=new d(p,e)}a.prototype.getPartsCoord=function(){return this._partsCoord};a.prototype.getOffsetCoord=function(){return this._offsetCoord};a.prototype.getScreenTopPosition=function(){return new a(this._wwa,Math.floor(this._partsCoord.x/(g.H_PARTS_NUM_IN_WINDOW-
1))*(g.H_PARTS_NUM_IN_WINDOW-1),Math.floor(this._partsCoord.y/(g.V_PARTS_NUM_IN_WINDOW-1))*(g.V_PARTS_NUM_IN_WINDOW-1),0,0)};a.prototype.getNextJustPosition=function(b){if(void 0!==b){var k=this._partsCoord;return new a(this._wwa,k.x+e.vx[b],k.y+e.vy[b],0,0)}b=this._partsCoord.x;k=this._partsCoord.y;0>this._offsetCoord.x?b--:0<this._offsetCoord.x&&b++;0>this._offsetCoord.y?k--:0<this._offsetCoord.y&&k++;return new a(this._wwa,b,k,0,0)};a.prototype.getNextFramePosition=function(b,k,c){var d=this._partsCoord.x,
h=this._partsCoord.y;k=this._offsetCoord.x+e.vx[b]*k;b=this._offsetCoord.y+e.vy[b]*c;0>k&&(c=Math.floor(Math.abs(k)/g.CHIP_SIZE),d-=c,k=(k+c*g.CHIP_SIZE)%g.CHIP_SIZE);0>b&&(c=Math.floor(Math.abs(b)/g.CHIP_SIZE),h-=c,b=(b+c*g.CHIP_SIZE)%g.CHIP_SIZE);k>=g.CHIP_SIZE&&(d+=Math.floor(k/g.CHIP_SIZE),k=(k+g.CHIP_SIZE)%g.CHIP_SIZE);b>=g.CHIP_SIZE&&(h+=Math.floor(b/g.CHIP_SIZE),b=(b+g.CHIP_SIZE)%g.CHIP_SIZE);return new a(this._wwa,d,h,k,b)};a.prototype.isJustPosition=function(){return 0==this._offsetCoord.x&&
0==this._offsetCoord.y};a.prototype.isScreenTopPosition=function(){var b=this.getScreenTopPosition();return this.equals(b)};a.prototype.equals=function(b){return this._partsCoord.equals(b.getPartsCoord())&&this._offsetCoord.equals(b.getOffsetCoord())};a.prototype.isInCameraRange=function(b){b=b.getPosition()._partsCoord;var a=this._partsCoord.x,c=this._partsCoord.y;return b.x<=a&&a<b.x+g.H_PARTS_NUM_IN_WINDOW&&b.y<=c&&c<b.y+g.V_PARTS_NUM_IN_WINDOW};a.prototype.hasLocalGate=function(){return this._wwa.getMapTypeByPosition(this)===
g.MAP_LOCALGATE||this._wwa.getObjectTypeByPosition(this)===g.OBJECT_LOCALGATE};a.prototype.clone=function(){return new a(this._wwa,this._partsCoord.x,this._partsCoord.y,this._offsetCoord.x,this._offsetCoord.y)};return a}();e.Position=l;c=function(){return function(a,b,k){this.destPos=a.clone();this.srcPos=b.clone();this.srcSize=k.clone()}}();e.Face=c;(function(a){a[a.LEFT=0]="LEFT";a[a.RIGHT=1]="RIGHT";a[a.DOWN=2]="DOWN";a[a.UP=3]="UP";a[a.LEFT_DOWN=4]="LEFT_DOWN";a[a.LEFT_UP=5]="LEFT_UP";a[a.RIGHT_DOWN=
6]="RIGHT_DOWN";a[a.RIGHT_UP=7]="RIGHT_UP";a[a.NO_DIRECTION=8]="NO_DIRECTION"})(e.Direction||(e.Direction={}));e.vx=[-1,1,0,0,-1,-1,1,1,0];e.vy=[0,0,1,-1,1,-1,1,-1,0];e.dirToPos=[4,6,2,0];e.dirToKey=[37,39,40,38];(function(a){a[a.YES=0]="YES";a[a.NO=1]="NO";a[a.UNSELECTED=2]="UNSELECTED"})(e.YesNoState||(e.YesNoState={}));(function(a){a[a.MAP=0]="MAP";a[a.OBJECT=1]="OBJECT";a[a.CHOICE_YES=2]="CHOICE_YES";a[a.CHOICE_NO=3]="CHOICE_NO"})(e.AppearanceTriggerType||(e.AppearanceTriggerType={}));(function(a){a[a.NORMAL=
0]="NORMAL";a[a.CAN_USE=1]="CAN_USE";a[a.NOT_DISAPPEAR=2]="NOT_DISAPPEAR"})(e.ItemMode||(e.ItemMode={}));(function(a){a[a.MAP=1]="MAP";a[a.OBJECT=0]="OBJECT"})(e.PartsType||(e.PartsType={}));(function(a){a[a.NONE=0]="NONE";a[a.CALL_BY_MAP_PARTS=1]="CALL_BY_MAP_PARTS";a[a.CALL_BY_OBJECT_PARTS=2]="CALL_BY_OBJECT_PARTS";a[a.CALL_BY_ITEM_USE=3]="CALL_BY_ITEM_USE";a[a.CALL_BY_QUICK_SAVE=4]="CALL_BY_QUICK_SAVE";a[a.CALL_BY_QUICK_LOAD=5]="CALL_BY_QUICK_LOAD";a[a.CALL_BY_RESTART_GAME=6]="CALL_BY_RESTART_GAME";
a[a.CALL_BY_GOTO_WWA=7]="CALL_BY_GOTO_WWA"})(e.ChoiceCallInfo||(e.ChoiceCallInfo={}));(function(a){a[a.QUICK_LOAD=0]="QUICK_LOAD";a[a.QUICK_SAVE=1]="QUICK_SAVE";a[a.RESTART_GAME=2]="RESTART_GAME";a[a.GOTO_WWA=3]="GOTO_WWA"})(e.SidebarButton||(e.SidebarButton={}));(function(a){a[a.UP=0]="UP";a[a.DOWN=1]="DOWN"})(e.SpeedChange||(e.SpeedChange={}));(function(a){a[a.QUICK_LOAD=0]="QUICK_LOAD";a[a.RESTART_GAME=1]="RESTART_GAME"})(e.LoadType||(e.LoadType={}));(function(a){a[a.STATIC=0]="STATIC";a[a.CHASE_PLAYER=
1]="CHASE_PLAYER";a[a.RUN_OUT=2]="RUN_OUT";a[a.HANG_AROUND=3]="HANG_AROUND"})(e.MoveType||(e.MoveType={}));(function(a){a[a.MODE_X=0]="MODE_X";a[a.MODE_Y=1]="MODE_Y";a[a.UNDECIDED=2]="UNDECIDED"})(e.SecondCandidateMoveType||(e.SecondCandidateMoveType={}));e.sidebarButtonCellElementID=["cell-load","cell-save","cell-restart","cell-gotowwa"];(function(a){a[a.ASK_LINK=5]="ASK_LINK";a[a.NO_MONEY=6]="NO_MONEY";a[a.NO_ITEM=7]="NO_ITEM";a[a.USE_ITEM=8]="USE_ITEM"})(e.SystemMessage1||(e.SystemMessage1={}));
(function(a){a[a.CLICKABLE_ITEM=0]="CLICKABLE_ITEM";a[a.FULL_ITEM=1]="FULL_ITEM";a[a.LOAD_SE=2]="LOAD_SE"})(e.SystemMessage2||(e.SystemMessage2={}));(function(a){a[a.UNDEFINED=0]="UNDEFINED";a[a.IMGPLAYER=1]="IMGPLAYER";a[a.IMGYESNO=2]="IMGYESNO";a[a.HPMAX=3]="HPMAX";a[a.SAVE=4]="SAVE";a[a.ITEM=5]="ITEM";a[a.DEFAULT=6]="DEFAULT";a[a.OLDMAP=7]="OLDMAP";a[a.PARTS=8]="PARTS";a[a.MOVE=9]="MOVE";a[a.MAP=10]="MAP";a[a.DIRMAP=11]="DIRMAP";a[a.IMGFRAME=12]="IMGFRAME";a[a.IMGBOM=13]="IMGBOM";a[a.DELPLAYER=
14]="DELPLAYER";a[a.FACE=15]="FACE";a[a.EFFECT=16]="EFFECT";a[a.GAMEOVER=17]="GAMEOVER";a[a.IMGCLICK=18]="IMGCLICK";a[a.STATUS=19]="STATUS";a[a.EFFITEM=20]="EFFITEM";a[a.COLOR=21]="COLOR";a[a.WAIT=22]="WAIT";a[a.SOUND=23]="SOUND"})(e.MacroType||(e.MacroType={}));e.macrotable={"":0,$imgplayer:1,$imgyesno:2,$hpmax:3,$save:4,$item:5,$default:6,$oldmap:7,$parts:8,$move:9,$map:10,$dirmap:11,$imgframe:12,$imgbom:13,$delplayer:14,$face:15,$effect:16,$gameover:17,$imgclick:18,$status:19,$effitem:20,$color:21,
$wait:22,$sound:23};(function(a){a[a.ENERGY=0]="ENERGY";a[a.STRENGTH=1]="STRENGTH";a[a.DEFENCE=2]="DEFENCE";a[a.GOLD=3]="GOLD";a[a.MOVES=4]="MOVES"})(e.MacroStatusIndex||(e.MacroStatusIndex={}));(function(a){a[a.ENERGY=0]="ENERGY";a[a.STRENGTH=1]="STRENGTH";a[a.DEFENCE=2]="DEFENCE";a[a.GOLD=3]="GOLD";a[a.WIDE_CELL_ROW=4]="WIDE_CELL_ROW";a[a.ITEM_BG=5]="ITEM_BG";a[a.MAIN_FRAME=6]="MAIN_FRAME"})(e.MacroImgFrameIndex||(e.MacroImgFrameIndex={}));(function(a){a[a.DECISION=1]="DECISION";a[a.ATTACK=3]="ATTACK";
a[a.BGM_LB=70]="BGM_LB";a[a.NO_SOUND=99]="NO_SOUND"})(e.SystemSound||(e.SystemSound={}));e.speedList=[2,5,8,10];e.speedNameList=["\u4f4e\u901f","\u6e96\u4f4e\u901f","\u4e2d\u901f","\u9ad8\u901f"];var g=function(){function a(){}a.VERSION_WWAJS="W3.13b++";a.WWA_HOME="http://wwajp.com";a.ITEMBOX_SIZE=12;a.MAP_ATR_MAX=60;a.OBJ_ATR_MAX=60;a.OLD_MAP_ATR_MAX=40;a.OLD_OBJ_ATR_MAX=40;a.ATR_TYPE=3;a.ATR_MODE=4;a.ATR_STRING=5;a.ATR_X=6;a.ATR_Y=7;a.ATR_X2=8;a.ATR_Y2=9;a.ATR_ENERGY=10;a.ATR_STRENGTH=11;a.ATR_DEFENCE=
12;a.ATR_GOLD=13;a.ATR_ITEM=14;a.ATR_NUMBER=15;a.ATR_JUMP_X=16;a.ATR_MOVE=16;a.ATR_JUMP_Y=17;a.ATR_SOUND=19;a.ATR_APPERANCE_BASE=20;a.REL_ATR_APPERANCE_ID=0;a.REL_ATR_APPERANCE_X=1;a.REL_ATR_APPERANCE_Y=2;a.REL_ATR_APPERANCE_TYPE=3;a.REL_ATR_APPERANCE_UNIT_LENGTH=4;a.ATR_RANDOM_BASE=10;a.RANDOM_ATR_NUM=10;a.RANDOM_ITERATION_MAX=10;a.MAP_STREET=0;a.MAP_WALL=1;a.MAP_LOCALGATE=2;a.MAP_URLGATE=4;a.OBJECT_NORMAL=0;a.OBJECT_MESSAGE=1;a.OBJECT_URLGATE=2;a.OBJECT_STATUS=3;a.OBJECT_ITEM=4;a.OBJECT_DOOR=5;
a.OBJECT_MONSTER=6;a.OBJECT_SCORE=11;a.OBJECT_SELL=14;a.OBJECT_BUY=15;a.OBJECT_RANDOM=16;a.OBJECT_SELECT=17;a.OBJECT_LOCALGATE=18;a.SYSTEM_MESSAGE_NUM=20;a.IMGPOS_DEFAULT_YESNO_X=3;a.IMGPOS_DEFAULT_YESNO_Y=1;a.IMGRELPOS_YESNO_YES_X=0;a.IMGRELPOS_YESNO_NO_X=1;a.IMGRELPOS_YESNO_YESP_X=2;a.IMGRELPOS_YESNO_NOP_X=3;a.IMGPOS_DEFAULT_PLAYER_X=2;a.IMGPOS_DEFAULT_PLAYER_Y=0;a.IMGPOS_DEFAULT_CLICKABLE_ITEM_SIGN_X=0;a.IMGPOS_DEFAULT_CLICKABLE_ITEM_SIGN_Y=0;a.IMGPOS_DEFAULT_FRAME_X=0;a.IMGPOS_DEFAULT_FRAME_Y=
1;a.IMGPOS_DEFAULT_BATTLE_EFFECT_X=3;a.IMGPOS_DEFAULT_BATTLE_EFFECT_Y=3;a.DEFAULT_DISABLE_SAVE=!1;a.DEFAULT_OLDMAP=!1;a.DEFAULT_OBJECT_NO_COLLAPSE=!1;a.SPLASH_SCREEN_DISP_MILLS=100;a.DEFAULT_FRAME_INTERVAL=20;a.GAMEOVER_FRAME_INTERVAL=50;a.YESNO_PRESS_DISP_FRAME_NUM=20;a.CHIP_SIZE=40;a.MAP_WINDOW_WIDTH=440;a.MAP_WINDOW_HEIGHT=440;a.H_PARTS_NUM_IN_WINDOW=a.MAP_WINDOW_WIDTH/a.CHIP_SIZE;a.V_PARTS_NUM_IN_WINDOW=a.MAP_WINDOW_HEIGHT/a.CHIP_SIZE;a.DEFAULT_SPEED_INDEX=2;a.MIN_SPEED_INDEX=0;a.MAX_SPEED_INDEX=
e.speedList.length-1;a.ANIMATION_REP_HALF_FRAME=22;a.PLAYER_LOOKING_AROUND_START_FRAME=4*a.ANIMATION_REP_HALF_FRAME;a.RELATIVE_COORD_BIAS=1E4;a.RELATIVE_COORD_LOWER=a.RELATIVE_COORD_BIAS-1E3;a.PLAYER_COORD=a.RELATIVE_COORD_BIAS-1E3;a.LOCALGATE_PLAYER_WAIT_FRAME=5;a.STATUS_CHANGED_EFFECT_FRAME_NUM=20;a.PASSABLE_OBJECT=1;a.APPERANCE_PARTS_MIN_INDEX=0;a.APPERANCE_PARTS_MAX_INDEX=9;a.APPERANCE_PARTS_MIN_INDEX_NO=5;a.APPERANCE_PARTS_MAX_INDEX_YES=4;a.FADEOUT_SPEED=8;a.STATUS_MINUS_BORDER=3E4;a.ITEMBOX_IS_FULL=
-1;a.BATTLE_INTERVAL_FRAME_NUM=10;a.BATTLE_SPEED_CHANGE_TURN_NUM=40;a.RANDOM_MOVE_ITERATION_NUM=50;a.BATTLE_ESTIMATE_MONSTER_TYPE_MAX=8;a.SOUND_MAX=100;a.ITEM_BORDER_IMG_DATA_URL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAArklEQVRYR+2Y0QqAIAxFt///aENJHwxxuJUSxzeh3S7HXaNpEkly4FIRzba0GEyHeVTN7jqDWvb7V4Y1NLibZIY0NbiL5G3MZLCe / 1fn3XJgJYjB7mgg6O1VCEKwXo79JeklY62nB62kRs9BEIKkeNIDhISQEBJC4k0BBCF4D7D4cV9shf99ixdB + MrM0y3fa3zV05D45GOqhwPMGPkYlccIOEY2VKUN0UNVXxC7ADj7mDi9aFZZAAAAAElFTkSuQmCC";
a.LOAD_STAGE_MAX_EXCEPT_AUDIO=7;a.WWA_STYLE_TAG_ID="wwa-additional-style";a.DEFAULT_FRAME_COLOR_R=255;a.DEFAULT_FRAME_COLOR_G=255;a.DEFAULT_FRAME_COLOR_B=255;a.DEFAULT_FRAMEOUT_COLOR_R=96;a.DEFAULT_FRAMEOUT_COLOR_G=96;a.DEFAULT_FRAMEOUT_COLOR_B=96;a.DEFAULT_STRBACK_COLOR_R=0;a.DEFAULT_STRBACK_COLOR_G=0;a.DEFAULT_STRBACK_COLOR_B=0;a.DEFAULT_STATUS_COLOR_R=0;a.DEFAULT_STATUS_COLOR_G=0;a.DEFAULT_STATUS_COLOR_B=0;a.KEYPRESS_MESSAGE_CHANGE_FRAME_NUM=20;a.WWAP_SERVER="http://wwawing.com/wwap";a.WWAP_SERVER_AUDIO_DIR=
"audio";a.WWAP_SERVER_TITLE_IMG="cover_p.gif";a.WWAP_SERVER_LOADER_NO_WORKER="wwaload.noworker.js";return a}();e.WWAConsts=g;c=function(){return function(){}}();e.LoaderResponse=c;c=function(){return function(){}}();e.LoaderError=c;c=function(){return function(){}}();e.LoaderProgress=c;(function(a){a[a.INIT=0]="INIT";a[a.MAP_LOAD=1]="MAP_LOAD";a[a.OBJ_LOAD=2]="OBJ_LOAD";a[a.MAP_ATTR=3]="MAP_ATTR";a[a.OBJ_ATTR=4]="OBJ_ATTR";a[a.RAND_PARTS=5]="RAND_PARTS";a[a.MESSAGE=6]="MESSAGE";a[a.GAME_INIT=7]="GAME_INIT";
a[a.AUDIO=8]="AUDIO"})(e.LoadStage||(e.LoadStage={}));e.loadMessages="\u30ed\u30fc\u30c9\u306e\u6e96\u5099\u3092\u3057\u3066\u3044\u307e\u3059\u3002;\u80cc\u666f\u30d1\u30fc\u30c4\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002;\u7269\u4f53\u30d1\u30fc\u30c4\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;\u80cc\u666f\u30d1\u30fc\u30c4\u306e\u5c5e\u6027\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;\u7269\u4f53\u30d1\u30fc\u30c4\u306e\u5c5e\u6027\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;\u30e9\u30f3\u30c0\u30e0\u30d1\u30fc\u30c4\u3092\u7f6e\u63db\u3057\u3066\u3044\u307e\u3059\u3002;\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8aad\u307f\u8fbc\u3093\u3067\u307e\u3059\u3002;Welcome to WWA Wing!".split(";");
(function(a){a[a.COLOR_FRAME=0]="COLOR_FRAME";a[a.COLOR_FRAMEOUT=1]="COLOR_FRAMEOUT";a[a.COLOR_STR=2]="COLOR_STR";a[a.COLOR_STATUS_STR=4]="COLOR_STATUS_STR"})(e.ChangeStyleType||(e.ChangeStyleType={}));(function(a){a[a.MESSAGE_WINDOW=0]="MESSAGE_WINDOW";a[a.SIDEBAR=1]="SIDEBAR"})(e.SelectorType||(e.SelectorType={}));c=function(){return function(){this.statusColorB=this.statusColorG=this.statusColorR=this.fontColorB=this.fontColorG=this.fontColorR=this.frameOutColorB=this.frameOutColorG=this.frameOutColorR=
this.frameColorB=this.frameColorG=this.frameColorR=this.imgClickY=this.imgClickX=this.bgm=this.delPlayerFlag=this.objectNoCollapseDefaultFlag=this.compatibleForOldMapFlag=this.disableSaveFlag=this.clickableItemSignImgPosY=this.clickableItemSignImgPosX=this.playerImgPosY=this.playerImgPosX=this.yesnoImgPosY=this.yesnoImgPosX=this.moves=this.systemMessage=this.mapCGName=this.charCGName=this.worldPassNumber=this.worldName=this.message=this.worldPassword=this.objectAttribute=this.mapAttribute=this.mapObject=
this.map=this.messageNum=this.mapWidth=this.itemBox=this.statusGold=this.statusDefence=this.statusStrength=this.statusEnergy=this.statusEnergyMax=this.isOldMap=this.objPartsMax=this.mapPartsMax=this.playerY=this.playerX=this.gameoverY=this.gameoverX=this.version=void 0}}();e.WWAData=c})(wwa_data||(wwa_data={}));var wwa_parts_player;
(function(e){var c=wwa_data.WWAConsts,d=function(){function a(b){this._position=b}a.prototype.getPosition=function(){return this._position};return a}(),l=function(a){function b(b){a.call(this,b)}__extends(b,a);return b}(d);e.PartsObject=l;d=function(a){function b(b){a.call(this,b)}__extends(b,a);return b}(d);e.PartsMap=d;var g;(function(a){a[a.CONTROLLABLE=0]="CONTROLLABLE";a[a.MOVING=1]="MOVING";a[a.CAMERA_MOVING=2]="CAMERA_MOVING";a[a.MESSAGE_WAITING=3]="MESSAGE_WAITING";a[a.LOCALGATE_JUMPED=4]=
"LOCALGATE_JUMPED";a[a.BATTLE=5]="BATTLE";a[a.ESTIMATE_WINDOW_WAITING=6]="ESTIMATE_WINDOW_WAITING"})(g||(g={}));l=function(a){function b(b,u,d,e,g){this._status=e;this._equipStatus=new wwa_data.EquipmentStatus(0,0);this._itemBox=Array(c.ITEMBOX_SIZE);this._itemBoxElement=Array(c.ITEMBOX_SIZE);this._itemUsingEvent=Array(c.ITEMBOX_SIZE);for(e=0;e<this._itemBox.length;e++)this._itemBox[e]=0,this._itemBoxElement[e]=wwa_util.$qsh("#item"+e+">.item-disp");this.updateItemBox();this._energyMax=g;this._dir=
2;this._wwa=b;this._state=0;this._camera=d;this._isPartsEventExecuted=!1;this._energyValueElement=wwa_util.$qsh("#disp-energy>.status-value-box");this._strengthValueElement=wwa_util.$qsh("#disp-strength>.status-value-box");this._defenceValueElement=wwa_util.$qsh("#disp-defence>.status-value-box");this._goldValueElement=wwa_util.$qsh("#disp-gold>.status-value-box");this._isClickableItemGot=this._isReadyToUseItem=!1;this._moveObjectAutoExecTimer=this._moveMacroWaitingRemainMoves=this._moves=0;this.updateStatusValueBox();
this._afterMoveMacroFlag=this._partsAppeared=!1;this._isPreparedForLookingAround=!0;this._lookingAroundTimer=c.PLAYER_LOOKING_AROUND_START_FRAME;this._speedIndex=c.DEFAULT_SPEED_INDEX;a.call(this,u)}__extends(b,a);b.prototype.move=function(){if(this.isControllable())this.controll(this._dir);else if(2===this._state){try{this._camera.move(this._dir)}catch(b){}this._isOnCameraStopPosition()&&(this._state=0)}else if(1===this._state){try{var a=this._position.getNextFramePosition(this._dir,wwa_data.speedList[this._speedIndex],
wwa_data.speedList[this._speedIndex])}catch(c){}a.isJustPosition()&&(this._state=0,this._moves++,this._isPartsEventExecuted=!1,this._samePosLastExecutedObjID=this._samePosLastExecutedMapID=void 0);this._position=a}};b.prototype.controll=function(b){var a,d;if(this.isControllable()){this._isPreparedForLookingAround=!1;this._dir=b;try{a=this._position.getNextFramePosition(this._dir,wwa_data.speedList[this._speedIndex],wwa_data.speedList[this._speedIndex]),d=this._position.getNextJustPosition(b)}catch(e){return}if(this._isOnCameraMovingPosition()){if(0!==
this._wwa.getMapIdByPosition(d)||this._wwa.isOldMap()||this._wwa.debug)try{this._camera.move(this._dir),this._state=2}catch(g){this._state=0}}else this.canMoveTo(d)?(this._position=a,this._state=1,this._wwa.getMapAttributeByPosition(this._position.getNextJustPosition(b),c.ATR_TYPE)!==c.MAP_LOCALGATE&&this._wwa.moveObjects(!0)):(this._wwa.getMapTypeByPosition(d)===c.MAP_WALL&&this._wwa.checkMap(d.getPartsCoord()),this._wwa.checkObject(d.getPartsCoord()))}};b.prototype.canMoveTo=function(b){if(null===
b)return!1;if(this._wwa.debug)return!0;this._wwa.getMapWidth();b.getPartsCoord();b.getOffsetCoord();return 0===this._wwa.getMapIdByPosition(b)&&!this._wwa.isOldMap()||this._wwa.getMapTypeByPosition(b)===c.MAP_WALL?!1:0===this._wwa.getObjectIdByPosition(b)||this._wwa.getObjectTypeByPosition(b)===c.OBJECT_NORMAL&&this._wwa.getObjectAttributeByPosition(b,c.ATR_MODE)===c.PASSABLE_OBJECT?!0:this._wwa.getObjectTypeByPosition(b)===c.OBJECT_DOOR&&this._wwa.getObjectAttributeByPosition(b,c.ATR_NUMBER)===c.PASSABLE_OBJECT?
this.hasItem(this._wwa.getObjectAttributeByPosition(b,c.ATR_ITEM))?!1:!0:!1};b.prototype.isMoving=function(){return 1==this._state||2==this._state};b.prototype._isOnCameraMovingPosition=function(){var b=this._camera.getPosition().getPartsCoord(),a=this.getPosition().getPartsCoord();return a.x-b.x===c.H_PARTS_NUM_IN_WINDOW-1&&1===this._dir||a.x===b.x&&0===this._dir||a.y-b.y===c.V_PARTS_NUM_IN_WINDOW-1&&2===this._dir||a.y===b.y&&3===this._dir};b.prototype._isOnCameraStopPosition=function(){var b=this._camera.getPosition().getPartsCoord(),
a=this.getPosition().getPartsCoord();return a.x-b.x===c.H_PARTS_NUM_IN_WINDOW-1&&0===this._dir||a.x===b.x&&1===this._dir||a.y-b.y===c.V_PARTS_NUM_IN_WINDOW-1&&3===this._dir||a.y===b.y&&2===this._dir};b.prototype.isControllable=function(){var b=this._afterMoveMacroFlag;this._afterMoveMacroFlag=!1;return 0===this._state&&!this._partsAppeared&&(this._wwa.getMapTypeByPosition(this._position)!==c.MAP_LOCALGATE&&this._wwa.getMapTypeByPosition(this._position)!==c.MAP_URLGATE||!this._wwa.isPrevFrameEventExecuted())&&
0===this._moveMacroWaitingRemainMoves&&0===this._moveObjectAutoExecTimer&&!b&&this._wwa.canInput()};b.prototype.getCopyOfItemBox=function(){return this._itemBox.slice()};b.prototype.getDir=function(){return this._dir};b.prototype.getEnergyMax=function(){return this._energyMax};b.prototype.isJumped=function(){return 4===this._state};b.prototype.setMessageWaiting=function(){this._state=3};b.prototype.isWaitingMessage=function(){return 3===this._state};b.prototype.clearMessageWaiting=function(){3===
this._state&&(this._state=0,this._isPartsEventExecuted=!0,this._isPreparedForLookingAround&&(this._lookingAroundTimer=c.PLAYER_LOOKING_AROUND_START_FRAME))};b.prototype.setEstimateWindowWating=function(){this._state=6};b.prototype.isWatingEstimateWindow=function(){return 6===this._state};b.prototype.clearEstimateWindowWaiting=function(){6===this._state&&(this._state=0)};b.prototype.isPartsEventExecuted=function(){return this._isPartsEventExecuted};b.prototype.resetEventExecutionInfo=function(){this._isPartsEventExecuted=
!1};b.prototype.getLastExecPartsIDOnSamePosition=function(b){return 1===b?this._samePosLastExecutedMapID:this._samePosLastExecutedObjID};b.prototype.setLastExecInfoOnSamePosition=function(b,a){1===b?this._samePosLastExecutedMapID=a:this._samePosLastExecutedObjID=a};b.prototype.processAfterJump=function(){4===this._state&&0===--this._jumpWaitFramesRemain&&(this._state=0)};b.prototype.jumpTo=function(b){var a=this._camera.getPosition();this.getPosition();if(this._position.equals(b))return!1;this._position=
b;b.isInCameraRange(this._camera)||this._camera.reset(b);this._state=4;this._jumpWaitFramesRemain=c.LOCALGATE_PLAYER_WAIT_FRAME;this._samePosLastExecutedObjID=this._samePosLastExecutedMapID=void 0;b.hasLocalGate()?this._dir=2:b.getPartsCoord().y<=this._wwa.getMapWidth()-2&&b.getNextJustPosition(2).hasLocalGate()?this._dir=3:1<=b.getPartsCoord().y&&b.getNextJustPosition(3).hasLocalGate()?this._dir=2:b.getPartsCoord().x<=this._wwa.getMapWidth()-2&&b.getNextJustPosition(1).hasLocalGate()?this._dir=0:
1<=b.getPartsCoord().x&&b.getNextJustPosition(0).hasLocalGate()?this._dir=1:this._dir=2;this._camera.getPosition().equals(a)||(this._isPreparedForLookingAround=!0,this._lookingAroundTimer=c.PLAYER_LOOKING_AROUND_START_FRAME);return!0};b.prototype.systemJumpTo=function(b){this._position=b;this._camera.reset(b);this._camera.resetPreviousPosition();this._state=4;this._jumpWaitFramesRemain=c.LOCALGATE_PLAYER_WAIT_FRAME;this._samePosLastExecutedObjID=this._samePosLastExecutedMapID=void 0;this._dir=2;this._isPreparedForLookingAround=
!0;this._lookingAroundTimer=c.PLAYER_LOOKING_AROUND_START_FRAME};b.prototype.addStatusAll=function(b){this._status.add(b);this.isDead()&&(this._status.energy=0);0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox();return this._status};b.prototype.setEnergyMax=function(b){this._energyMax=b;0!==b&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox();return b};b.prototype.setEnergy=function(b){this._status.energy=
b;this.isDead()&&(this._status.energy=0);0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox();return b};b.prototype.damage=function(b){this._status.energy=Math.max(0,this._status.energy-b);this.isDead()&&(this._status.energy=0);0!==this._energyMax&&(this._status.energy=Math.min(this._status.energy,this._energyMax));this.updateStatusValueBox()};b.prototype.setStrength=function(b){return this._status.strength=b};b.prototype.setDefence=
function(b){this._status.defence=b;this.updateStatusValueBox();return b};b.prototype.setGold=function(b){this._status.gold=b;this.updateStatusValueBox();return b};b.prototype.getStatus=function(){return this._status.plus(this._equipStatus)};b.prototype.getStatusWithoutEquipments=function(){return this._status.plus(new wwa_data.EquipmentStatus(0,0))};b.prototype.updateStatusValueBox=function(){var b=this._status.plus(this._equipStatus),a=b.strength,c=b.defence,d=b.gold;this._energyValueElement.textContent=
b.energy+"";this._strengthValueElement.textContent=a+"";this._defenceValueElement.textContent=c+"";this._goldValueElement.textContent=d+""};b.prototype.updateItemBox=function(){for(var b,a,c=0;c<this._itemBoxElement.length;c++)0===this._itemBox[c]?this._itemBoxElement[c].style.backgroundPosition="-40px 0px":(b=this._wwa.getObjectCropXById(this._itemBox[c]),a=this._wwa.getObjectCropYById(this._itemBox[c]),this._itemBoxElement[c].style.backgroundPosition="-"+b+"px -"+a+"px")};b.prototype.isDead=function(){return 0>=
this._status.energy};b.prototype.addItem=function(b,a,d){void 0===a&&(a=0);void 0===d&&(d=!1);var e;e=this._wwa.getObjectAttributeById(b,c.ATR_NUMBER);0===a&&0!==e&&(a=e);if(0===a){if(0===b)return;a=this._getBlankItemPos();if(a===c.ITEMBOX_IS_FULL)throw Error("\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002");this._forceSetItemBox(a,b)}else if(!1===d)if(e=this._itemBox[a-1],this._wwa.getObjectAttributeById(e,c.ATR_NUMBER)!==this._wwa.getObjectAttributeById(b,
c.ATR_NUMBER))if(d=this._getBlankItemPos(),d!==c.ITEMBOX_IS_FULL)this._forceSetItemBox(d,e),this._forceSetItemBox(a,b);else throw Error("\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002");else this._forceSetItemBox(a,b);else this._forceSetItemBox(a,b);this._updateEquipmentStatus();this.updateItemBox()};b.prototype._forceSetItemBox=function(b,a){var d=this,e=wwa_util.$qsh("#item"+(b-1)+">.item-click-border"),g=this._wwa.getObjectAttributeById(a,c.ATR_MODE);
this.removeItemByItemPosition(b);this._itemBox[b-1]=a;0!==a&&0!==g&&(g=this._wwa.getSystemMessageById(0),this._isClickableItemGot||("BLANK"!==g&&this._wwa.setMessageQueue(""===g?"\u3053\u306e\u30a2\u30a4\u30c6\u30e0\u306f\u53f3\u306e\u30dc\u30c3\u30af\u30b9\u3092\u30af\u30ea\u30c3\u30af\u3059\u308b\u3053\u3068\u3067\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002\n\u4f7f\u7528\u3067\u304d\u308b\u30a2\u30a4\u30c6\u30e0\u306f\u8272\u67a0\u3067\u56f2\u307e\u308c\u307e\u3059\u3002":g,!1,!0),this._isClickableItemGot=
!0),e.style.display="block",function(b){d._itemUsingEvent[b-1]=function(){if(d.isControllable())d._wwa.onselectitem(b)}}(b),e.addEventListener("click",this._itemUsingEvent[b-1]))};b.prototype._getBlankItemPos=function(){var b;for(b=1;b<this._itemBox.length+1;b++)if(0===this._itemBox[b-1])return b;return c.ITEMBOX_IS_FULL};b.prototype._updateEquipmentStatus=function(){var b,a=new wwa_data.EquipmentStatus(0,0);for(b=0;b<c.ITEMBOX_SIZE;b++)0!==this._itemBox[b]&&(a.strength+=this._wwa.getObjectAttributeById(this._itemBox[b],
c.ATR_STRENGTH),a.defence+=this._wwa.getObjectAttributeById(this._itemBox[b],c.ATR_DEFENCE));b=a.minus(this._equipStatus);this._wwa.setStatusChangedEffect(b);this._equipStatus=a;this.updateStatusValueBox()};b.prototype.hasItem=function(b){for(var a=0;a<c.ITEMBOX_SIZE;a++)if(this._itemBox[a]===b)return!0;return!1};b.prototype.canUseItem=function(b){b=this._itemBox[b-1];return 0===b||0===this._wwa.getObjectAttributeById(b,c.ATR_MODE)?!1:!0};b.prototype.useItem=function(){var b;b=this._itemBox[this._readyToUseItemPos-
1];2!==this._wwa.getObjectAttributeById(b,c.ATR_MODE)&&this.removeItemByItemPosition(this._readyToUseItemPos);var a=wwa_util.$id("item"+(this._readyToUseItemPos-1));setTimeout(function(){a.classList.contains("onpress")&&a.classList.remove("onpress")},c.DEFAULT_FRAME_INTERVAL);this._isReadyToUseItem=!1;this._readyToUseItemPos=void 0;return b};b.prototype.canHaveMoreItems=function(){return this._getBlankItemPos()!==c.ITEMBOX_IS_FULL};b.prototype.removeItemByItemPosition=function(b){var a;0!==this._itemBox[b-
1]&&(0!==this._wwa.getObjectAttributeById(this._itemBox[b-1],c.ATR_MODE)&&(a=wwa_util.$qsh("#item"+(b-1)+">.item-click-border"),a.removeEventListener("click",this._itemUsingEvent[b-1]),a.style.display="none"),this._itemBox[b-1]=0,this._updateEquipmentStatus(),this.updateItemBox())};b.prototype.removeItemByPartsID=function(b){if(!this.hasItem(b))throw Error("\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3063\u3066\u3044\u306a\u3044");for(var a=0;a<c.ITEMBOX_SIZE;a++)if(this._itemBox[a]===b){0!==this._wwa.getObjectAttributeById(this._itemBox[a],
c.ATR_MODE)&&(b=wwa_util.$qsh("#item"+a+">.item-click-border"),b.removeEventListener("click",this._itemUsingEvent[a]),b.style.display="none");this._itemBox[a]=0;this._updateEquipmentStatus();this.updateItemBox();break}};b.prototype.clearItemBox=function(){for(var b=1;b<=c.ITEMBOX_SIZE;b++)this.removeItemByItemPosition(b);this._updateEquipmentStatus();this.updateItemBox()};b.prototype.hasGold=function(b){return this._status.gold>=b};b.prototype.payGold=function(b){if(!this.hasGold(b))throw Error("\u304a\u91d1\u304c\u8db3\u308a\u306a\u3044");
this.setGold(this._status.gold-b)};b.prototype.earnGold=function(b){this.setGold(this._status.gold+b)};b.prototype.setPartsAppearedFlag=function(){this._partsAppeared=!0};b.prototype.clearPartsAppearedFlag=function(){this._partsAppeared=!1};b.prototype.isPartsAppearedTime=function(){return!0===this._partsAppeared};b.prototype.startBattleWith=function(b){this._isPlayerTurn=!0;this._battleFrameCounter=c.BATTLE_INTERVAL_FRAME_NUM;this._battleTurnNum=0;this._enemy=b;this._state=5};b.prototype.isFighting=
function(){return 5===this._state};b.prototype.isTurn=function(){return this._isPlayerTurn};b.prototype.getTurnNum=function(){return this._battleTurnNum};b.prototype.isBattleStartFrame=function(){return this._battleFrameCounter===c.BATTLE_INTERVAL_FRAME_NUM&&0===this._battleTurnNum};b.prototype.fight=function(){if(!this.isFighting())throw Error("\u30d0\u30c8\u30eb\u304c\u958b\u59cb\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002");0===this._battleTurnNum&&this._battleFrameCounter===c.BATTLE_INTERVAL_FRAME_NUM&&
this._wwa.showMonsterWindow();if(!(0<--this._battleFrameCounter)){this._battleTurnNum++;this._speedIndex===c.MAX_SPEED_INDEX||this._battleTurnNum>c.BATTLE_SPEED_CHANGE_TURN_NUM?(1===this._battleTurnNum&&this._wwa.playSound(3),this._battleFrameCounter=1):(this._battleFrameCounter=c.BATTLE_INTERVAL_FRAME_NUM,this._wwa.playSound(3));var b=this.getStatus(),a=this._enemy.status;if(this._isPlayerTurn){if(b.strength>a.defence||b.defence<a.strength){a.energy>b.strength-a.defence?b.strength>a.defence&&this._enemy.damage(b.strength-
a.defence):(this._wwa.playSound(this._wwa.getObjectAttributeById(this._enemy.partsID,c.ATR_SOUND)),this.earnGold(a.gold),this._wwa.setStatusChangedEffect(new wwa_data.Status(0,0,0,a.gold)),0!==this._enemy.item?this._wwa.setPartsOnPosition(0,this._enemy.item,this._enemy.position):this._wwa.setPartsOnPosition(0,0,this._enemy.position),this._wwa.appearParts(this._enemy.position,1,this._enemy.partsID),this._state=0,this._wwa.setMessageQueue(this._enemy.message,!1,!1),this._enemy.battleEndProcess(),this._battleTurnNum=
0,this._enemy=null);this._isPlayerTurn=!1;return}this._enemy.battleEndProcess();this._wwa.setMessageQueue("\u76f8\u624b\u306e\u9632\u5fa1\u80fd\u529b\u304c\u9ad8\u3059\u304e\u308b\uff01",!1,!0);this._battleTurnNum=0;this._enemy=null}else a.strength>b.defence&&(b.energy>a.strength-b.defence?this.damage(a.strength-b.defence):(this.setEnergy(0),this._enemy.battleEndProcess(),this._battleTurnNum=this._state=0,this._enemy=null,this._wwa.gameover()));this._isPlayerTurn=!0}};b.prototype.readyToUseItem=function(b){var a;
if(!this.canUseItem(b))throw Error("\u30a2\u30a4\u30c6\u30e0\u304c\u306a\u3044\u304b\u3001\u30a2\u30a4\u30c6\u30e0\u304c\u4f7f\u3048\u307e\u305b\u3093\u3002");a=this._itemBox[b-1];this._wwa.getObjectAttributeById(a,c.ATR_STRING);this._wwa.appearParts(this._position.getPartsCoord(),1,a);this._readyToUseItemPos=b;this._isReadyToUseItem=!0};b.prototype.isReadyToUseItem=function(){return this._isReadyToUseItem};b.prototype.getDrawingCenterPosition=function(){var b=this._position.getPartsCoord(),a=this._position.getOffsetCoord(),
d=this._camera.getPosition(),e=d.getPartsCoord(),d=d.getOffsetCoord();return new wwa_data.Coord((b.x-e.x)*c.CHIP_SIZE+a.x-d.x+c.CHIP_SIZE/2,(b.y-e.y)*c.CHIP_SIZE+a.y-d.y+c.CHIP_SIZE/2)};b.prototype.getMoveCount=function(){return this._moves};b.prototype.setMoveCount=function(b){return this._moves=b};b.prototype.isMoveObjectAutoExecTime=function(){return 0===this._moveObjectAutoExecTimer};b.prototype.setMoveMacroWaiting=function(b){0>b||(this._moveMacroWaitingRemainMoves=b,this._moveObjectAutoExecTimer=
0)};b.prototype.resetMoveObjectAutoExecTimer=function(){this._moveObjectAutoExecTimer=c.CHIP_SIZE/wwa_data.speedList[this._speedIndex];this._moveMacroWaitingRemainMoves--};b.prototype.decrementMoveObjectAutoExecTimer=function(){0<=this._moveMacroWaitingRemainMoves&&0<this._moveObjectAutoExecTimer&&(this._moveObjectAutoExecTimer--,0===this._moveMacroWaitingRemainMoves&&0===this._moveObjectAutoExecTimer&&(this._afterMoveMacroFlag=!0));return 0};b.prototype.isWaitingMoveMacro=function(){return 0!==this._moveMacroWaitingRemainMoves||
0!==this._moveObjectAutoExecTimer};b.prototype.decrementLookingAroundTimer=function(){return this._isPreparedForLookingAround&&0<this._lookingAroundTimer?--this._lookingAroundTimer:0};b.prototype.isLookingAround=function(){return this._isPreparedForLookingAround&&0===this._lookingAroundTimer};b.prototype.getSpeedIndex=function(){return this._speedIndex};b.prototype.speedUp=function(){return this._speedIndex=Math.min(c.MAX_SPEED_INDEX,this._speedIndex+1)};b.prototype.speedDown=function(){return this._speedIndex=
Math.max(c.MIN_SPEED_INDEX,this._speedIndex-1)};return b}(l);e.Player=l})(wwa_parts_player||(wwa_parts_player={}));var wwa_camera;
(function(e){var c=wwa_data.WWAConsts,d=function(){function d(c){this._position=null;this.reset(c)}d.prototype.setPlayer=function(c){this._player=c};d.prototype.isResetting=function(){return this._isResetting};d.prototype.getPosition=function(){return this._position};d.prototype.getPreviousPosition=function(){return this._positionPrev};d.prototype.resetPreviousPosition=function(){this._positionPrev=null};d.prototype.move=function(d){var a=wwa_data.speedList[this._player.getSpeedIndex()];this._position=
this._position.getNextFramePosition(d,a*(c.H_PARTS_NUM_IN_WINDOW-1),a*(c.V_PARTS_NUM_IN_WINDOW-1))};d.prototype.getTransitionStepNum=function(){return this._transitionStep};d.prototype.advanceTransitionStepNum=function(){++this._transitionStep;this._transitionStep===wwa_data.WWAConsts.V_PARTS_NUM_IN_WINDOW&&(this._isResetting=!1,this._transitionStep=0);return this._transitionStep};d.prototype.isFinalStep=function(){if(!1===this._isResetting)throw Error("\u30ea\u30bb\u30c3\u30c8\u4e2d\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002");
return this._transitionStep===wwa_data.WWAConsts.V_PARTS_NUM_IN_WINDOW-1};d.prototype.reset=function(c){this._positionPrev=this._position;this._position=c.getScreenTopPosition();this._transitionStep=0;this._isResetting=!0};return d}();e.Camera=d})(wwa_camera||(wwa_camera={}));var wwa_cgmanager;
(function(e){var c=wwa_data.WWAConsts,d=function(){function d(c,a,b,k){this._isLoaded=!1;this._ctx=c;this._ctxSub=a;this._fileName=b;this._loadCompleteCallBack=k;this._load()}d.prototype._load=function(){var c=this;this._isLoaded||(this._image=new Image,this._image.addEventListener("load",function(){c._loadCompleteCallBack()}),this._image.addEventListener("error",function(){throw Error("Image Load Failed!!\nfile name:"+c._fileName);}),this._image.src=this._fileName,this._isLoaded=!0)};d.prototype.drawCanvas=
function(d,a,b,k,e){void 0===e&&(e=!1);e=e?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");e.drawImage(this._image,c.CHIP_SIZE*d,c.CHIP_SIZE*a,c.CHIP_SIZE,c.CHIP_SIZE,b,k,c.CHIP_SIZE,c.CHIP_SIZE)};d.prototype.drawCanvasWithSize=function(d,a,b,k,e,p,h){void 0===h&&(h=!1);h=h?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");h.drawImage(this._image,c.CHIP_SIZE*d,c.CHIP_SIZE*a,c.CHIP_SIZE*b,c.CHIP_SIZE*k,e,p,2*c.CHIP_SIZE,2*c.CHIP_SIZE)};d.prototype.drawCanvasWithUpperYLimit=
function(d,a,b,k,e,p){void 0===p&&(p=!1);p=p?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");e=Math.max(0,k+c.CHIP_SIZE-e);e>=c.CHIP_SIZE||p.drawImage(this._image,c.CHIP_SIZE*d,c.CHIP_SIZE*a,c.CHIP_SIZE,c.CHIP_SIZE-e,b,k,c.CHIP_SIZE,c.CHIP_SIZE)};d.prototype.drawCanvasWithLowerYLimit=function(d,a,b,k,e,p){void 0===p&&(p=!1);p=p?this._ctxSub:this._ctx;if(!this._isLoaded)throw Error("No image was loaded.");e=Math.max(0,e-k);e>=c.CHIP_SIZE||p.drawImage(this._image,c.CHIP_SIZE*
d,c.CHIP_SIZE*a+e,c.CHIP_SIZE,c.CHIP_SIZE-e,b,k+e,c.CHIP_SIZE,c.CHIP_SIZE)};d.prototype.clearCanvas=function(c,a,b,d,e){void 0===e&&(e=!1);(e?this._ctxSub:this._ctx).clearRect(c,a,b,d)};d.prototype.drawBase=function(c,a,b,d,e){void 0===e&&(e=!1);e=e?this._ctxSub:this._ctx;e.fillStyle="#9E9E9E";e.fillRect(c,a,b,d)};return d}();e.CGManager=d})(wwa_cgmanager||(wwa_cgmanager={}));var wwa_util;
(function(e){e.$id=function(c){return document.getElementById(c)};e.$class=function(c){return document.getElementsByClassName(c)};e.$tag=function(c){return document.getElementsByTagName(c)};e.$qs=function(c){return document.querySelector(c)};e.$qsh=function(c){return document.querySelector(c)};e.$qsAll=function(c){return document.querySelectorAll(c)};e.$localPos=function(c,d){var l,g;l=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft;g=window.pageYOffset||document.body.scrollTop||
document.documentElement.scrollTop;l=c-e.$id("wwa-wrapper").offsetLeft+l;g=d-e.$id("wwa-wrapper").offsetTop+g;return new wwa_data.Coord(l,g)};e.$escapedURI=function(c){return c.match(/^https?:\/\//)||c.match(/^\.\.\//)?c:location.href="./"+c}})(wwa_util||(wwa_util={}));var wwa_message;
(function(e){var c=function(){return function(a,b,c,d){this.message=a;this.isSystemMessage=b;this.isEndOfPartsEvent=c;this.macro=d;void 0===this.macro&&(this.macro=[])}}();e.MessageInfo=c;e.strArrayToMessageInfoArray=function(a,b){var d=[];a.forEach(function(a){d.push(new c(a,b))});return d};var d=function(){function a(b,a,c,d,e,g){this._wwa=b;this._triggerPartsID=a;this._triggerPartsType=c;this._triggerPartsPosition=d;this.macroType=e;this.macroArgs=g}a.prototype.execute=function(){try{1===this.macroType?
this._executeImgPlayerMacro():2===this.macroType?this._executeImgYesNoMacro():3===this.macroType?this._executeHPMaxMacro():4===this.macroType?this._executeSaveMacro():5===this.macroType?this._executeItemMacro():6===this.macroType?this._executeDefaultMacro():7===this.macroType?this._executeOldMapMacro():8===this.macroType?this._executePartsMacro():9===this.macroType?this._executeMoveMacro():10===this.macroType?this._executeMapMacro():11===this.macroType?this._executeDirMapMacro():12===this.macroType?
this._executeImgFrameMacro():13===this.macroType?this._executeImgBomMacro():14===this.macroType?this._executeDelPlayerMacro():15===this.macroType?this._executeFaceMacro():16===this.macroType?this._executeEffectMacro():17===this.macroType?this._executeGameOverMacro():18===this.macroType?this._executeImgClickMacro():19===this.macroType?this._executeStatusMacro():21===this.macroType?this._executeColorMacro():22===this.macroType?this._executeWaitMacro():23===this.macroType&&this._executeSoundMacro()}catch(b){}};
a.prototype._concatEmptyArgs=function(b){if(this.macroArgs.length<b){b=Array(b-this.macroArgs.length);for(var a=0;a<b.length;a++)b[a]="";this.macroArgs=this.macroArgs.concat(b)}};a.prototype._parseInt=function(b,a){void 0===a&&(a=0);var c=parseInt(this.macroArgs[b]);return isNaN(c)?a:c};a.prototype._executeImgPlayerMacro=function(){this._concatEmptyArgs(2);var b=this._parseInt(0),a=this._parseInt(1);this._wwa.setPlayerImgCoord(new wwa_data.Coord(b,a))};a.prototype._executeImgYesNoMacro=function(){this._concatEmptyArgs(2);
var b=this._parseInt(0),a=this._parseInt(1);this._wwa.setYesNoImgCoord(new wwa_data.Coord(b,a))};a.prototype._executeHPMaxMacro=function(){this._concatEmptyArgs(1);var b=Math.max(0,this._parseInt(0));this._wwa.setPlayerEnergyMax(b)};a.prototype._executeSaveMacro=function(){this._concatEmptyArgs(1);var b=!!this._parseInt(0);this._wwa.disableSave(b)};a.prototype._executeItemMacro=function(){this._concatEmptyArgs(2);var b=this._parseInt(0),a=this._parseInt(1);this._wwa.setPlayerGetItem(b,a)};a.prototype._executeDefaultMacro=
function(){this._concatEmptyArgs(1);var b=!!this._parseInt(0);this._wwa.setObjectNotCollapseOnPartsOnPlayer(b)};a.prototype._executeOldMapMacro=function(){this._concatEmptyArgs(1);var b=!!this._parseInt(0);this._wwa.setOldMap(b)};a.prototype._executePartsMacro=function(){this._concatEmptyArgs(4);var b=this._parseInt(0),a=this._parseInt(1),c=this._parseInt(2,0),d=this._parseInt(3);if(0!==c&&1!==c)throw Error("\u30d1\u30fc\u30c4\u7a2e\u5225\u304c\u4e0d\u660e\u3067\u3059");0!==d&&1!==d&&(d=1);if(0>b||
0>a)throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");if(0===c){if(b>=this._wwa.getObjectPartsNum()||a>=this._wwa.getObjectPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");}else if(b>=this._wwa.getMapPartsNum()||a>=this._wwa.getMapPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");this._wwa.replaceParts(b,a,c,!!d)};a.prototype._executeMoveMacro=function(){this._concatEmptyArgs(1);var b=this._parseInt(0);
this._wwa.setMoveMacroWaitingToPlayer(b)};a.prototype._executeMapMacro=function(){this._concatEmptyArgs(4);var b=this._parseInt(0),a=this.macroArgs[1],c=this.macroArgs[2],d=this._parseInt(3,0);if(0>b)throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");if(0===d){if(b>=this._wwa.getObjectPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");}else if(b>=this._wwa.getMapPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");
this._wwa.appearPartsEval(this._triggerPartsPosition,a,c,b,d)};a.prototype._executeDirMapMacro=function(){this._concatEmptyArgs(3);var b=this._parseInt(0),a=this._parseInt(1),c=this._parseInt(2,0);if(isNaN(b)||isNaN(a)||isNaN(c))throw Error("\u5f15\u6570\u304c\u6574\u6570\u3067\u306f\u3042\u308a\u307e\u305b\u3093");if(0>b)throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");if(0===c){if(b>=this._wwa.getObjectPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");
}else if(b>=this._wwa.getMapPartsNum())throw Error("\u30d1\u30fc\u30c4\u756a\u53f7\u304c\u4e0d\u6b63\u3067\u3059");this._wwa.appearPartsByDirection(a,b,c)};a.prototype._executeImgFrameMacro=function(){this._concatEmptyArgs(3);var b=this._parseInt(0),a=this._parseInt(1),c=this._parseInt(2),d=a*wwa_data.WWAConsts.CHIP_SIZE,e=c*wwa_data.WWAConsts.CHIP_SIZE;if(0>a||0>c)throw Error("\u5ea7\u6a19\u306f\u6b63\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");if(0===b)wwa_util.$qsh("#disp-energy>.status-icon").style.backgroundPosition=
"-"+d+"px -"+e+"px";else if(1===b)wwa_util.$qsh("#disp-strength>.status-icon").style.backgroundPosition="-"+d+"px -"+e+"px";else if(2===b)wwa_util.$qsh("#disp-defence>.status-icon").style.backgroundPosition="-"+d+"px -"+e+"px";else if(3===b)wwa_util.$qsh("#disp-gold>.status-icon").style.backgroundPosition="-"+d+"px -"+e+"px";else if(4===b)Array.prototype.forEach.call(wwa_util.$qsAll("div.wide-cell-row"),function(b){b.style.backgroundPosition="-"+d+"px -"+e+"px"});else if(5===b)Array.prototype.forEach.call(wwa_util.$qsAll("div.item-cell"),
function(b){b.style.backgroundPosition="-"+d+"px -"+e+"px"});else if(6===b)this._wwa.setFrameCoord(new wwa_data.Coord(a,c));else throw Error("\u7a2e\u5225\u304c\u4e0d\u6b63\u3067\u3059\u3002");};a.prototype._executeImgBomMacro=function(){this._concatEmptyArgs(2);var b=this._parseInt(0),a=this._parseInt(1);if(0>b||0>a)throw Error("\u5ea7\u6a19\u306f\u6b63\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");this._wwa.setBattleEffectCoord(new wwa_data.Coord(b,a))};a.prototype._executeDelPlayerMacro=
function(){this._concatEmptyArgs(1);var b=parseInt(this.macroArgs[0]);this._wwa.setDelPlayer(!!b)};a.prototype._executeFaceMacro=function(){this._concatEmptyArgs(6);var b=this._parseInt(0),a=this._parseInt(1),c=this._parseInt(2),d=this._parseInt(3),e=this._parseInt(4),g=this._parseInt(5);if(0>b||0>a||0>c||0>d||0>e||0>g)throw Error("\u5404\u5f15\u6570\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");b=new wwa_data.Face(new wwa_data.Coord(b,a),
new wwa_data.Coord(c,d),new wwa_data.Coord(e,g));this._wwa.addFace(b)};a.prototype._executeEffectMacro=function(){this._concatEmptyArgs(1);var b=this._parseInt(0);if(0>b)throw Error("\u5f85\u3061\u6642\u9593\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");0===b&&this._wwa.stopEffect();for(var a=[],c=1;c<this.macroArgs.length;c+=2){var d=this._parseInt(c),e=0;if(0>d)throw Error("\u753b\u50cf\u306e\u30d1\u30fc\u30c4\u5ea7\u6a19\u6307\u5b9a\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");
if(c+1===this.macroArgs.length)throw Error("\u753b\u50cf\u306e\u30d1\u30fc\u30c4\u5ea7\u6a19\u6307\u5b9a\u3067\u3001Y\u5ea7\u6a19\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002");e=this._parseInt(c+1);if(0>e)throw Error("\u753b\u50cf\u306e\u30d1\u30fc\u30c4\u5ea7\u6a19\u6307\u5b9a\u306f0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002");a.push(new wwa_data.Coord(d,e))}this._wwa.setEffect(b,a)};a.prototype._executeGameOverMacro=function(){this._concatEmptyArgs(2);
var b=this._parseInt(0),a=this._parseInt(1);if(0>b||b>=this._wwa.getMapWidth()||0>a||a>=this._wwa.getMapWidth())throw Error("\u30de\u30c3\u30d7\u306e\u7bc4\u56f2\u5916\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059!");this._wwa.setGameOverPosition(new wwa_data.Coord(b,a))};a.prototype._executeImgClickMacro=function(){this._concatEmptyArgs(2);if(1>this.macroArgs.length)throw Error("\u5f15\u6570\u304c\u5c11\u306a\u3059\u304e\u307e\u3059");var b=this._parseInt(0),a=this._parseInt(1);if(0>b||0>
a)throw Error("\u5f15\u6570\u304c0\u4ee5\u4e0a\u306e\u6574\u6570\u3067\u306f\u3042\u308a\u307e\u305b\u3093");this._wwa.setImgClick(new wwa_data.Coord(b,a))};a.prototype._executeStatusMacro=function(){this._concatEmptyArgs(2);var b=this._parseInt(0),a=this._parseInt(1);if(0>b||4<b)throw Error("\u30b9\u30c6\u30fc\u30bf\u30b9\u7a2e\u5225\u304c\u7bc4\u56f2\u5916\u3067\u3059\u3002");this._wwa.setPlayerStatus(b,a)};a.prototype._executeColorMacro=function(){this._concatEmptyArgs(4);var b=this._parseInt(0),
a=this._parseInt(1),c=this._parseInt(2),d=this._parseInt(3);if(0>b||5<b)throw Error("\u7a2e\u5225\u306f0\u304b\u30895\u307e\u3067\u3067\u3059");if(0>a||255<a||0>c||255<c||0>d||255<d)throw Error("\u8272\u304c\u7bc4\u56f2\u5916\u3067\u3059");this._wwa.changeStyleRule(b,a,c,d)};a.prototype._executeWaitMacro=function(){throw Error("Not implemented!");};a.prototype._executeSoundMacro=function(){this._concatEmptyArgs(1);var b=parseInt(this.macroArgs[0]);this._wwa.playSound(b)};return a}();e.Macro=d;e.parseMacro=
function(a,b,c,e,g){g=g.match(/^\$([a-zA-Z_][a-zA-Z0-9_]*)\=(.*)$/);if(null===g||3!==g.length)throw Error("\u30de\u30af\u30ed\u3067\u306f\u3042\u308a\u307e\u305b\u3093");var h=wwa_data.macrotable["$"+g[1].toLowerCase()];return void 0===h?new d(a,b,c,e,0,g[2].split(",")):new d(a,b,c,e,h,g[2].split(",").map(function(b){return b.trim()}))};var l=function(){function a(b,a,c,d,e,g,l){this._wwa=b;this._coord=a;this._width=c;this._height=d;this._isVisible=e;this._parentElement=g;this._element=document.createElement("div");
this._element.style.position="absolute";this._element.style.borderWidth="1px";this._element.style.borderStyle="solid";this._element.style.borderRadius="5px";this._element.classList.add("wwa-message-window");this._element.style.zIndex=l+"";this._element.style.opacity="0.9";this._element.style.left=this._coord.x+"px";this._element.style.top=this._coord.y+"px";this._element.style.width=this._width+"px";this._element.style.height=this._height+"px";this._parentElement.appendChild(this._element)}a.prototype.update=
function(b){};a.prototype.show=function(){this._isVisible=!0;this._element.style.display="block";this.update()};a.prototype.hide=function(){this._isVisible=!1;this._element.style.display="none";this.update()};a.prototype.isVisible=function(){return this._isVisible};return a}(),g=function(a){function b(b,c,d,e,g,l,z){a.call(this,b,new wwa_data.Coord(c.x,c.y),d,e,g,l,201);this._cgFileName=z;this._monsterBox=document.createElement("div");this._monsterBox.style.width=wwa_data.WWAConsts.CHIP_SIZE+"px";
this._monsterBox.style.height=wwa_data.WWAConsts.CHIP_SIZE+"px";this._monsterBox.style.position="absolute";this._monsterBox.style.left="10px";this._monsterBox.style.top="10px";this._monsterBox.style.backgroundImage="url("+this._cgFileName.replace("(","\\(").replace(")","\\)")+")";this._monsterBox.style.backgroundPosition="0 0";this._element.appendChild(this._monsterBox);this._energyBox=document.createElement("div");this._energyBox.style.position="absolute";this._energyBox.style.left="80px";this._energyBox.style.top=
"10px";this._energyBox.textContent="\u751f\u547d\u529b 0";this._element.appendChild(this._energyBox);this._strengthBox=document.createElement("div");this._strengthBox.style.position="absolute";this._strengthBox.style.left="80px";this._strengthBox.style.top="30px";this._strengthBox.textContent="\u653b\u6483\u529b 0";this._element.appendChild(this._strengthBox);this._defenceBox=document.createElement("div");this._defenceBox.style.position="absolute";this._defenceBox.style.left="180px";this._defenceBox.style.top=
"30px";this._defenceBox.textContent="\u9632\u5fa1\u529b 0";this._element.appendChild(this._defenceBox);this._element.style.display=this._isVisible?"block":"none"}__extends(b,a);b.prototype.update=function(b){void 0!==b&&(this._monsterBox.style.backgroundPosition="-"+b.imgCoord.x+"px -"+b.imgCoord.y+"px",this._energyBox.textContent="\u751f\u547d\u529b "+b.status.energy,this._strengthBox.textContent="\u653b\u6483\u529b "+b.status.strength,this._defenceBox.textContent="\u9632\u5fa1\u529b "+b.status.defence)};
return b}(l);e.MosterWindow=g;l=function(a){function b(b,c,d,e){a.call(this,b,new wwa_data.Coord(c.x,c.y),340,30,d,e,202);this._element.style.textAlign="center";this._element.style.display=this._isVisible?"block":"none";this.update(0)}__extends(b,a);b.prototype.update=function(b){void 0!==b&&(this._element.textContent="Score: "+b)};return b}(l);e.ScoreWindow=l;(function(a){a[a.TOP=0]="TOP";a[a.CENTER=1]="CENTER";a[a.BOTTOM=2]="BOTTOM";a[a.SCORE=3]="SCORE"})(e.Positioning||(e.Positioning={}));l=function(){function a(b,
a,c,d,e,g,l,z,m,x){var r=this,f=l.replace("(","\\(").replace(")","\\)");this._wwa=b;this._cgFileName=l;this._x=a;this._y=c;this._width=d;this._height=e;this._message=g;this._isVisible=z;this._isYesno=m;this._element=document.createElement("div");this._element.style.position="absolute";this._element.style.borderWidth="1px";this._element.style.borderStyle="solid";this._element.style.borderRadius="5px";this._element.classList.add("wwa-message-window");this._element.style.zIndex="400";this._element.style.opacity=
"0.9";this._msgWrapperElement=document.createElement("div");this._msgWrapperElement.style.padding="5px";this._msgWrapperElement.style.margin="0";this._msgWrapperElement.style.textAlign="left";this._msgWrapperElement.style.wordWrap="break-word";this._element.appendChild(this._msgWrapperElement);this._dummyElement=document.createElement("div");this._dummyElement.style.display="none";this._dummyElement.style.padding="0";this._dummyElement.style.margin="0";this._dummyElement.style.height="55px";this._element.appendChild(this._dummyElement);
this._ynWrapperElement=document.createElement("div");this._ynWrapperElement.style.padding="0";this._ynWrapperElement.style.margin="0";this._ynWrapperElement.style.position="absolute";this._ynWrapperElement.style.left="246px";this._ynWrapperElement.style.bottom="10px";this._ynWrapperElement.style.width="80px";this._ynWrapperElement.style.height="40px";this._ynWrapperElement.style.zIndex="10";this._element.appendChild(this._ynWrapperElement);this._parentElement=x;this._parentElement.appendChild(this._element);
this._divYesElement=document.createElement("div");this._divYesElement.style.padding="0";this._divYesElement.style.margin="0";this._divYesElement.style.cssFloat="left";this._divYesElement.style.width="40px";this._divYesElement.style.height="40px";this._divYesElement.style.background="url("+f+")";this._divYesElement.onclick=function(){r._isInputDisable||(b.setYesNoInput(0),r.update())};this._divYesElement.style.cursor="pointer";this._divNoElement=document.createElement("div");this._divNoElement.style.padding=
"0";this._divNoElement.style.margin="0";this._divNoElement.style.cssFloat="left";this._divNoElement.style.width="40px";this._divNoElement.style.height="40px";this._divNoElement.style.background="url("+f+")";this._divNoElement.onclick=function(){r._isInputDisable||(b.setYesNoInput(1),r.update())};this._divNoElement.style.cursor="pointer";this._ynWrapperElement.appendChild(this._divYesElement);this._ynWrapperElement.appendChild(this._divNoElement);r._isInputDisable=!1;this.update()}a.prototype.setPosition=
function(b,a,c,d){this._x=b;this._y=a;this._width=c;this._height=d;this.update()};a.prototype.setPositionByPlayerPosition=function(b,a,c,d,e){d=d.getPartsCoord().substract(e.getPartsCoord()).y;b=b?2:a?3:c?1:d>=Math.ceil(wwa_data.WWAConsts.V_PARTS_NUM_IN_WINDOW/2)?0:2;this.setPositionEasy(b)};a.prototype.setPositionEasy=function(b){var a=Math.floor(this._element.clientHeight/2);1===b?(this._y=wwa_data.WWAConsts.MAP_WINDOW_HEIGHT/2-a,this.update()):0===b?(this._y=Math.max(20,wwa_data.WWAConsts.MAP_WINDOW_HEIGHT/
4-a)+10,this.update()):2===b?(this._y=Math.min(wwa_data.WWAConsts.MAP_WINDOW_HEIGHT-20-this._element.clientHeight,3*wwa_data.WWAConsts.MAP_WINDOW_HEIGHT/4-a),this.update()):3===b&&(this._y=80,this.update())};a.prototype.setMessage=function(b){this._message=b;this.update()};a.prototype.setYesNoChoice=function(b){this._isInputDisable=!1;this._isYesno=b;this.update();return this._isYesno};a.prototype.isYesNoChoice=function(){return this._isYesno};a.prototype.setInputDisable=function(){this._isInputDisable=
!0};a.prototype.isInputDisable=function(){return this._isInputDisable};a.prototype.show=function(){this._isVisible=!0;this.update()};a.prototype.hide=function(){this._isVisible=!1;this.update()};a.prototype.isVisible=function(){return this._isVisible};a.prototype.update=function(){var b=this._wwa.getYesNoImgCoord();this._isYesno?(0===this._wwa.getYesNoState()?(this._divYesElement.style.backgroundPosition="-"+(b.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_YESP_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+b.y*wwa_data.WWAConsts.CHIP_SIZE+
"px",this._divNoElement.style.backgroundPosition="-"+(b.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_NO_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+b.y*wwa_data.WWAConsts.CHIP_SIZE+"px"):1===this._wwa.getYesNoState()?(this._divYesElement.style.backgroundPosition="-"+(b.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_YES_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+b.y*wwa_data.WWAConsts.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(b.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_NOP_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+
b.y*wwa_data.WWAConsts.CHIP_SIZE+"px"):(this._divYesElement.style.backgroundPosition="-"+(b.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_YES_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+b.y*wwa_data.WWAConsts.CHIP_SIZE+"px",this._divNoElement.style.backgroundPosition="-"+(b.x+wwa_data.WWAConsts.IMGRELPOS_YESNO_NO_X)*wwa_data.WWAConsts.CHIP_SIZE+"px -"+b.y*wwa_data.WWAConsts.CHIP_SIZE+"px"),this._ynWrapperElement.style.display="block"):this._ynWrapperElement.style.display="none";this._msgWrapperElement.textContent=
"";for(var b=this._message.split("\n"),a=0;a<b.length;a++){var c=document.createElement("span");c.textContent=b[a];this._msgWrapperElement.appendChild(c);this._msgWrapperElement.appendChild(document.createElement("br"))}this._isVisible?(this._element.style.left=this._x+"px",this._element.style.top=this._y+"px"):(this._element.style.left="-999999px",this._element.style.top="-999999px");this._element.style.width=this._width+"px";this._element.style.minHeight=this._height+"px";this._dummyElement.style.display=
this._isYesno?"block":"none"};return a}();e.MessageWindow=l})(wwa_message||(wwa_message={}));var wwa_monster;
(function(e){var c=function(){function c(d,e,a,b,k,u,p){this._partsID=d;this._position=e;this._imgCoord=a;this._status=b;this._message=k;this._item=u;this._battleEndCallback=p}Object.defineProperty(c.prototype,"partsID",{get:function(){return this._partsID},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"position",{get:function(){return this._position},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"imgCoord",{get:function(){return this._imgCoord},enumerable:!0,
configurable:!0});Object.defineProperty(c.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"message",{get:function(){return this._message},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"item",{get:function(){return this._item},enumerable:!0,configurable:!0});c.prototype.damage=function(c){this._status.energy=Math.max(0,this._status.energy-c)};c.prototype.battleEndProcess=function(){this._battleEndCallback()};
return c}();e.Monster=c})(wwa_monster||(wwa_monster={}));var wwa_motion;
(function(e){var c=function(){function c(d,a,b,e,l){this._player=d;this._objectID=a;this._srcPos=b;this._destPos=e;this._dir=l;this._currentPos=this._srcPos.clone()}c.prototype.update=function(){var c=this._player.getSpeedIndex();return this._currentPos=this._currentPos.getNextFramePosition(this._dir,wwa_data.speedList[c],wwa_data.speedList[c])};Object.defineProperty(c.prototype,"isAchievedDestination",{get:function(){return this._currentPos.equals(this._destPos)},enumerable:!0,configurable:!0});
Object.defineProperty(c.prototype,"currentPosition",{get:function(){return this._currentPos},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"beforePosition",{get:function(){return this._srcPos},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"destination",{get:function(){return this._destPos},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"objID",{get:function(){return this._objectID},enumerable:!0,configurable:!0});return c}();e.ObjectMovingData=
c;var d=function(){function d(c,a){this._wwa=c;this._player=a;this.clear()}d.prototype.add=function(d,a,b,e){this._queue.push(new c(this._player,d,a,b,e))};d.prototype.update=function(){for(var c=[],a=[],b=0;b<this._queue.length;b++)this._queue[b].update(),this._queue[b].isAchievedDestination?(c.push(this._queue[b]),this._wwa.setPartsOnPosition(0,0,this._queue[b].beforePosition.getPartsCoord()),this._wwa.setPartsOnPosition(0,this._queue[b].objID,this._queue[b].destination.getPartsCoord())):a.push(this._queue[b]);
this._queue=a;return c};d.prototype.clear=function(){this._queue=[]};Object.defineProperty(d.prototype,"objectMovingData",{get:function(){return this.objectMovingData},enumerable:!0,configurable:!0});d.prototype.getOffsetByBeforePartsCoord=function(c){var a=this._queue.filter(function(b){return b.beforePosition.getPartsCoord().equals(c)});return 0===a.length?null:a[0].currentPosition.getOffsetCoord()};return d}();e.ObjectMovingDataManager=d})(wwa_motion||(wwa_motion={}));var wwa_estimate_battle;
(function(e){var c=function(){function c(a,b,d){this.id=a;this.imgFileName=b;this.parent=d;this.elem=document.createElement("div");this.elem.classList.add("est");this.elem.setAttribute("id","wwa-est-"+a);this.imgElem=document.createElement("div");this.imgElem.classList.add("est-img-wrapper");this.imgElem.style.backgroundImage="url("+this.imgFileName.replace("(","\\(").replace(")","\\)")+")";this.statusElem=document.createElement("div");this.statusElem.classList.add("est-status-wrapper");this.energyElem=
document.createElement("div");this.energyElem.classList.add("est-energy");this.energyDispElem=document.createElement("span");this.energyDispElem.classList.add("est-energy-disp");this.energyElem.appendChild(this.energyDispElem);this.statusElem.appendChild(this.energyElem);this.strengthElem=document.createElement("div");this.strengthElem.classList.add("est-strength");this.strengthDispElem=document.createElement("span");this.strengthDispElem.classList.add("est-strength-disp");this.strengthElem.appendChild(this.strengthDispElem);
this.statusElem.appendChild(this.strengthElem);this.defenceElem=document.createElement("div");this.defenceElem.classList.add("est-defence");this.defenceDispElem=document.createElement("span");this.defenceDispElem.classList.add("est-defence-disp");this.defenceElem.appendChild(this.defenceDispElem);this.statusElem.appendChild(this.defenceElem);this.damageElem=document.createElement("div");this.damageElem.classList.add("est-damage");this.damageDispElem=document.createElement("span");this.damageDispElem.classList.add("est-damage-disp");
this.damageElem.appendChild(this.damageDispElem);this.statusElem.appendChild(this.damageElem);this.elem.appendChild(this.imgElem);this.elem.appendChild(this.statusElem)}c.prototype.hide=function(){this.elem.style.display="none"};c.prototype.show=function(){this.elem.style.display="block"};c.prototype.setResult=function(a,b,c){this.imgElem.style.backgroundPosition="-"+a.x+"px -"+a.y+"px";this.energyDispElem.textContent="\u751f\u547d\u529b "+b.energy;this.strengthDispElem.textContent="\u653b\u6483\u529b "+
b.strength;this.defenceDispElem.textContent="\u9632\u5fa1\u529b "+b.defence;this.damageDispElem.textContent=c.isNoEffect?"\u653b\u6483\u7121\u52b9":c.isOverMaxTurn?"\u9577\u671f\u6226\u304c\u4e88\u60f3\u3055\u308c\u307e\u3059":"\u4e88\u60f3\u30c0\u30e1\u30fc\u30b8 "+c.damage};return c}(),d=function(){function d(a,b,e){var g=this;this._wwa=a;this._imgFileName=b;this._parent=e;this._element=document.createElement("div");this._element.setAttribute("id","wwa-battle-estimate");this._element.style.display=
"none";this._edes=[];for(b=0;b<wwa_data.WWAConsts.BATTLE_ESTIMATE_MONSTER_TYPE_MAX;b++)a=new c(b,this._imgFileName,this._element),this._edes.push(a),this._element.appendChild(a.elem);this._element.addEventListener("click",function(){g._wwa.hideBattleEstimateWindow()});this._parent.appendChild(this._element)}d.prototype.update=function(a,b){for(var c=0;c<wwa_data.WWAConsts.BATTLE_ESTIMATE_MONSTER_TYPE_MAX;c++)if(c>=b.length)this._edes[c].hide();else{var d=this._wwa.getObjectAttributeById(b[c],wwa_data.WWAConsts.ATR_X),
e=this._wwa.getObjectAttributeById(b[c],wwa_data.WWAConsts.ATR_Y),d=new wwa_data.Coord(d,e),e=this._wwa.getObjectAttributeById(b[c],wwa_data.WWAConsts.ATR_ENERGY),g=this._wwa.getObjectAttributeById(b[c],wwa_data.WWAConsts.ATR_STRENGTH),w=this._wwa.getObjectAttributeById(b[c],wwa_data.WWAConsts.ATR_DEFENCE),e=new wwa_data.Status(e,g,w,0);a:{var g=e.energy,w=a.strength-e.defence,B=Math.max(0,e.strength-a.defence),z=0,m=0;if(0<w)for(;;){z++;g-=w;if(0>=g){g=new l(!1,!1,m);break a}m+=B;if(1E4<z){g=new l(!1,
!0,0);break a}}else g=new l(!0,!1,0)}this._edes[c].setResult(d,e,g);this._edes[c].show()}};d.prototype.show=function(){this._element.style.display="block"};d.prototype.hide=function(){this._element.style.display="none"};return d}();e.BattleEstimateWindow=d;var l=function(){return function(c,a,b){this.isNoEffect=c;this.isOverMaxTurn=a;this.damage=b}}()})(wwa_estimate_battle||(wwa_estimate_battle={}));var wwa_inject_html;
(function(e){e.inject=function(c,d){var e=document.createElement("style");e.type="text/css";e.setAttribute("id",wwa_data.WWAConsts.WWA_STYLE_TAG_ID);wwa_util.$tag("head")[0].appendChild(e);c.innerHTML='            <canvas id="wwa-map" class="wwa-canvas" width="440" height="440">                \u3053\u306e\u30d6\u30e9\u30a6\u30b6\u306f\u3001Canvas\u8981\u7d20\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u305b\u3093\u3002            </canvas>            <canvas id="wwa-map-sub" class="wwa-canvas" width="440" height="440"></canvas>            <div id="wwa-sidebar">                <div class="wide-cell-row" id="disp-energy"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="wide-cell-row" id="disp-strength"><div class="status-icon"></div><div class="status-value-box"> 0 </div></div>                <div class="wide-cell-row" id="disp-defence"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="wide-cell-row" id="disp-gold"><div class="status-icon"></div><div class="status-value-box">0</div></div>                <div class="item-cell" id="item0"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item1"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item2"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item3"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item4"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item5"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item6"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item7"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item8"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item9"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item10"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="item-cell" id="item11"><div class="item-click-border"></div><div class="item-disp"></div></div>                <div class="wide-cell-row" id="cell-load">Quick Load</div><div class="wide-button" id="button-load"></div>                <div class="wide-cell-row" id="cell-save">Quick Save</div><div class="wide-button" id="button-save"></div>                <div class="wide-cell-row" id="cell-restart">Restart Game</div><div class="wide-button" id="button-restart"></div>                <div class="wide-cell-row" id="cell-gotowwa">Go to WWA</div><div class="wide-button" id="button-gotowwa"></div>            </div>            <div id="wwa-controller"></div>            <div id="wwa-fader"></div>            <div id="wwa-cover">                 <div id="version"></div>                 <div id="progress-message-container">\u958b\u59cb\u3057\u3066\u3044\u307e\u3059...</div>                 <div id="progress-bar-bg"></div>                 <div id="progress-bar" class="progress-bar"></div>                 <div id="progress-bar-audio" class="progress-bar"></div>                 <div id="progress-disp">---</div>            </div>            <div id="wwa-audio-wrapper"></div>    ';
e=document.createElement("img");e.src=d;wwa_util.$id("wwa-cover").appendChild(e)}})(wwa_inject_html||(wwa_inject_html={}));var postMessage_noWorker=function(e){},wwa_main;
(function(e){function c(b,a,c){var r=new wwa_data.LoaderProgress;r.current=b;r.total=a;r.stage=c;return r}function d(){void 0===window.wwap_mode&&(wwap_mode=!1);Array.prototype.forEach.call(h.$qsAll("a.wwa-copyright"),function(b){b.addEventListener("click",function(){B=!0})});window.addEventListener("beforeunload",function(b){if(B)return B=!1,b.returnValue="\u3053\u306e\u30da\u30fc\u30b8\u3092\u96e2\u308c\u307e\u3059\u304b\uff1f"});var a=wwap_mode?b.WWAP_SERVER+"/"+b.WWAP_SERVER_TITLE_IMG:h.$id("wwa-wrapper").getAttribute("data-wwa-title-img");
wwa_inject_html.inject(h.$id("wwa-wrapper"),null===a?"cover.gif":a);var a=h.$id("wwa-wrapper").getAttribute("data-wwa-mapdata"),m=h.$id("wwa-wrapper").getAttribute("data-wwa-loader"),c=!0;h.$id("wwa-wrapper").getAttribute("data-wwa-urlgate-enable").match(/^false$/i)&&(c=!1);new w(a,m,c)}var l=wwa_input.KeyStore,g=wwa_input.MouseStore,a=wwa_cgmanager.CGManager,b=wwa_data.WWAConsts,k=wwa_data.Coord,u=wwa_data.Position,p=wwa_camera.Camera,h=wwa_util;e.getProgress=c;var w=function(){function d(m,x,r){var f=
this;void 0===r&&(r=!1);try{h.$id("version").textContent="WWA Wing Ver."+b.VERSION_WWAJS}catch(e){}this._isURLGateEnable=r;this._animationCounter=this._mainCallCounter=0;this._statusPressCounter=new wwa_data.Status(0,0,0,0);var n=(new Date).getTime();location.href.match(/^file/)&&alert("\u3010\u8b66\u544a\u3011\u76f4\u63a5HTML\u30d5\u30a1\u30a4\u30eb\u3092\u958b\u3044\u3066\u3044\u308b\u3088\u3046\u3067\u3059\u3002\n\u3053\u306e\u30d7\u30ed\u30b0\u30e9\u30e0\u306f\u6b63\u5e38\u306b\u52d5\u4f5c\u3057\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\n\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u306e\u78ba\u8a8d\u3092\u884c\u3046\u5834\u5408\u306b\u306f\u540c\u68b1\u306e\u300cWWA Debugger\u300d\u3092\u3054\u5229\u7528\u304f\u3060\u3055\u3044\u3002");
if(void 0===window.audiojs)alert("Audio.js\u306e\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002audio\u30d5\u30a9\u30eb\u30c0\u306e\u4e2d\u306baudio.min.js\u306f\u914d\u7f6e\u3055\u308c\u3066\u3044\u307e\u3059\u304b\uff1f");else if(this._loadHandler=function(m){if(null!==m.data.error&&void 0!==m.data.error)alert("\u4e0b\u8a18\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002: \n"+m.data.error.message);else if(null!==m.data.progress&&void 0!==m.data.progress)f._setProgressBar(m.data.progress);
else{f._wwaData=m.data.wwaData;f.initCSSRule();f._setProgressBar(c(0,4,7));m=new Image;m.src=f._wwaData.mapCGName;m.addEventListener("error",function(){alert("\u753b\u50cf\u30d5\u30a1\u30a4\u30eb\u300c"+f._wwaData.mapCGName+"\u300d\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\n\u7ba1\u7406\u8005\u306e\u65b9\u3078: \u30c7\u30fc\u30bf\u304c\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u308b\u304b\u3001\u30d1\u30fc\u30df\u30c3\u30b7\u30e7\u30f3\u3092\u78ba\u304b\u3081\u3066\u304f\u3060\u3055\u3044\u3002")});
f._restartData=JSON.parse(JSON.stringify(f._wwaData));var d=f._wwaData.mapCGName.replace("(","\\(").replace(")","\\)");Array.prototype.forEach.call(h.$qsAll("div.item-cell"),function(b){b.style.backgroundPosition="-40px -80px";b.style.backgroundImage="url("+d+")"});Array.prototype.forEach.call(h.$qsAll("div.wide-cell-row"),function(b){b.style.backgroundPosition="-160px -120px";b.style.backgroundImage="url("+d+")"});Array.prototype.forEach.call(h.$qsAll(".item-cell>.item-click-border"),function(a){a.style.backgroundImage=
"url('"+b.ITEM_BORDER_IMG_DATA_URL+"')";a.style.backgroundPosition="0 0";a.style.display="none";a.style.cursor="pointer"});Array.prototype.forEach.call(h.$qsAll(".item-cell>.item-disp"),function(b){b.style.backgroundImage="url("+d+")"});m=h.$qsh("#disp-energy>.status-icon");m.style.backgroundPosition="-120px -80px";m.style.backgroundImage="url("+d+")";m=h.$qsh("#disp-strength>.status-icon");m.style.backgroundPosition="-160px -80px";m.style.backgroundImage="url("+d+")";m=h.$qsh("#disp-defence>.status-icon");
m.style.backgroundPosition="-200px -80px";m.style.backgroundImage="url("+d+")";m=h.$qsh("#disp-gold>.status-icon");m.style.backgroundPosition="-240px -80px";m.style.backgroundImage="url("+d+")";f._setProgressBar(c(1,4,7));f._replaceAllRandomObjects();m=(new Date).getTime();console.log("Loading Complete!"+(m-n)+"ms");f._cvs=h.$id("wwa-map");f._cvsSub=h.$id("wwa-map-sub");m=f._cvs.getContext("2d");var x=f._cvsSub.getContext("2d");m.fillStyle="rgba( 255, 255, 255, 0.5)";m.fillRect(0,0,440,440);var r=
new u(f,f._wwaData.playerX,f._wwaData.playerY);f._camera=new p(r);var e=new wwa_data.Status(f._wwaData.statusEnergy,f._wwaData.statusStrength,f._wwaData.statusDefence,f._wwaData.statusGold);f._player=new wwa_parts_player.Player(f,r,f._camera,e,f._wwaData.statusEnergyMax);f._objectMovingDataManager=new wwa_motion.ObjectMovingDataManager(f,f._player);f._camera.setPlayer(f._player);f._keyStore=new l;f._mouseStore=new g;f._messageQueue=[];f._yesNoJudge=2;f._yesNoJudgeInNextFrame=2;f._yesNoChoiceCallInfo=
0;f._prevFrameEventExected=!1;f._lastMessage=new wwa_message.MessageInfo("",!1,!1,[]);f._execMacroListInNextFrame=[];f._setProgressBar(c(2,4,7));window.addEventListener("keydown",function(b){f._keyStore.setPressInfo(b.keyCode);40!==b.keyCode&&37!==b.keyCode&&39!==b.keyCode&&38!==b.keyCode&&16!==b.keyCode&&13!==b.keyCode&&49!==b.keyCode&&50!==b.keyCode&&51!==b.keyCode&&65!==b.keyCode&&67!==b.keyCode&&68!==b.keyCode&&69!==b.keyCode&&77!==b.keyCode&&78!==b.keyCode&&81!==b.keyCode&&83!==b.keyCode&&87!==
b.keyCode&&88!==b.keyCode&&89!==b.keyCode&&90!==b.keyCode&&27!==b.keyCode&&112!==b.keyCode&&114!==b.keyCode&&115!==b.keyCode&&116!==b.keyCode&&117!==b.keyCode&&118!==b.keyCode&&119!==b.keyCode&&123!==b.keyCode&&32!==b.keyCode||b.preventDefault()});window.addEventListener("keyup",function(b){f._keyStore.setReleaseInfo(b.keyCode);40!==b.keyCode&&37!==b.keyCode&&39!==b.keyCode&&38!==b.keyCode&&16!==b.keyCode&&13!==b.keyCode&&49!==b.keyCode&&50!==b.keyCode&&51!==b.keyCode&&65!==b.keyCode&&67!==b.keyCode&&
68!==b.keyCode&&69!==b.keyCode&&77!==b.keyCode&&78!==b.keyCode&&81!==b.keyCode&&83!==b.keyCode&&87!==b.keyCode&&88!==b.keyCode&&89!==b.keyCode&&90!==b.keyCode&&27!==b.keyCode&&112!==b.keyCode&&114!==b.keyCode&&115!==b.keyCode&&116!==b.keyCode&&117!==b.keyCode&&118!==b.keyCode&&119!==b.keyCode&&123!==b.keyCode&&32!==b.keyCode||b.preventDefault()});window.addEventListener("blur",function(b){f._keyStore.allClear();f._mouseStore.clear()});window.addEventListener("contextmenu",function(b){f._keyStore.allClear();
f._mouseStore.clear()});window.addEventListener("help",function(b){b.preventDefault()});f._wwaWrapperElement=wwa_util.$id("wwa-wrapper");f._mouseControllerElement=wwa_util.$id("wwa-controller");f._mouseControllerElement.addEventListener("mousedown",function(b){if(1===b.which){if(0===f._mouseStore.getMouseState()){var a=wwa_util.$localPos(b.clientX,b.clientY),m=f._player.getDrawingCenterPosition(),a=a.substract(m),m=Math.abs(a.x),d=Math.abs(a.y),c;0<a.y&&d>m?c=2:0>a.y&&d>m?c=3:0<a.x&&d<m?c=1:0>a.x&&
d<m&&(c=0);f._mouseStore.setPressInfo(c)}b.preventDefault()}});f._mouseControllerElement.addEventListener("mouseleave",function(b){f._mouseStore.clear()});f._mouseControllerElement.addEventListener("mouseup",function(b){1===b.which&&(f._mouseStore.setReleaseInfo(),b.preventDefault())});window.TouchEvent&&(f._mouseControllerElement.addEventListener("touchstart",function(b){if(0!==f._mouseStore.getMouseState())b.preventDefault();else{var a=wwa_util.$localPos(b.changedTouches[0].clientX,b.changedTouches[0].clientY),
m=f._player.getDrawingCenterPosition(),a=a.substract(m),m=Math.abs(a.x),d=Math.abs(a.y),c;0<a.y&&d>m?c=2:0>a.y&&d>m?c=3:0<a.x&&d<m?c=1:0>a.x&&d<m&&(c=0);f._mouseStore.setPressInfo(c,b.changedTouches[0].identifier);b.cancelable&&b.preventDefault()}}),f._mouseControllerElement.addEventListener("touchend",function(b){for(var a=0;a<b.changedTouches.length;a++)if(f._mouseStore.getTouchID()===b.changedTouches[a].identifier){f._mouseStore.setReleaseInfo();b.preventDefault();break}}),f._mouseControllerElement.addEventListener("touchcancel",
function(b){for(var a=0;a<b.changedTouches.length;a++)if(f._mouseStore.getTouchID()===b.changedTouches[a].identifier){f._mouseStore.setReleaseInfo();b.preventDefault();break}}));h.$id("button-load").addEventListener("click",function(){if(f._player.isControllable())f.onselectbutton(0)});h.$id("button-save").addEventListener("click",function(){if(f._player.isControllable())f.onselectbutton(1)});h.$id("button-restart").addEventListener("click",function(){if(f._player.isControllable())f.onselectbutton(2)});
h.$id("button-gotowwa").addEventListener("click",function(){if(f._player.isControllable())f.onselectbutton(3)});Array.prototype.forEach.call(h.$qsAll(".wide-cell-row"),function(b){b.addEventListener("click",function(){f._displayHelp()})});f._frameCoord=new k(b.IMGPOS_DEFAULT_FRAME_X,b.IMGPOS_DEFAULT_YESNO_Y);f._battleEffectCoord=new k(b.IMGPOS_DEFAULT_BATTLE_EFFECT_X,b.IMGPOS_DEFAULT_BATTLE_EFFECT_Y);f._battleEstimateWindow=new wwa_estimate_battle.BattleEstimateWindow(f,f._wwaData.mapCGName,wwa_util.$id("wwa-wrapper"));
f._messageWindow=new wwa_message.MessageWindow(f,50,180,340,0,"",f._wwaData.mapCGName,!1,!0,h.$id("wwa-wrapper"));f._monsterWindow=new wwa_message.MosterWindow(f,new k(50,180),340,60,!1,h.$id("wwa-wrapper"),f._wwaData.mapCGName);f._scoreWindow=new wwa_message.ScoreWindow(f,new k(50,50),!1,h.$id("wwa-wrapper"));f._setProgressBar(c(3,4,7));f._isLoadedSound=!1;f._temporaryInputDisable=!1;f._paintSkipByDoorOpen=!1;f._clearFacesInNextFrame=!1;f._useConsole=!1;f.clearFaces();f._cgManager=new a(m,x,f._wwaData.mapCGName,
function(){if("ON"===f._wwaData.systemMessage[2])f._isLoadedSound=!0,f.setMessageQueue("\u30b2\u30fc\u30e0\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\u753b\u9762\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u304f\u3060\u3055\u3044\u3002\n(iOS, Android\u7aef\u672b\u3067\u306f\u97f3\u697d\u306f\u518d\u751f\u3055\u308c\u307e\u305b\u3093\u3002)",!1,!0),f.loadSound(),setTimeout(f.soundCheckCaller,b.DEFAULT_FRAME_INTERVAL,f);else if("OFF"===f._wwaData.systemMessage[2])f._isLoadedSound=!1,f.setMessageQueue("\u30b2\u30fc\u30e0\u3092\u958b\u59cb\u3057\u307e\u3059\u3002\n\u753b\u9762\u3092\u30af\u30ea\u30c3\u30af\u3057\u3066\u304f\u3060\u3055\u3044\u3002",
!1,!0),f.openGameWindow();else{f._messageWindow.setMessage((""===f._wwaData.systemMessage[2]?"\u52b9\u679c\u97f3\u30fb\uff22\uff27\uff2d\u30c7\u30fc\u30bf\u3092\u30ed\u30fc\u30c9\u3057\u307e\u3059\u304b\uff1f":f._wwaData.systemMessage[2])+"\n(iOS, Android\u7aef\u672b\u3067\u306f\u97f3\u697d\u306f\u518d\u751f\u3055\u308c\u307e\u305b\u3093\u3002)");f._messageWindow.show();f._setProgressBar(c(4,4,7));var a=setInterval(function(){f._keyStore.update();if(2===f._yesNoJudgeInNextFrame)if(1===f._keyStore.getKeyState(13)||
1===f._keyStore.getKeyState(89))f._yesNoJudgeInNextFrame=0;else if(1===f._keyStore.getKeyState(78)||1===f._keyStore.getKeyState(27))f._yesNoJudgeInNextFrame=1;0===f._yesNoJudgeInNextFrame?(clearInterval(a),f._messageWindow.update(),f._yesNoJudge=f._yesNoJudgeInNextFrame,f._messageWindow.setInputDisable(),setTimeout(function(){f._messageWindow.update();setTimeout(function(){f._messageWindow.hide();f._yesNoJudge=2;f._yesNoJudgeInNextFrame=2;f._isLoadedSound=!0;f.loadSound();setTimeout(f.soundCheckCaller,
b.DEFAULT_FRAME_INTERVAL,f)},b.YESNO_PRESS_DISP_FRAME_NUM*b.DEFAULT_FRAME_INTERVAL)},b.DEFAULT_FRAME_INTERVAL)):1===f._yesNoJudgeInNextFrame&&(clearInterval(a),f._messageWindow.update(),f._yesNoJudge=f._yesNoJudgeInNextFrame,f._messageWindow.setInputDisable(),setTimeout(function(){f._messageWindow.update();setTimeout(function(){f._messageWindow.hide();f._yesNoJudge=2;f._yesNoJudgeInNextFrame=2;f._isLoadedSound=!1;f.openGameWindow()},b.YESNO_PRESS_DISP_FRAME_NUM*b.DEFAULT_FRAME_INTERVAL)},b.DEFAULT_FRAME_INTERVAL))},
b.DEFAULT_FRAME_INTERVAL)}})}},wwap_mode||void 0===Worker){if(external_script_inject_mode){if(x=document.getElementById("wwaloader-ex"),!x.src.match(/^http:\/\/wwawing\.com/)&&!x.src.match(/^http:\/\/www\.wwawing\.com/))throw Error("SCRIPT ORIGIN ERROR");}else x=document.createElement("script"),x.src=wwap_mode?b.WWAP_SERVER+"/"+b.WWAP_SERVER_LOADER_NO_WORKER:"wwaload.noworker.js",document.getElementsByTagName("head")[0].appendChild(x);var q=this;postMessage_noWorker=function(b){q._loadHandler(b)};
try{loader_start({data:{fileName:m+"?date="+n}})}catch(D){alert(D.message),x.onload=function(){loader_start({data:{fileName:m+"?date="+n}})}}}else try{var C=new Worker(x+"?date="+n);C.postMessage({fileName:m+"?date="+n});C.addEventListener("message",this._loadHandler)}catch(E){alert("\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u306e\u30ed\u30fc\u30c9\u6642\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002:\nWebWorker\u306e\u751f\u6210\u306b\u5931\u6557\u3057\u307e\u3057\u305f\u3002"+
E.message)}}d.prototype._setProgressBar=function(a){a.stage<=b.LOAD_STAGE_MAX_EXCEPT_AUDIO?(wwa_util.$id("progress-message-container").textContent=a.stage===b.LOAD_STAGE_MAX_EXCEPT_AUDIO?"World Name: "+this._wwaData.worldName:wwa_data.loadMessages[a.stage],wwa_util.$id("progress-bar").style.width=(1*a.stage+a.current/a.total*1)/(b.LOAD_STAGE_MAX_EXCEPT_AUDIO+1)*b.MAP_WINDOW_WIDTH+"px",wwa_util.$id("progress-disp").textContent=((1*a.stage+a.current/a.total*1)/(b.LOAD_STAGE_MAX_EXCEPT_AUDIO+1)*100).toFixed(2)+
"%"):(wwa_util.$id("progress-message-container").textContent="\u52b9\u679c\u97f3/BGM\u3092\u8aad\u307f\u8fbc\u3093\u3067\u3044\u307e\u3059\u3002(\u30b9\u30da\u30fc\u30b9\u30ad\u30fc\u3067\u30b9\u30ad\u30c3\u30d7\uff09",wwa_util.$id("progress-bar-audio").style.width=a.current*b.MAP_WINDOW_WIDTH/a.total+"px",wwa_util.$id("progress-disp").textContent=(a.current/a.total*100).toFixed(2)+"%")};d.prototype.createAudioJSInstance=function(a,d){if(0!==a&&void 0===this._audioJSInstances[a]&&99!==a){var c=wwap_mode?
b.WWAP_SERVER+"/"+b.WWAP_SERVER_AUDIO_DIR+"/"+a+".mp3":"./audio/"+a+".mp3",f=new Audio(c);f.preload="auto";70<=a&&(f.loop=!0);h.$id("wwa-audio-wrapper").appendChild(f);this._audioJSInstances[a]=audiojs.create(f);70>a&&(c=new Audio(c),c.preload="auto",h.$id("wwa-audio-wrapper").appendChild(c),this._audioJSInstancesSub[a]=audiojs.create(c))}};d.prototype.loadSound=function(){this._audioJSInstances=Array(b.SOUND_MAX+1);this._audioJSInstancesSub=Array(b.SOUND_MAX+1);this.createAudioJSInstance(1);this.createAudioJSInstance(3);
for(var a=1;a<this._wwaData.mapPartsMax;a++){var c=this._wwaData.mapAttribute[a][b.ATR_SOUND];this.createAudioJSInstance(c)}for(a=1;a<this._wwaData.objPartsMax;a++)this._wwaData.objectAttribute[a][b.ATR_TYPE]!==b.OBJECT_RANDOM&&(c=this._wwaData.objectAttribute[a][b.ATR_SOUND],this.createAudioJSInstance(c));this._wwaData.bgm=0;this._soundLoadSkipFlag=!1};d.prototype.checkAllSoundLoaded=function(){var a=0,d=0;this._keyStore.update();1===this._keyStore.getKeyState(32)&&(this._soundLoadSkipFlag=!0);for(var r=
1;r<=b.SOUND_MAX;r++)void 0===this._audioJSInstances[r]||this._audioJSInstances[r].wrapper.classList.contains("error")||(d++,this._audioJSInstances[r].wrapper.classList.contains("loading")||a++);a<d&&!this._soundLoadSkipFlag?(this._setProgressBar(c(a,d,8)),setTimeout(this.soundCheckCaller,b.DEFAULT_FRAME_INTERVAL,this)):(this._setProgressBar(c(b.SOUND_MAX,b.SOUND_MAX,8)),this.openGameWindow())};d.prototype.playSound=function(a){var c=this;if(this._isLoadedSound){if(0>a||a>b.SOUND_MAX)throw Error("\u30b5\u30a6\u30f3\u30c9\u756a\u53f7\u304c\u7bc4\u56f2\u5916\u3067\u3059\u3002");
if(!(70<=a&&this._wwaData.bgm===a)&&((99===a||70<=a)&&0!==this._wwaData.bgm&&(this._audioJSInstances[this._wwaData.bgm].wrapper.classList.contains("loading")||this._audioJSInstances[this._wwaData.bgm].pause(),this._wwaData.bgm=0),0!==a&&99!==a))if(this._audioJSInstances[a].wrapper.classList.contains("loading")){if(70<=a){var d=function(b,a){var m=setInterval(function(){a._wwaData.bgm===b?a._audioJSInstances[b].wrapper.classList.contains("loading")||(c._audioJSInstances[b].skipTo(0),c._audioJSInstances[b].play(),
c._wwaData.bgm=b,clearInterval(m)):(clearInterval(m),99!==a._wwaData.bgm&&d(a._wwaData.bgm,a))},4)};d(a,this)}this._wwaData.bgm=a}else 0===a||this._audioJSInstances[a].wrapper.classList.contains("error")||(70<=a?(this._audioJSInstances[a].skipTo(0),this._audioJSInstances[a].play(),this._wwaData.bgm=a):this._nextSoundIsSub?(this._audioJSInstancesSub[a].skipTo(0),this._audioJSInstancesSub[a].play(),this._nextSoundIsSub=!1):(this._audioJSInstances[a].skipTo(0),this._audioJSInstances[a].play(),this._nextSoundIsSub=
!0))}};d.prototype.openGameWindow=function(){var a=this,c=this._player.getPosition();h.$id("wwa-cover").style.opacity="0";0!==this.getObjectIdByPosition(c)&&this._player.setPartsAppearedFlag();setTimeout(function(){h.$id("wwa-wrapper").removeChild(h.$id("wwa-cover"));a._main()},b.SPLASH_SCREEN_DISP_MILLS)};d.prototype.mainCaller=function(b){b._main()};d.prototype.soundCheckCaller=function(b){b.checkAllSoundLoaded()};d.prototype.onselectitem=function(a){if(this._player.canUseItem(a))if(wwa_util.$id("item"+
(a-1)).classList.add("onpress"),this.playSound(1),"BLANK"===this._wwaData.message[8]){this._player.readyToUseItem(a);a=this._player.useItem();var c=this.getObjectAttributeById(a,b.ATR_STRING);this.setMessageQueue(this.getMessageById(c),!1,!1,a,0,this._player.getPosition().getPartsCoord())}else this.setMessageQueue(""===this._wwaData.message[8]?"\u3053\u306e\u30a2\u30a4\u30c6\u30e0\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b?":this._wwaData.message[8],!0,!0),
this._yesNoChoiceCallInfo=3,this._yesNoUseItemPos=a};d.prototype.onselectbutton=function(b){var a=wwa_util.$id(wwa_data.sidebarButtonCellElementID[b]);this.playSound(1);a.classList.add("onpress");0===b?void 0!==this._quickSaveData?(this.setMessageQueue("\u30c7\u30fc\u30bf\u3092\u8aad\u307f\u8fbc\u307f\u307e\u3059\u304b\uff1f\n\u203b\u30d1\u30b9\u30ef\u30fc\u30c9\u30ed\u30fc\u30c9\u306f\u3001\u73fe\u5728\u3054\u5229\u7528\u306b\u306a\u308c\u307e\u305b\u3093\u3002",!0,!0),this._yesNoChoiceCallInfo=
5):this.setMessageQueue("\u30bb\u30fc\u30d6\u30c7\u30fc\u30bf\u304c\u3042\u308a\u307e\u305b\u3093\u3002\n\u203b\u30d1\u30b9\u30ef\u30fc\u30c9\u30ed\u30fc\u30c9\u306f\u3001\u73fe\u5728\u3054\u5229\u7528\u306b\u306a\u308c\u307e\u305b\u3093\u3002",!1,!0):1===b?this._wwaData.disableSaveFlag?this.setMessageQueue("\u3053\u3053\u3067\u306f\u30bb\u30fc\u30d6\u6a5f\u80fd\u306f\n\u4f7f\u7528\u3067\u304d\u307e\u305b\u3093\u3002",!1,!0):(this.setMessageQueue("\u30c7\u30fc\u30bf\u306e\u4e00\u6642\u4fdd\u5b58\u3092\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f\n\u203b\u30d1\u30b9\u30ef\u30fc\u30c9\u30bb\u30fc\u30d6\u306f\u3001\u73fe\u5728\u3054\u5229\u7528\u306b\u306a\u308c\u307e\u305b\u3093\u3002",
!0,!0),this._yesNoChoiceCallInfo=4):2===b?(this.setMessageQueue("\u521d\u3081\u304b\u3089\u30b9\u30bf\u30fc\u30c8\u3057\u306a\u304a\u3057\u307e\u3059\u304b\uff1f",!0,!0),this._yesNoChoiceCallInfo=6):3===b&&(this.setMessageQueue("\uff37\uff37\uff21\u306e\u516c\u5f0f\u30b5\u30a4\u30c8\u3092\u958b\u304d\u307e\u3059\u304b\uff1f",!0,!0),this._yesNoChoiceCallInfo=7)};d.prototype.onchangespeed=function(a){a=0===a?this._player.speedUp():this._player.speedDown();this.setMessageQueue("\u79fb\u52d5\u901f\u5ea6\u3092\u3010"+
wwa_data.speedNameList[a]+"\u3011\u306b\u5207\u308a\u66ff\u3048\u307e\u3057\u305f\u3002\n"+(a===b.MAX_SPEED_INDEX?"\u6226\u95d8\u3082\u901f\u304f\u306a\u308a\u307e\u3059\u3002\n":"")+"("+(b.MAX_SPEED_INDEX+1)+"\u6bb5\u968e\u4e2d"+(a+1)+"\uff09 \u901f\u5ea6\u3092\u843d\u3068\u3059\u306b\u306fI\u30ad\u30fc, \u901f\u5ea6\u3092\u4e0a\u3052\u308b\u306b\u306fP\u30ad\u30fc\u3092\u62bc\u3057\u3066\u304f\u3060\u3055\u3044\u3002",!1,!0)};d.prototype._main=function(){var a=this;this._temporaryInputDisable=!1;
this._waitTimeInCurrentFrame=b.DEFAULT_FRAME_INTERVAL;this._stopUpdateByLoadFlag=!1;this._keyStore.update();this._mouseStore.update();void 0!==this._yesNoJudgeInNextFrame&&(this._yesNoJudge=this._yesNoJudgeInNextFrame,this._yesNoJudgeInNextFrame=void 0);this._clearFacesInNextFrame&&(this.clearFaces(),this._clearFacesInNextFrame=!1);for(var c=0;c<this._execMacroListInNextFrame.length;c++)this._execMacroListInNextFrame[c].execute();""===this._lastMessage.message&&this._lastMessage.isEndOfPartsEvent&&
void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=void 0);this._execMacroListInNextFrame=[];this._player.getPosition();c=this._player.getDir();if(this._player.isControllable()){if(1===this._keyStore.getKeyStateForControllPlayer(37)||1===this._mouseStore.getMouseStateForControllPlayer(0))this._player.controll(0),this._objectMovingDataManager.update();else if(1===this._keyStore.getKeyStateForControllPlayer(38)||1===this._mouseStore.getMouseStateForControllPlayer(3))this._player.controll(3),
this._objectMovingDataManager.update();else if(1===this._keyStore.getKeyStateForControllPlayer(39)||1===this._mouseStore.getMouseStateForControllPlayer(1))this._player.controll(1),this._objectMovingDataManager.update();else if(1===this._keyStore.getKeyStateForControllPlayer(40)||1===this._mouseStore.getMouseStateForControllPlayer(2))this._player.controll(2),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(wwa_data.dirToKey[c]))this._player.controll(c),this._objectMovingDataManager.update();
else if(this._keyStore.checkHitKey(37)||this._mouseStore.checkClickMouse(0))this._player.controll(0),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(38)||this._mouseStore.checkClickMouse(3))this._player.controll(3),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(39)||this._mouseStore.checkClickMouse(1))this._player.controll(1),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(40)||this._mouseStore.checkClickMouse(2))this._player.controll(2),
this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(37)||this._mouseStore.checkClickMouse(0))this._player.controll(0),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(38)||this._mouseStore.checkClickMouse(3))this._player.controll(3),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(39)||this._mouseStore.checkClickMouse(1))this._player.controll(1),this._objectMovingDataManager.update();else if(this._keyStore.checkHitKey(40)||this._mouseStore.checkClickMouse(2))this._player.controll(2),
this._objectMovingDataManager.update();else if(1===this._keyStore.getKeyState(49))this.onselectitem(1);else if(1===this._keyStore.getKeyState(50))this.onselectitem(2);else if(1===this._keyStore.getKeyState(51))this.onselectitem(3);else if(1===this._keyStore.getKeyState(81))this.onselectitem(4);else if(1===this._keyStore.getKeyState(87))this.onselectitem(5);else if(1===this._keyStore.getKeyState(69))this.onselectitem(6);else if(1===this._keyStore.getKeyState(65))this.onselectitem(7);else if(1===this._keyStore.getKeyState(83))this.onselectitem(8);
else if(1===this._keyStore.getKeyState(68))this.onselectitem(9);else if(1===this._keyStore.getKeyState(90))this.onselectitem(10);else if(1===this._keyStore.getKeyState(88))this.onselectitem(11);else if(1===this._keyStore.getKeyState(67))this.onselectitem(12);else if(this._keyStore.getKeyState(73))this.onchangespeed(1);else if(this._keyStore.checkHitKey(80))this.onchangespeed(0);else if(1===this._keyStore.getKeyState(112)||1===this._keyStore.getKeyState(77))this.launchBattleEstimateWindow();else if(!this._keyStore.checkHitKey(114)&&
!this._keyStore.checkHitKey(115))if(this._keyStore.checkHitKey(116))this.onselectbutton(0);else if(this._keyStore.checkHitKey(117))this.onselectbutton(1);else if(this._keyStore.checkHitKey(118))this.onselectbutton(2);else if(this._keyStore.checkHitKey(119))this.onselectbutton(3);else this._keyStore.checkHitKey(123)&&this._displayHelp();this._keyStore.memorizeKeyStateOnControllableFrame();this._mouseStore.memorizeMouseStateOnControllableFrame()}else if(this._player.isJumped())this._camera.isResetting()||
this._player.processAfterJump();else if(this._player.isMoving())this._player.move(),this._objectMovingDataManager.update();else if(this._player.isWaitingMessage())if(this._messageWindow.isVisible()||this._messageWindow.show(),!this._messageWindow.isYesNoChoice()){var c=this._keyStore.getKeyStateForMessageCheck(13),d=this._keyStore.getKeyStateForMessageCheck(32),f=this._keyStore.getKeyStateForMessageCheck(27);if(1===c||4===c||1===d||4===d||1===f||4===f||1===this._mouseStore.getMouseState()){for(c=
0;c<wwa_data.sidebarButtonCellElementID.length;c++)d=wwa_util.$id(wwa_data.sidebarButtonCellElementID[c]),d.classList.contains("onpress")&&d.classList.remove("onpress");this._setNextMessage()}}else{if(!this._messageWindow.isInputDisable()){if(2===this._yesNoJudge)if(1===this._keyStore.getKeyState(13)||1===this._keyStore.getKeyState(89))this._yesNoJudge=0;else if(1===this._keyStore.getKeyState(78)||1===this._keyStore.getKeyState(27))this._yesNoJudge=1;0===this._yesNoJudge?(this.playSound(1),this._yesNoDispCounter=
b.YESNO_PRESS_DISP_FRAME_NUM,this._messageWindow.setInputDisable(),this._messageWindow.update()):1===this._yesNoJudge&&(this.playSound(1),this._yesNoDispCounter=b.YESNO_PRESS_DISP_FRAME_NUM,this._messageWindow.setInputDisable(),this._messageWindow.update())}}else this._player.isWatingEstimateWindow()?1!==this._keyStore.getKeyState(13)&&1!==this._keyStore.getKeyState(32)||this.hideBattleEstimateWindow():this._player.isFighting()?(this._player.fight(),this._monsterWindow.update(this._monster)):this._player.isWaitingMoveMacro()&&
(this._player.isMoveObjectAutoExecTime()&&(this.moveObjects(!1),this._player.resetMoveObjectAutoExecTimer()),this._objectMovingDataManager.update());this._prevFrameEventExected=!1;this._player.getPosition().isJustPosition()&&this._camera.getPosition().isScreenTopPosition()&&(this._player.isJumped()||this._player.isWaitingMessage()||this._player.isWaitingMoveMacro()||this._player.isFighting()||(this._player.isPartsAppearedTime()&&this._player.clearPartsAppearedFlag(),this._replaceRandomObjectsInScreen(),
(c=this.checkMap())||this.checkObject(),this._prevFrameEventExected=c),this._player.isWaitingMessage()&&this._messageWindow.isYesNoChoice()&&2!==this._yesNoJudge&&!this._player.isWaitingMoveMacro()&&!this._player.isFighting()&&this._execChoiceWindowRunningEvent());this._drawAll();this._mainCallCounter++;this._mainCallCounter%=1E9;this._animationCounter=(this._animationCounter+1)%(2*b.ANIMATION_REP_HALF_FRAME);this._camera.isResetting()&&this._camera.advanceTransitionStepNum();this._player.isWaitingMessage()||
(this._player.decrementLookingAroundTimer(),0<this._statusPressCounter.energy&&0===--this._statusPressCounter.energy&&wwa_util.$id("disp-energy").classList.remove("onpress"),0<this._statusPressCounter.strength&&0===--this._statusPressCounter.strength&&wwa_util.$id("disp-strength").classList.remove("onpress"),0<this._statusPressCounter.defence&&0===--this._statusPressCounter.defence&&wwa_util.$id("disp-defence").classList.remove("onpress"),0<this._statusPressCounter.gold&&0===--this._statusPressCounter.gold&&
wwa_util.$id("disp-gold").classList.remove("onpress"));this._player.isWaitingMoveMacro()&&this._player.decrementMoveObjectAutoExecTimer();this._stopUpdateByLoadFlag?this._fadeout(function(){0===a._loadType?a._quickLoad():1===a._loadType&&a._restartGame();setTimeout(a.mainCaller,a._waitTimeInCurrentFrame,a)}):setTimeout(this.mainCaller,this._waitTimeInCurrentFrame,this)};d.prototype._drawAll=function(){var a=this._camera.getPosition().getPartsCoord(),c=this._camera.getPosition().getOffsetCoord(),d=
b.MAP_WINDOW_HEIGHT,f;f=this._player.getPosition().getPartsCoord();if(this._paintSkipByDoorOpen)this._paintSkipByDoorOpen=!1;else{this._cgManager.clearCanvas(0,0,b.MAP_WINDOW_WIDTH,b.MAP_WINDOW_HEIGHT);this._cgManager.drawBase(0,0,b.MAP_WINDOW_WIDTH,b.MAP_WINDOW_HEIGHT);if(this._camera.isResetting()){if(null!==this._camera.getPreviousPosition())var e=this._camera.getPreviousPosition().getPartsCoord(),n=this._camera.getPreviousPosition().getOffsetCoord();d=this._camera.getTransitionStepNum()*b.CHIP_SIZE;
this._drawMap(e,n,d,!0);this._drawPlayer(e,n,d,!0);this._drawObjects(e,n,d,!0);if(this._camera.isFinalStep())var q=255,g=setInterval(function(){var a=wwa_util.$id("wwa-fader");q-=3*b.FADEOUT_SPEED;0>=q?(clearInterval(g),a.style.backgroundColor="transparent",a.removeAttribute("style"),a.style.display="none"):a.style.opacity=q/255+""},20)}this._drawMap(a,c,d);this._drawPlayer(a,c,d);this._drawObjects(a,c,d);this._player.isFighting()&&!this._player.isBattleStartFrame()&&(d=this._player.isTurn()?this._monster.position.x:
f.x,f=this._player.isTurn()?this._monster.position.y:f.y,this._cgManager.drawCanvas(this._battleEffectCoord.x,this._battleEffectCoord.y,b.CHIP_SIZE*(d-a.x)-c.x,b.CHIP_SIZE*(f-a.y)-c.y,!1));this._drawEffect();this._drawFaces();this._drawFrame()}};d.prototype._drawMap=function(a,c,d,f){void 0===f&&(f=!1);if(void 0!==a)for(var e=Math.max(0,a.x-1),n=Math.min(this._wwaData.mapWidth-1,a.x+b.H_PARTS_NUM_IN_WINDOW),q=Math.max(0,a.y-1),g=Math.min(this._wwaData.mapWidth-1,a.y+b.V_PARTS_NUM_IN_WINDOW);e<=n;e++)for(var k=
q;k<=g;k++){var h=this._wwaData.map[k][e],l=this._wwaData.mapAttribute[h][b.ATR_X]/b.CHIP_SIZE,h=this._wwaData.mapAttribute[h][b.ATR_Y]/b.CHIP_SIZE,p=b.CHIP_SIZE*(e-a.x)-c.x,t=b.CHIP_SIZE*(k-a.y)-c.y;f?this._cgManager.drawCanvasWithLowerYLimit(l,h,p,t,d):this._cgManager.drawCanvasWithUpperYLimit(l,h,p,t,d)}};d.prototype._drawPlayer=function(a,c,d,f){void 0===f&&(f=!1);if(void 0!==a&&!this._wwaData.delPlayerFlag){var e=this._player.getPosition().getPartsCoord(),n=this._player.getPosition().getOffsetCoord(),
q=wwa_data.dirToPos[this._player.getDir()],g=(e.x-a.x)*b.CHIP_SIZE+n.x-c.x;a=(e.y-a.y)*b.CHIP_SIZE+n.y-c.y;Math.abs(n.x);Math.abs(n.y);c=this._player.getDir();e=[2,3,4,5,0,1,6,7];n=this._player.isLookingAround()&&!this._player.isWaitingMessage()?this._wwaData.playerImgPosX+e[Math.floor(this._mainCallCounter%64/8)]:(0===c||1===c)&&Math.abs(n.x)>Math.floor(b.CHIP_SIZE/2)||(3===c||2===c)&&Math.abs(n.y)>Math.floor(b.CHIP_SIZE/2)?this._wwaData.playerImgPosX+q+1:this._wwaData.playerImgPosX+q;f?this._cgManager.drawCanvasWithLowerYLimit(n,
this._wwaData.playerImgPosY,g,a,d):this._cgManager.drawCanvasWithUpperYLimit(n,this._wwaData.playerImgPosY,g,a,d)}};d.prototype._drawObjects=function(a,c,d,f){void 0===f&&(f=!1);if(void 0!==a)for(var e=Math.max(0,a.x-1),n=Math.min(this._wwaData.mapWidth-1,a.x+b.H_PARTS_NUM_IN_WINDOW),q=Math.max(0,a.y-1),g=Math.min(this._wwaData.mapWidth-1,a.y+b.V_PARTS_NUM_IN_WINDOW),h;e<=n;e++)for(var l=q;l<=g;l++)if(!(this._player.isFighting()&&this._player.isTurn()&&this._player.getPosition().getPartsCoord().equals(this._monster.position)&&
(new wwa_data.Coord(e,l)).equals(this._monster.position))){var p=this._wwaData.mapObject[l][e];h=new k(0,0);if(0!==this._wwaData.objectAttribute[p][b.ATR_MOVE]){var v=this._objectMovingDataManager.getOffsetByBeforePartsCoord(new k(e,l));null!==v&&(h=v)}var t=this._animationCounter>b.ANIMATION_REP_HALF_FRAME||0===this._wwaData.objectAttribute[p][b.ATR_X2]&&0===this._wwaData.objectAttribute[p][b.ATR_Y2],v=this._wwaData.objectAttribute[p][t?b.ATR_X:b.ATR_X2]/b.CHIP_SIZE,t=this._wwaData.objectAttribute[p][t?
b.ATR_Y:b.ATR_Y2]/b.CHIP_SIZE,u=b.CHIP_SIZE*(e-a.x)+h.x-c.x;h=b.CHIP_SIZE*(l-a.y)+h.y-c.y;var w=this._wwaData.objectAttribute[p][b.ATR_TYPE],A=this._wwaData.objectAttribute[p][b.ATR_NUMBER];0===p||this._checkNoDrawObject(new k(e,l),w,A)||(f?this._cgManager.drawCanvasWithLowerYLimit(v,t,u,h,d):this._cgManager.drawCanvasWithUpperYLimit(v,t,u,h,d))}};d.prototype._drawEffect=function(){if(0!==this._wwaData.effectCoords.length)for(var a=Math.floor(this._mainCallCounter%(this._wwaData.effectCoords.length*
this._wwaData.effectWaits)/this._wwaData.effectWaits),c=0;c<b.V_PARTS_NUM_IN_WINDOW;c++)for(var d=0;d<b.H_PARTS_NUM_IN_WINDOW;d++)this._cgManager.drawCanvas(this._wwaData.effectCoords[a].x,this._wwaData.effectCoords[a].y,d*b.CHIP_SIZE,c*b.CHIP_SIZE,!1)};d.prototype._drawFaces=function(){for(var b=0;b<this._faces.length;b++)this._cgManager.drawCanvasWithSize(this._faces[b].srcPos.x,this._faces[b].srcPos.y,this._faces[b].srcSize.x,this._faces[b].srcSize.y,this._faces[b].destPos.x,this._faces[b].destPos.y,
!1)};d.prototype._drawFrame=function(){this._cgManager.drawCanvas(this._frameCoord.x,this._frameCoord.y,0,0,!1);this._cgManager.drawCanvas(this._frameCoord.x+2,this._frameCoord.y,b.MAP_WINDOW_WIDTH-b.CHIP_SIZE,0,!1);this._cgManager.drawCanvas(this._frameCoord.x,this._frameCoord.y+2,0,b.MAP_WINDOW_HEIGHT-b.CHIP_SIZE,!1);this._cgManager.drawCanvas(this._frameCoord.x+2,this._frameCoord.y+2,b.MAP_WINDOW_WIDTH-b.CHIP_SIZE,b.MAP_WINDOW_HEIGHT-b.CHIP_SIZE,!1);for(var a=1;a<b.H_PARTS_NUM_IN_WINDOW-1;a++)this._cgManager.drawCanvas(this._frameCoord.x+
1,this._frameCoord.y,b.CHIP_SIZE*a,0,!1),this._cgManager.drawCanvas(this._frameCoord.x+1,this._frameCoord.y+2,b.CHIP_SIZE*a,b.MAP_WINDOW_HEIGHT-b.CHIP_SIZE,!1);for(a=1;a<b.V_PARTS_NUM_IN_WINDOW-1;a++)this._cgManager.drawCanvas(this._frameCoord.x,this._frameCoord.y+1,0,b.CHIP_SIZE*a,!1),this._cgManager.drawCanvas(this._frameCoord.x+2,this._frameCoord.y+1,b.MAP_WINDOW_WIDTH-b.CHIP_SIZE,b.CHIP_SIZE*a,!1)};d.prototype._checkNoDrawObject=function(a,c,d){var f=this._player.getPosition(),e=f.getPartsCoord();
return!f.isJustPosition()||e.x!==a.x||e.y!==a.y||this._wwaData.objectNoCollapseDefaultFlag?!1:c===b.OBJECT_DOOR&&0===d?!0:c===b.OBJECT_STATUS||c===b.OBJECT_MESSAGE||c===b.OBJECT_ITEM||c===b.OBJECT_SELL||c===b.OBJECT_BUY||c===b.OBJECT_SELL||c===b.OBJECT_LOCALGATE};d.prototype.getMapWidth=function(){if(void 0===this._wwaData)throw Error("\u30de\u30c3\u30d7\u30c7\u30fc\u30bf\u304c\u30ed\u30fc\u30c9\u3055\u308c\u3066\u3044\u307e\u305b\u3093");return this._wwaData.mapWidth};d.prototype.getMapIdByPosition=
function(b){b=b.getPartsCoord();return this._wwaData.map[b.y][b.x]};d.prototype.getObjectIdByPosition=function(b){b=b.getPartsCoord();return this._wwaData.mapObject[b.y][b.x]};d.prototype.getMapTypeByPosition=function(a){a=a.getPartsCoord();return this._wwaData.mapAttribute[this._wwaData.map[a.y][a.x]][b.ATR_TYPE]};d.prototype.getObjectTypeByPosition=function(a){a=a.getPartsCoord();return this._wwaData.objectAttribute[this._wwaData.mapObject[a.y][a.x]][b.ATR_TYPE]};d.prototype.getMapAttributeByPosition=
function(b,a){var c=b.getPartsCoord();return this._wwaData.mapAttribute[this._wwaData.map[c.y][c.x]][a]};d.prototype.isCurrentPosMapPartsIncludingMessage=function(a){return 0!==this.getMapAttributeByPosition(a,b.ATR_STRING)};d.prototype.getObjectAttributeByPosition=function(b,a){var c=b.getPartsCoord();return this._wwaData.objectAttribute[this._wwaData.mapObject[c.y][c.x]][a]};d.prototype.getMapAttributeById=function(b,a){return this._wwaData.mapAttribute[b][a]};d.prototype.getObjectAttributeById=
function(b,a){return this._wwaData.objectAttribute[b][a]};d.prototype.getObjectCropXById=function(a){return this._wwaData.objectAttribute[a][b.ATR_X]};d.prototype.getObjectCropYById=function(a){return this._wwaData.objectAttribute[a][b.ATR_Y]};d.prototype.getMessageById=function(b){return this._wwaData.message[b]};d.prototype.getSystemMessageById=function(b){return this._wwaData.systemMessage[b]};d.prototype.checkMap=function(a){var c=this._player.getPosition().getPartsCoord();a=void 0!==a&&null!==
a?a:c;var d=this._wwaData.map[a.y][a.x],f=this._wwaData.mapAttribute[d][b.ATR_TYPE],c=a.x===c.x&&a.y===c.y,e=!1;if(c&&this._player.getLastExecPartsIDOnSamePosition(1)===d)return!1;f===b.MAP_STREET?e=this._execMapStreetEvent(a,d,f):f===b.MAP_WALL?e=this._execMapWallEvent(a,d,f):f===b.MAP_LOCALGATE?e=this._execMapLocalGateEvent(a,d,f):f===b.MAP_URLGATE&&(e=this._execMapUrlGateEvent(a,d,f));c&&!this._player.isJumped()&&this._player.setLastExecInfoOnSamePosition(1,d);return e};d.prototype.checkObject=
function(a){var c=this._player.getPosition().getPartsCoord();a=void 0!==a&&null!==a?a:c;var d=this._wwaData.mapObject[a.y][a.x],f=this._wwaData.objectAttribute[d][b.ATR_TYPE],c=a.x===c.x&&a.y===c.y;c&&this._player.getLastExecPartsIDOnSamePosition(0)===d||(f===b.OBJECT_NORMAL?this._execObjectNormalEvent(a,d,f):f===b.OBJECT_MESSAGE?this._execObjectMessageEvent(a,d,f):f===b.OBJECT_MONSTER?this._execObjectMonsterEvent(a,d,f):f===b.OBJECT_ITEM?this._execObjectItemEvent(a,d,f):f===b.OBJECT_DOOR?this._execObjectDoorEvent(a,
d,f):f===b.OBJECT_STATUS?this._execObjectStatusEvent(a,d,f):f===b.OBJECT_BUY?this._execObjectBuyEvent(a,d,f):f===b.OBJECT_SELL?this._execObjectSellEvent(a,d,f):f===b.OBJECT_URLGATE?this._execObjectUrlGateEvent(a,d,f):f===b.OBJECT_SCORE?this._execObjectScoreEvent(a,d,f):f===b.OBJECT_SELECT?this._execObjectYesNoChoiceEvent(a,d,f):f===b.OBJECT_LOCALGATE&&this._execObjectLocalGateEvent(a,d,f),c&&!this._player.isJumped()&&this._player.setLastExecInfoOnSamePosition(0,d))};d.prototype._execMapStreetEvent=
function(a,c,d){d=this._wwaData.mapAttribute[c][b.ATR_ITEM];if(0!==d&&!this._player.hasItem(d))return!1;this.appearParts(a,0);d=this._wwaData.mapAttribute[c][b.ATR_STRING];var f=this._wwaData.message[d];this._waitTimeInCurrentFrame+=100*this._wwaData.mapAttribute[c][b.ATR_NUMBER];this._temporaryInputDisable=!0;a=this.setMessageQueue(f,!1,!1,c,1,a.clone());this.playSound(this._wwaData.mapAttribute[c][b.ATR_SOUND]);return 0!==d&&a};d.prototype._execMapWallEvent=function(a,c,d){d=this.getObjectIdByPosition(a.convertIntoPosition(this));
var f=this.getObjectAttributeById(d,b.ATR_TYPE);0!==d&&f!==b.OBJECT_NORMAL&&(f!==b.OBJECT_DOOR||this._player.hasItem(this.getObjectAttributeById(d,b.ATR_ITEM))&&this.getObjectAttributeById(f,b.ATR_MODE)!==b.PASSABLE_OBJECT)||(this.appearParts(a,0),this.setMessageQueue(this._wwaData.message[this._wwaData.mapAttribute[c][b.ATR_STRING]],!1,!1,c,1,a.clone()),this.playSound(this._wwaData.mapAttribute[c][b.ATR_SOUND]));return!1};d.prototype._execMapLocalGateEvent=function(a,c,d){d=this._player.getPosition().getPartsCoord();
var f=this._wwaData.mapAttribute[c][b.ATR_JUMP_X],e=this._wwaData.mapAttribute[c][b.ATR_JUMP_Y];f>b.RELATIVE_COORD_LOWER&&(f=a.x+f-b.RELATIVE_COORD_BIAS);e>b.RELATIVE_COORD_LOWER&&(e=a.y+e-b.RELATIVE_COORD_BIAS);this.appearParts(a,0);return 0<=f&&0<=e&&f<this._wwaData.mapWidth&&e<this._wwaData.mapWidth&&(f!==d.x||e!==d.y)?(this._player.jumpTo(new u(this,f,e,0,0)),this.playSound(this._wwaData.mapAttribute[c][b.ATR_SOUND]),!0):!1};d.prototype._execMapUrlGateEvent=function(a,c,d){d=this._wwaData.mapAttribute[c][b.ATR_STRING];
if(!this._isURLGateEnable)return!0;if("BLANK"===this._wwaData.message[5])location.href=wwa_util.$escapedURI(this._wwaData.message[d].split(/\s/g)[0]);else return this.setMessageQueue(""===this._wwaData.message[5]?"\u4ed6\u306e\u30da\u30fc\u30b8\u306b\u30ea\u30f3\u30af\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f":this._wwaData.message[5],!0,!0),this._yesNoChoicePartsCoord=a,this._yesNoChoicePartsID=c,this._yesNoChoiceCallInfo=1,this._yesNoURL=this._wwaData.message[d].split(/\s/g)[0],
!0};d.prototype._execObjectNormalEvent=function(b,a,c){};d.prototype._execObjectMessageEvent=function(a,c,d){d=this._wwaData.message[this._wwaData.objectAttribute[c][b.ATR_STRING]];var f=this._player.getPosition().getPartsCoord(),e=this._wwaData.objectAttribute[c][b.ATR_SOUND];a.x!==f.x||a.y!==f.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=0);this.setMessageQueue(d,!1,!1,c,0,a);this._waitTimeInCurrentFrame+=100*this._wwaData.objectAttribute[c][b.ATR_NUMBER];this._temporaryInputDisable=
!0;this.appearParts(a,1,c);this.playSound(e)};d.prototype._execObjectStatusEvent=function(a,c,d){d=new wwa_data.Status(this._wwaData.objectAttribute[c][b.ATR_ENERGY],this._wwaData.objectAttribute[c][b.ATR_STRENGTH],this._wwaData.objectAttribute[c][b.ATR_DEFENCE],this._wwaData.objectAttribute[c][b.ATR_GOLD]);var f=this._wwaData.message[this._wwaData.objectAttribute[c][b.ATR_STRING]],e=this._player.getStatusWithoutEquipments();d.strength>b.STATUS_MINUS_BORDER&&e.strength<d.strength-b.STATUS_MINUS_BORDER||
d.defence>b.STATUS_MINUS_BORDER&&e.defence<d.defence-b.STATUS_MINUS_BORDER||d.gold>b.STATUS_MINUS_BORDER&&e.gold<d.gold-b.STATUS_MINUS_BORDER?this._wwaData.mapObject[a.y][a.x]=0:(d.energy=d.energy>b.STATUS_MINUS_BORDER?b.STATUS_MINUS_BORDER-d.energy:d.energy,d.strength=d.strength>b.STATUS_MINUS_BORDER?b.STATUS_MINUS_BORDER-d.strength:d.strength,d.defence=d.defence>b.STATUS_MINUS_BORDER?b.STATUS_MINUS_BORDER-d.defence:d.defence,d.gold=d.gold>b.STATUS_MINUS_BORDER?b.STATUS_MINUS_BORDER-d.gold:d.gold,
this._player.addStatusAll(d),this.setStatusChangedEffect(d),this._player.isDead()&&0!==this._wwaData.objectAttribute[c][b.ATR_ENERGY]?this.gameover():(this.setMessageQueue(f,!1,!1,c,0,a.clone()),this._wwaData.mapObject[a.y][a.x]=0,this.appearParts(a,1,c),this.playSound(this._wwaData.objectAttribute[c][b.ATR_SOUND])))};d.prototype._execObjectMonsterEvent=function(a,c,d){var f=this;d=new wwa_data.Coord(this._wwaData.objectAttribute[c][b.ATR_X],this._wwaData.objectAttribute[c][b.ATR_Y]);var e=new wwa_data.Status(this._wwaData.objectAttribute[c][b.ATR_ENERGY],
this._wwaData.objectAttribute[c][b.ATR_STRENGTH],this._wwaData.objectAttribute[c][b.ATR_DEFENCE],this._wwaData.objectAttribute[c][b.ATR_GOLD]);this._monster=new wwa_monster.Monster(c,a,d,e,this._wwaData.message[this._wwaData.objectAttribute[c][b.ATR_STRING]],this._wwaData.objectAttribute[c][b.ATR_ITEM],function(){f._monsterWindow.hide()});this._player.startBattleWith(this._monster)};d.prototype._execObjectBuyEvent=function(a,c,d){d=this._wwaData.message[this._wwaData.objectAttribute[c][b.ATR_STRING]];
var f=this._player.getPosition().getPartsCoord();a.x!==f.x||a.y!==f.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=0);this.setMessageQueue(d,!0,!1,c,0,a.clone());this._yesNoChoicePartsCoord=a;this._yesNoChoicePartsID=c;this._yesNoChoiceCallInfo=2;this.playSound(this._wwaData.objectAttribute[c][b.ATR_SOUND])};d.prototype._execObjectSellEvent=function(a,c,d){d=this._wwaData.message[this._wwaData.objectAttribute[c][b.ATR_STRING]];var f=this._player.getPosition().getPartsCoord();
a.x!==f.x||a.y!==f.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=0);this.setMessageQueue(d,!0,!1,c,0,a.clone());this._yesNoChoicePartsCoord=a;this._yesNoChoicePartsID=c;this._yesNoChoiceCallInfo=2;this.playSound(this._wwaData.objectAttribute[c][b.ATR_SOUND])};d.prototype._execObjectItemEvent=function(a,c,d){d=this._wwaData.message[this._wwaData.objectAttribute[c][b.ATR_STRING]];try{this._player.addItem(c,this._wwaData.objectAttribute[c][b.ATR_NUMBER]),this._wwaData.mapObject[a.y][a.x]=
0,0===this._wwaData.objectAttribute[c][b.ATR_MODE]&&(this.setMessageQueue(d,!1,!1,c,0,a.clone()),this.appearParts(a,1,c))}catch(f){"BLANK"!==this._wwaData.systemMessage[1]&&this.setMessageQueue(""===this._wwaData.systemMessage[1]?"\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002":this._wwaData.systemMessage[1],!1,!0)}this.playSound(this._wwaData.objectAttribute[c][b.ATR_SOUND])};d.prototype._execObjectDoorEvent=function(a,c,d){d=this._wwaData.objectAttribute[c][b.ATR_ITEM];
var f=this._wwaData.message[this._wwaData.objectAttribute[c][b.ATR_STRING]];this._player.hasItem(d)&&(0===this._wwaData.objectAttribute[c][b.ATR_MODE]&&this._player.removeItemByPartsID(d),this.playSound(this._wwaData.objectAttribute[c][b.ATR_SOUND]),this.setMessageQueue(f,!1,!1,c,0,a.clone()),this._wwaData.mapObject[a.y][a.x]=0,this.appearParts(a,1,c),this._paintSkipByDoorOpen=!0)};d.prototype._execObjectYesNoChoiceEvent=function(a,c,d){d=this._wwaData.message[this._wwaData.objectAttribute[c][b.ATR_STRING]];
var f=this._player.getPosition().getPartsCoord();a.x!==f.x||a.y!==f.y||this._wwaData.objectNoCollapseDefaultFlag||(this._wwaData.mapObject[a.y][a.x]=0);this.setMessageQueue(d,!0,!1,c,0,a.clone());this._yesNoChoicePartsCoord=a;this._yesNoChoicePartsID=c;this._yesNoChoiceCallInfo=2;this.playSound(this._wwaData.objectAttribute[c][b.ATR_SOUND])};d.prototype._execObjectLocalGateEvent=function(a,c,d){d=this._player.getPosition().getPartsCoord();a.x!==d.x||a.y!==d.y||this._wwaData.objectNoCollapseDefaultFlag||
(this._wwaData.mapObject[a.y][a.x]=0);var f=this._wwaData.objectAttribute[c][b.ATR_JUMP_X],e=this._wwaData.objectAttribute[c][b.ATR_JUMP_Y];f>b.RELATIVE_COORD_LOWER&&(f=d.x+f-b.RELATIVE_COORD_BIAS);e>b.RELATIVE_COORD_LOWER&&(e=d.y+e-b.RELATIVE_COORD_BIAS);this.appearParts(a,1,c);0<=f&&0<=e&&f<this._wwaData.mapWidth&&e<this._wwaData.mapWidth&&(f!==d.x||e!==d.y)&&(this._player.jumpTo(new u(this,f,e,0,0)),this.playSound(this._wwaData.objectAttribute[c][b.ATR_SOUND]))};d.prototype._execObjectUrlGateEvent=
function(a,c,d){d=this._wwaData.objectAttribute[c][b.ATR_STRING];this._isURLGateEnable&&("BLANK"===this._wwaData.message[5]?location.href=wwa_util.$escapedURI(this._wwaData.message[d].split(/\s/g)[0]):(this.setMessageQueue(""===this._wwaData.message[5]?"\u4ed6\u306e\u30da\u30fc\u30b8\u306b\u30ea\u30f3\u30af\u3057\u307e\u3059\u3002\n\u3088\u308d\u3057\u3044\u3067\u3059\u304b\uff1f":this._wwaData.message[5],!0,!0),this._yesNoChoicePartsCoord=a,this._yesNoChoicePartsID=c,this._yesNoChoiceCallInfo=2,
this._yesNoURL=this._wwaData.message[d].split(/\s/g)[0]))};d.prototype._execObjectScoreEvent=function(a,c,d){a=this._wwaData.objectAttribute[c][b.ATR_STRING];this._player.getPosition().getPartsCoord();d=this._player.getStatus();var f;f=0+this._wwaData.objectAttribute[c][b.ATR_ENERGY]*d.energy;f+=this._wwaData.objectAttribute[c][b.ATR_STRENGTH]*d.strength;f+=this._wwaData.objectAttribute[c][b.ATR_DEFENCE]*d.defence;f+=this._wwaData.objectAttribute[c][b.ATR_GOLD]*d.gold;this._scoreWindow.update(f);
this._scoreWindow.show();this.setMessageQueue(0===a?"\u30b9\u30b3\u30a2\u3092\u8868\u793a\u3057\u307e\u3059\u3002":this._wwaData.message[a],!1,!1);this.playSound(this._wwaData.objectAttribute[c][b.ATR_SOUND])};d.prototype._execChoiceWindowRunningEvent=function(){var a;if(0===--this._yesNoDispCounter)if(0===this._yesNoJudge){if(1===this._yesNoChoiceCallInfo)a=this._wwaData.mapAttribute[this._yesNoChoicePartsID][b.ATR_TYPE],a===b.MAP_URLGATE&&(location.href=wwa_util.$escapedURI(this._yesNoURL));else if(2===
this._yesNoChoiceCallInfo)if(a=this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_TYPE],a===b.OBJECT_BUY)this._player.hasItem(this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_ITEM])?(this._player.removeItemByPartsID(this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_ITEM]),a=this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_GOLD],this._player.earnGold(a),this.setStatusChangedEffect(new wwa_data.Status(0,0,0,a)),this.appearParts(this._yesNoChoicePartsCoord,
1,this._yesNoChoicePartsID)):"BLANK"!==this._wwaData.message[7]&&this._messageQueue.push(new wwa_message.MessageInfo(""===this._wwaData.message[7]?"\u30a2\u30a4\u30c6\u30e0\u3092\u3082\u3063\u3066\u3044\u306a\u3044\u3002":this._wwaData.message[7],!0));else if(a===b.OBJECT_SELL)if(this._player.hasGold(this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_GOLD]))if(this._player.canHaveMoreItems()){this._player.addItem(this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_ITEM]);a=new wwa_data.Status(this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_ENERGY],
this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_STRENGTH],this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_DEFENCE],-this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_GOLD]);this._player.getStatusWithoutEquipments();a.energy=a.energy>b.STATUS_MINUS_BORDER?b.STATUS_MINUS_BORDER-a.energy:a.energy;this.setStatusChangedEffect(a);this._player.addStatusAll(a);if(this._player.isDead()&&0!==this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_ENERGY]){this.gameover();
return}this.appearParts(this._yesNoChoicePartsCoord,1,this._yesNoChoicePartsID)}else this._messageQueue.push(new wwa_message.MessageInfo("\u3053\u308c\u4ee5\u4e0a\u3001\u30a2\u30a4\u30c6\u30e0\u3092\u6301\u3066\u307e\u305b\u3093\u3002",!0));else"BLANK"!==this._wwaData.message[6]&&this._messageQueue.push(new wwa_message.MessageInfo(""===this._wwaData.message[6]?"\u6240\u6301\u91d1\u304c\u8db3\u308a\u306a\u3044\u3002":this._wwaData.message[6],!0));else a===b.OBJECT_SELECT?this.appearParts(this._yesNoChoicePartsCoord,
2,this._yesNoChoicePartsID):a===b.OBJECT_URLGATE&&(location.href=wwa_util.$escapedURI(this._yesNoURL));else 3===this._yesNoChoiceCallInfo?this._player.readyToUseItem(this._yesNoUseItemPos):5===this._yesNoChoiceCallInfo?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[0]).classList.remove("onpress"),this._stopUpdateByLoadFlag=!0,this._loadType=0):4===this._yesNoChoiceCallInfo?(wwa_util.$id(wwa_data.sidebarButtonCellElementID[1]).classList.remove("onpress"),this._quickSave()):6===this._yesNoChoiceCallInfo?
(wwa_util.$id(wwa_data.sidebarButtonCellElementID[2]).classList.remove("onpress"),this._stopUpdateByLoadFlag=!0,this._loadType=1):7===this._yesNoChoiceCallInfo&&(location.href=wwa_util.$escapedURI(b.WWA_HOME),wwa_util.$id(wwa_data.sidebarButtonCellElementID[3]).classList.remove("onpress"));this._yesNoJudge=2;this._setNextMessage();this._yesNoUseItemPos=this._yesNoChoicePartsID=this._yesNoChoicePartsCoord=void 0;this._yesNoChoiceCallInfo=0;this._messageWindow.setYesNoChoice(!1)}else 1===this._yesNoJudge&&
(1!==this._yesNoChoiceCallInfo&&(2===this._yesNoChoiceCallInfo?(a=this._wwaData.objectAttribute[this._yesNoChoicePartsID][b.ATR_TYPE],a!==b.OBJECT_BUY&&a!==b.OBJECT_SELL&&a===b.OBJECT_SELECT&&this.appearParts(this._yesNoChoicePartsCoord,3,this._yesNoChoicePartsID)):3===this._yesNoChoiceCallInfo?wwa_util.$id("item"+(this._yesNoUseItemPos-1)).classList.remove("onpress"):5===this._yesNoChoiceCallInfo?wwa_util.$id(wwa_data.sidebarButtonCellElementID[0]).classList.remove("onpress"):4===this._yesNoChoiceCallInfo?
wwa_util.$id(wwa_data.sidebarButtonCellElementID[1]).classList.remove("onpress"):6===this._yesNoChoiceCallInfo?wwa_util.$id(wwa_data.sidebarButtonCellElementID[2]).classList.remove("onpress"):7===this._yesNoChoiceCallInfo&&wwa_util.$id(wwa_data.sidebarButtonCellElementID[3]).classList.remove("onpress")),this._yesNoJudge=2,this._setNextMessage(),this._yesNoUseItemPos=this._yesNoChoicePartsID=this._yesNoChoicePartsCoord=void 0,this._yesNoChoiceCallInfo=0,this._messageWindow.setYesNoChoice(!1))};d.prototype.setMessageQueue=
function(a,b,c,d,e,n,q){void 0===d&&(d=0);void 0===e&&(e=0);void 0===n&&(n=new k(0,0));void 0===q&&(q=!1);this._messageQueue=this._messageQueue.concat(this.getMessageQueueByRawMessage(a,d,e,n));this._lastMessage.isEndOfPartsEvent&&void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=void 0);if(0!==this._messageQueue.length){a=this._messageQueue.shift();for(d=0;d<a.macro.length;d++)this._execMacroListInNextFrame.push(a.macro[d]);
this._lastMessage=a;if(""!==a.message)return this._messageWindow.setMessage(a.message),this._messageWindow.setYesNoChoice(b),this._messageWindow.setPositionByPlayerPosition(0!==this._faces.length,this._scoreWindow.isVisible(),c,this._player.getPosition(),this._camera.getPosition()),this._player.setMessageWaiting(),!0;0===this._messageQueue.length?this._hideMessageWindow(q):this._setNextMessage()}return!1};d.prototype.getMessageQueueByRawMessage=function(a,b,c,d,e){void 0===e&&(e=!1);var n=a.split(/\<c\>/i)[0].replace(/\<p\>\n/ig,
"<P>");a=[];if(""!==n)for(var n=n.split(/\<p\>/ig),q=0;q<n.length;q++){for(var g=n[q].split("\n"),k=[],h=[],l=0;l<g.length;l++){var p=g[l].match(/(\$(?:[a-zA-Z_][a-zA-Z0-9_]*)\=(?:.*))/);null!==p&&2<=p.length?(p=wwa_message.parseMacro(this,b,c,d,p[1]),h.push(p)):g[l].match(/^\$/)||k.push(g[l])}a.push(new wwa_message.MessageInfo(k.join("\n"),e,q===n.length-1,h))}return a};d.prototype.appearParts=function(a,c,d){void 0===d&&(d=0);var f=3===c?b.APPERANCE_PARTS_MIN_INDEX_NO:b.APPERANCE_PARTS_MIN_INDEX,
e=2===c?b.APPERANCE_PARTS_MAX_INDEX_YES:b.APPERANCE_PARTS_MAX_INDEX,n,q,g,h;0===c?(d=0===d?this._wwaData.map[a.y][a.x]:d,c=1):(d=0===d?this._wwaData.mapObject[a.y][a.x]:d,c=0);for(;f<=e;f++)if(q=b.ATR_APPERANCE_BASE+f*b.REL_ATR_APPERANCE_UNIT_LENGTH,n=q+b.REL_ATR_APPERANCE_ID,g=q+b.REL_ATR_APPERANCE_X,h=q+b.REL_ATR_APPERANCE_Y,q+=b.REL_ATR_APPERANCE_TYPE,n=1===c?this._wwaData.mapAttribute[d][n]:this._wwaData.objectAttribute[d][n],q=1===c?this._wwaData.mapAttribute[d][q]:this._wwaData.objectAttribute[d][q],
g=1===c?this._wwaData.mapAttribute[d][g]:this._wwaData.objectAttribute[d][g],h=1===c?this._wwaData.mapAttribute[d][h]:this._wwaData.objectAttribute[d][h],g===b.PLAYER_COORD?(g=this._player.getPosition().getPartsCoord().x,this._player.resetEventExecutionInfo()):g>b.RELATIVE_COORD_LOWER&&(g=a.x+g-b.RELATIVE_COORD_BIAS),h===b.PLAYER_COORD?(h=this._player.getPosition().getPartsCoord().y,this._player.resetEventExecutionInfo()):h>b.RELATIVE_COORD_LOWER&&(h=a.y+h-b.RELATIVE_COORD_BIAS),0!==g||0!==h)try{if(new wwa_data.Position(this,
g,h,0,0),1===q){if(n>=this._wwaData.mapPartsMax)throw Error("\u80cc\u666f\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.map[h][g]=n}else{if(n>=this._wwaData.objPartsMax)throw Error("\u7269\u4f53\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.mapObject[h][g]=n;this._replaceRandomObject(new k(g,h));g===this._player.getPosition().getPartsCoord().x&&h===this._player.getPosition().getPartsCoord().y&&
this._player.setPartsAppearedFlag()}}catch(l){}};d.prototype.appearPartsByDirection=function(a,b,c){var d=this._player.getPosition().getPartsCoord(),e=this._player.getDir(),n=wwa_data.vx[e],e=wwa_data.vy[e];this.appearPartsEval(d,(0<=n?"+":"-")+Math.abs(n)*a,(0<=e?"+":"-")+Math.abs(e)*a,b,c)};d.prototype.appearPartsEval=function(a,b,c,d,e){var n=this._player.getPosition().getPartsCoord();if("P"===b||"p"===b)b=n.x;else if("+"===b[0])b=a.x+parseInt(b.substr(1));else if("-"===b[0])b=a.x-parseInt(b.substr(1));
else if(b=parseInt(b),isNaN(b))throw Error("\u5ea7\u6a19\u3068\u3057\u3066\u89e3\u91c8\u3067\u304d\u306a\u3044\u6587\u5b57\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002");if("P"===c||"p"===c)a=n.y;else if("+"===c[0])a=a.y+parseInt(c.substr(1));else if("-"===c[0])a=a.y-parseInt(c.substr(1));else if(a=parseInt(c),isNaN(a))throw Error("\u5ea7\u6a19\u3068\u3057\u3066\u89e3\u91c8\u3067\u304d\u306a\u3044\u6587\u5b57\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002");try{if(new wwa_data.Position(this,
b,a,0,0),1===e){if(d>=this._wwaData.mapPartsMax)throw Error("\u80cc\u666f\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.map[a][b]=d}else{if(d>=this._wwaData.objPartsMax)throw Error("\u7269\u4f53\u30d1\u30fc\u30c4\u306e\u7bc4\u56f2\u5916ID\u304c\u6307\u5b9a\u3055\u308c\u307e\u3057\u305f");this._wwaData.mapObject[a][b]=d;this._replaceRandomObject(new k(b,a));b===this._player.getPosition().getPartsCoord().x&&a===this._player.getPosition().getPartsCoord().y&&
this._player.setPartsAppearedFlag()}}catch(g){}};d.prototype._replaceRandomObject=function(a){var c=this._wwaData.mapObject[a.y][a.x],d;if(this._wwaData.objectAttribute[c][b.ATR_TYPE]===b.OBJECT_RANDOM){for(var f=0;f<b.RANDOM_ITERATION_MAX;f++){d=Math.floor(10*Math.random());d=this._wwaData.objectAttribute[c][b.ATR_RANDOM_BASE+d];if(d>=this._wwaData.objPartsMax){d=0;break}if(this._wwaData.objectAttribute[d][b.ATR_TYPE]!==b.OBJECT_RANDOM)break;c=d}this._wwaData.mapObject[a.y][a.x]=d}};d.prototype._replaceRandomObjectsInScreen=
function(){for(var a=this._camera.getPosition().getPartsCoord(),c=Math.max(0,a.x-1),d=Math.min(this._wwaData.mapWidth-1,a.x+b.H_PARTS_NUM_IN_WINDOW),f=Math.max(0,a.y-1),a=Math.min(this._wwaData.mapWidth-1,a.y+b.V_PARTS_NUM_IN_WINDOW);c<=d;c++)for(var e=f;e<a;e++)this._replaceRandomObject(new k(c,e))};d.prototype._replaceAllRandomObjects=function(){for(var a=0;a<this._wwaData.mapWidth;a++)for(var b=0;b<this._wwaData.mapWidth;b++)this._replaceRandomObject(new k(a,b))};d.prototype.gameover=function(){var a=
this._wwaData.gameoverX,c=this._wwaData.gameoverY;this._messageWindow.isVisible()&&(this._yesNoJudge=2,this._messageQueue=[],this._messageWindow.hide(),this._yesNoUseItemPos=this._yesNoChoicePartsID=this._yesNoChoicePartsCoord=void 0,this._yesNoChoiceCallInfo=0,this._messageWindow.setYesNoChoice(!1));this._waitTimeInCurrentFrame=b.GAMEOVER_FRAME_INTERVAL;this._temporaryInputDisable=!0;this._player.jumpTo(new u(this,a,c,0,0))};d.prototype.setYesNoInput=function(a){this._yesNoJudgeInNextFrame=a};d.prototype.getYesNoState=
function(){return void 0!==this._yesNoJudgeInNextFrame?this._yesNoJudgeInNextFrame:this._yesNoJudge};d.prototype.setStatusChangedEffect=function(a){0!==a.strength&&(wwa_util.$id("disp-strength").classList.add("onpress"),this._statusPressCounter.strength=b.STATUS_CHANGED_EFFECT_FRAME_NUM);0!==a.defence&&(wwa_util.$id("disp-defence").classList.add("onpress"),this._statusPressCounter.defence=b.STATUS_CHANGED_EFFECT_FRAME_NUM);a instanceof wwa_data.Status&&(0!==a.energy&&(wwa_util.$id("disp-energy").classList.add("onpress"),
this._statusPressCounter.energy=b.STATUS_CHANGED_EFFECT_FRAME_NUM),0!==a.gold&&(wwa_util.$id("disp-gold").classList.add("onpress"),this._statusPressCounter.gold=b.STATUS_CHANGED_EFFECT_FRAME_NUM))};d.prototype.setPartsOnPosition=function(a,b,c){1===a?(b>=this._wwaData.mapPartsMax&&(this._wwaData.map[c.y][c.x]=0),this._wwaData.map[c.y][c.x]=b):(b>=this._wwaData.objPartsMax&&(this._wwaData.mapObject[c.y][c.x]=0),this._wwaData.mapObject[c.y][c.x]=b)};d.prototype._quickSave=function(){var a=JSON.parse(JSON.stringify(this._wwaData)),
b=this._player.getPosition().getPartsCoord(),c=this._player.getStatusWithoutEquipments();a.itemBox=this._player.getCopyOfItemBox();a.playerX=b.x;a.playerY=b.y;a.statusEnergyMax=this._player.getEnergyMax();a.statusEnergy=c.energy;a.statusStrength=c.strength;a.statusDefence=c.defence;a.statusGold=c.gold;a.moves=this._player.getMoveCount();this._quickSaveData=a};d.prototype._quickLoad=function(a){void 0===a&&(a=!1);if(!a&&void 0===this._quickSaveData)throw Error("\u30bb\u30fc\u30d6\u30c7\u30fc\u30bf\u304c\u3042\u308a\u307e\u305b\u3093\u3002");
a=JSON.parse(JSON.stringify(a?this._restartData:this._quickSaveData));this._player.setEnergyMax(a.statusEnergyMax);this._player.setEnergy(a.statusEnergy);this._player.setStrength(a.statusStrength);this._player.setDefence(a.statusDefence);this._player.setGold(a.statusGold);this._player.setMoveCount(a.moves);this._player.clearItemBox();for(var b=0;b<a.itemBox.length;b++)this._player.addItem(a.itemBox[b],b+1,!0);this._player.systemJumpTo(new wwa_data.Position(this,a.playerX,a.playerY,0,0));0===a.bgm?
this.playSound(99):this.playSound(a.bgm);this.setImgClick(new k(a.imgClickX,a.imgClickY));0!==this.getObjectIdByPosition(this._player.getPosition())&&this._player.setPartsAppearedFlag();this._wwaData=a;this.updateCSSRule()};d.prototype._restartGame=function(){this._quickLoad(!0)};d.prototype._fadeout=function(a){var c=0,d=b.MAP_WINDOW_WIDTH,f=b.FADEOUT_SPEED,e=wwa_util.$id("wwa-fader");e.style.display="block";var g=setInterval(function(){c+=f;d-=2*f;0>=d||2*c>b.MAP_WINDOW_WIDTH?(e.removeAttribute("style"),
e.style.display="block",e.style.borderWidth="0",e.style.width=b.MAP_WINDOW_WIDTH+"px",e.style.height=b.MAP_WINDOW_HEIGHT+"px",e.style.backgroundColor="#808080",clearInterval(g),a()):(e.style.width=d+"px",e.style.height=d+"px",e.style.borderWidth=c+"px")},20)};d.prototype.moveObjects=function(a){var c=this._camera.getPosition();this._player.getPosition();c.getPartsCoord();var d=c.getPartsCoord().x,c=c.getPartsCoord().y,f,e,g;if(this.getMapAttributeByPosition(this._player.getPosition(),b.ATR_TYPE)!==
b.MAP_LOCALGATE&&this.getObjectAttributeByPosition(this._player.getPosition(),b.ATR_TYPE)!==b.OBJECT_LOCALGATE){f=Array(b.V_PARTS_NUM_IN_WINDOW+2);this.hoge=Array(b.V_PARTS_NUM_IN_WINDOW+2);for(g=-1;g<=b.V_PARTS_NUM_IN_WINDOW;g++)for(f[g+1]=Array(b.H_PARTS_NUM_IN_WINDOW+2),this.hoge[g+1]=Array(b.H_PARTS_NUM_IN_WINDOW+2),e=-1;e<=b.H_PARTS_NUM_IN_WINDOW;e++)if(0>c+g||c+g>=this._wwaData.mapWidth||0>d+e||d+e>=this._wwaData.mapWidth)f[g+1][e+1]=0,this.hoge[g+1][e+1]=0;else{try{var q=new u(this,d+e,c+g,
0,0),h=q.getPartsCoord()}catch(l){f[g+1][e+1]=0;this.hoge[g+1][e+1]=0;continue}f[g+1][e+1]=this._wwaData.mapObject[h.y][h.x];this.hoge[g+1][e+1]=-this._wwaData.mapObject[h.y][h.x]}for(e=-1;e<=b.H_PARTS_NUM_IN_WINDOW;e++)if(!(0>d+e||d+e>=this._wwaData.mapWidth))for(g=-1;g<=b.V_PARTS_NUM_IN_WINDOW;g++)if(!(0>c+g||c+g>=this._wwaData.mapWidth)){try{q=new u(this,d+e,c+g,0,0),h=q.getPartsCoord()}catch(p){continue}var y=this._wwaData.mapObject[h.y][h.x];if(0!==y&&0!==this._wwaData.objectAttribute[y][b.ATR_MOVE]&&
this._wwaData.objectAttribute[y][b.ATR_TYPE]!==b.OBJECT_LOCALGATE){var v=this._wwaData.objectAttribute[y][b.ATR_MOVE];if(3!==v){var t=this._getCandidateCoord(a,q,v),w=new k(t.x,h.y),z=new k(h.x,t.y),A=null;this._objectCanMoveTo(a,t,f)?this._setObjectsInNextFrame(h,t,d,c,f,y):(A=this._getSecondCandidateMoveMode(a,h,t,w,z,this._wwaData.objectAttribute[y][b.ATR_TYPE]===b.OBJECT_MONSTER,f),0===A?this._setObjectsInNextFrame(h,w,d,c,f,y):1===A?this._setObjectsInNextFrame(h,z,d,c,f,y):(A=this._getThirdCandidate(a,
q,t,v,f),null!==A?this._setObjectsInNextFrame(h,A,d,c,f,y):(v=this._getRandomMoveCoord(a,q,f),this._setObjectsInNextFrame(h,v,d,c,f,y))))}else v=this._getRandomMoveCoord(a,q,f),this._setObjectsInNextFrame(h,v,d,c,f,y)}}}};d.prototype._getCandidateCoord=function(a,b,c){b=b.getPartsCoord();this._player.getPosition().getOffsetCoord();this._player.getPosition().getPartsCoord();try{var d=a?this._player.getPosition().getNextJustPosition().getPartsCoord():this._player.getPosition().getPartsCoord()}catch(e){throw Error("\u4e88\u671f\u305b\u306c\u65b9\u5411\u3078\u306e\u79fb\u52d5\u306e\u3088\u3046\u3067\u3059\u3002");
}a=b.clone();var g=0,h=0;1===c?(g=b.x>d.x?1:b.x<d.x?-1:0,h=b.y>d.y?1:b.y<d.y?-1:0):2===c&&(g=b.x>d.x?-1:b.x<d.x?1:0,h=b.y>d.y?-1:b.y<d.y?1:0);a.x-=g;a.y-=h;a.x=Math.min(this._wwaData.mapWidth-1,Math.max(0,a.x));a.y=Math.min(this._wwaData.mapWidth-1,Math.max(0,a.y));return a};d.prototype._getSecondCandidateMoveMode=function(a,b,c,d,e,g,h){return!a||(3!==this._player.getDir()&&2!==this._player.getDir()||!g)&&(0!==this._player.getDir()&&1!==this._player.getDir()||g)?this._objectCanMoveTo(a,d,h)?0:this._objectCanMoveTo(a,
e,h)?1:2:this._objectCanMoveTo(a,e,h)?1:this._objectCanMoveTo(a,d,h)?0:2};d.prototype._getThirdCandidate=function(a,b,c,d,e){d=1===d?1:2===d?-1:0;var g=a?this._player.getPosition().getNextJustPosition().getPartsCoord():this._player.getPosition().getPartsCoord();b=b.getPartsCoord();var h;if(g.x!==b.x){h=new k(c.x,b.y+1*d);if(this._objectCanMoveTo(a,h,e))return h;h=new k(c.x,b.y-1*d);if(this._objectCanMoveTo(a,h,e))return h;h=new k(b.x,b.y+1*d);if(this._objectCanMoveTo(a,h,e))return h;h=new k(b.x,b.y-
1*d);if(this._objectCanMoveTo(a,h,e))return h}if(g.y!==b.y){h=new k(b.x+1*d,c.y);if(this._objectCanMoveTo(a,h,e))return h;h=new k(b.x-1*d,c.y);if(this._objectCanMoveTo(a,h,e))return h;h=new k(b.x+1*d,b.y);if(this._objectCanMoveTo(a,h,e))return h;h=new k(b.x-1*d,b.y);if(this._objectCanMoveTo(a,h,e))return h}return null};d.prototype._getRandomMoveCoord=function(a,c,d){c=c.getPartsCoord();for(var e=c.clone(),g=0;g<b.RANDOM_MOVE_ITERATION_NUM;g++){var h=Math.floor(8*Math.random());e.x=c.x+wwa_data.vx[h];
e.y=c.y+wwa_data.vy[h];if(this._objectCanMoveTo(a,e,d))return e}return c};d.prototype.isPrevFrameEventExecuted=function(){return this._prevFrameEventExected};d.prototype._objectCanMoveTo=function(a,c,d){if(0>c.x||0>c.y||this._wwaData.mapWidth<=c.x||this._wwaData.mapWidth<=c.y)return!1;var e=this._wwaData.map[c.y][c.x],g=this._wwaData.mapObject[c.y][c.x],h=this._wwaData.mapAttribute[e][b.ATR_TYPE],k=this._camera.getPosition(),l=k.getPartsCoord().x,k=k.getPartsCoord().y;if(0===e&&!this.isOldMap()||
h===b.MAP_WALL)return!1;e=c.x-l+1;h=c.y-k+1;if(0<=e&&0<=h&&e<d.length&&h<d.length){if(0!==d[h][e])return!1}else if(0!==g)return!1;if(a){if(this._player.getPosition().getNextJustPosition().getPartsCoord().equals(c))return!1}else if(this._player.getPosition().getPartsCoord().equals(c))return!1;return!0};d.prototype._setObjectsInNextFrame=function(a,b,c,d,e,g){var h=b.x-c+1,k=b.y-d+1;0<=b.x&&b.x<=this._wwaData.mapWidth&&0<=b.y&&b.y<=this._wwaData.mapWidth&&(0<=h&&h<e.length&&0<=k&&k<e.length&&(e[a.y-
d+1][a.x-c+1]=0,e[b.y-d+1][b.x-c+1]=g,this.hoge[b.y-d+1][b.x-c+1]=g),this._objectMovingDataManager.add(g,a.convertIntoPosition(this),b.convertIntoPosition(this),a.getDirectionTo(b)))};d.prototype.launchBattleEstimateWindow=function(){var a=this._camera.getPosition().getPartsCoord(),c=Math.max(0,a.x),d=Math.min(this._wwaData.mapWidth-1,a.x+b.H_PARTS_NUM_IN_WINDOW-1),e=Math.max(0,a.y),a=Math.min(this._wwaData.mapWidth-1,a.y+b.V_PARTS_NUM_IN_WINDOW)-1,g=[];for(this.playSound(1);c<=d;c++)for(var h=e;h<=
a;h++){var k=this._wwaData.mapObject[h][c];this._wwaData.objectAttribute[k][b.ATR_TYPE]===b.OBJECT_MONSTER&&-1===g.indexOf(k)&&g.push(k)}if(0===g.length)return!1;this._battleEstimateWindow.update(this._player.getStatus(),g);this._battleEstimateWindow.show();this._player.setEstimateWindowWating();return!0};d.prototype.hideBattleEstimateWindow=function(){this._battleEstimateWindow.hide();this._player.clearEstimateWindowWaiting()};d.prototype._displayHelp=function(){this._player.isControllable()&&this.setMessageQueue("\u3010\u30b7\u30e7\u30fc\u30c8\u30ab\u30c3\u30c8\u30ad\u30fc\u306e\u4e00\u89a7\u3011\n\uff26\uff11\u3001\uff2d\uff1a\u6226\u95d8\u7d50\u679c\u4e88\u6e2c\u306e\u8868\u793a\n\uff26\uff15\uff1a\u4e00\u6642\u4fdd\u5b58\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u8fbc\u307f\n\uff26\uff16\uff1a\u30c7\u30fc\u30bf\u306e\u4e00\u6642\u4fdd\u5b58\n\uff26\uff17\uff1a\u521d\u3081\u304b\u3089\u30b9\u30bf\u30fc\u30c8\n\uff26\uff18\uff1a\uff37\uff37\uff21\u516c\u5f0f\u30da\u30fc\u30b8\u306b\u30ea\u30f3\u30af\n\uff26\uff11\uff12\uff1a\u3053\u306e\u30ea\u30b9\u30c8\u306e\u8868\u793a\n\u30ad\u30fc\u30dc\u30fc\u30c9\u306e\u300c\uff11\uff12\uff13\u3001\uff31\uff37\uff25\u3001\uff21\uff33\uff24\u3001\uff3a\uff38\uff23\u300d\u306f\u53f3\u306e\u30a2\u30a4\u30c6\u30e0\u30dc\u30c3\u30af\u30b9\u306b\u5bfe\u5fdc\u3002\n\u300c\uff25\uff4e\uff54\uff45\uff52\u3001\uff39\u300d\u306f\uff39\uff45\uff53,\u300c\uff25\uff53\uff43\u3001\uff2e\u300d\u306f\uff2e\uff4f\u306b\u5bfe\u5fdc\u3002\n I : \u79fb\u52d5\u901f\u5ea6\u3092\u843d\u3068\u3059\uff0f\uff30: \u79fb\u52d5\u901f\u5ea6\u3092\u4e0a\u3052\u308b\n\u73fe\u5728\u306e\u79fb\u52d5\u56de\u6570\uff1a"+
this._player.getMoveCount()+"\nWWA Wing \u30d0\u30fc\u30b8\u30e7\u30f3:"+b.VERSION_WWAJS,!1,!0)};d.prototype._setNextMessage=function(a){void 0===a&&(a=!1);this._clearFacesInNextFrame=!0;this._scoreWindow.isVisible()&&this._scoreWindow.hide();this._lastMessage.isEndOfPartsEvent&&void 0!==this._reservedMoveMacroTurn&&(this._player.setMoveMacroWaiting(this._reservedMoveMacroTurn),this._reservedMoveMacroTurn=void 0);if(0===this._messageQueue.length)this._hideMessageWindow();else{var b=this._messageQueue.shift(),
c=b.message,d=b.macro;this._lastMessage=b;for(b=0;b<d.length;b++)this._execMacroListInNextFrame.push(d[b]);""!==c?(this._messageWindow.hide(),this._messageWindow.setMessage(c),this._messageWindow.setPositionByPlayerPosition(0!==this._faces.length,this._scoreWindow.isVisible(),a,this._player.getPosition(),this._camera.getPosition()),this._messageWindow.show()):0===this._messageQueue.length?this._hideMessageWindow():this._setNextMessage()}};d.prototype._hideMessageWindow=function(a){void 0===a&&(a=
!0);var c=0;this._player.isReadyToUseItem()&&(c=this._player.useItem());var d=this.getObjectAttributeById(c,b.ATR_STRING);this.clearFaces();0===d?(a&&(this._messageWindow.hide(),this._keyStore.allClear(),this._mouseStore.clear()),this._player.clearMessageWaiting()):this.setMessageQueue(this.getMessageById(d),!1,!1,c,0,this._player.getPosition().getPartsCoord(),!0)};d.prototype.replaceParts=function(a,c,d,e){void 0===d&&(d=0);void 0===e&&(e=!1);var g=this._camera.getPosition().getPartsCoord(),h=e?
Math.max(0,g.x):0,k=e?Math.min(this._wwaData.mapWidth-1,g.x+b.H_PARTS_NUM_IN_WINDOW-1):this._wwaData.mapWidth-1,l=e?Math.max(0,g.y):0;for(e=e?Math.min(this._wwaData.mapWidth-1,g.y+b.V_PARTS_NUM_IN_WINDOW)-1:this._wwaData.mapWidth-1;h<=k;h++)for(g=l;g<=e;g++)if(0===d){var p=this._wwaData.mapObject[g][h];p===a&&(this._wwaData.mapObject[g][h]=c)}else p=this._wwaData.map[g][h],p===a&&(this._wwaData.map[g][h]=c)};d.prototype.getYesNoImgCoord=function(){return new k(this._wwaData.yesnoImgPosX,this._wwaData.yesnoImgPosY)};
d.prototype.setYesNoImgCoord=function(a){this._wwaData.yesnoImgPosX=a.x;this._wwaData.yesnoImgPosY=a.y;return a};d.prototype.getPlayerImgCoord=function(){return new k(this._wwaData.playerImgPosX,this._wwaData.playerImgPosY)};d.prototype.setPlayerImgCoord=function(a){this._wwaData.playerImgPosX=a.x;this._wwaData.playerImgPosY=a.y;return a};d.prototype.setPlayerEnergyMax=function(a){return this._player.setEnergyMax(a)};d.prototype.getMapPartsNum=function(){return this._wwaData.mapPartsMax};d.prototype.getObjectPartsNum=
function(){return this._wwaData.objPartsMax};d.prototype.setMoveMacroWaitingToPlayer=function(a){this._reservedMoveMacroTurn=a};d.prototype.disableSave=function(a){return this._wwaData.disableSaveFlag=a};d.prototype.isOldMap=function(){return this._wwaData.isOldMap};d.prototype.setOldMap=function(a){return this._wwaData.isOldMap=a};d.prototype.setObjectNotCollapseOnPartsOnPlayer=function(a){return this._wwaData.objectNoCollapseDefaultFlag=a};d.prototype.setGameOverPosition=function(a){if(0>a.x||a.x>=
this.getMapWidth()||0>a.y||a.y>=this.getMapWidth())throw Error("\u30de\u30c3\u30d7\u306e\u7bc4\u56f2\u5916\u304c\u6307\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059!");this._wwaData.gameoverX=a.x;this._wwaData.gameoverY=a.y;return a};d.prototype.setPlayerStatus=function(a,b){if(0===a)this._player.setEnergy(b);else if(1===a)this._player.setStrength(b);else if(2===a)this._player.setDefence(b);else if(3===a)this._player.setGold(b);else if(4===a)this._player.setMoveCount(b);else throw Error("\u672a\u5b9a\u7fa9\u306e\u30b9\u30c6\u30fc\u30bf\u30b9\u30bf\u30a4\u30d7\u3067\u3059");
};d.prototype.setDelPlayer=function(a){return this._wwaData.delPlayerFlag=a};d.prototype.setPlayerGetItem=function(a,b){try{this._player.addItem(b,a,!0)}catch(c){}};d.prototype.setFrameCoord=function(a){return this._frameCoord=a.clone()};d.prototype.setBattleEffectCoord=function(a){return this._battleEffectCoord=a.clone()};d.prototype.canInput=function(){return!this._temporaryInputDisable};d.prototype.setWaitTime=function(a){this._waitTimeInCurrentFrame+=a;this._temporaryInputDisable=!0};d.prototype.setEffect=
function(a,b){this._wwaData.effectWaits=a;this._wwaData.effectCoords=b};d.prototype.stopEffect=function(){this._wwaData.effectCoords=[]};d.prototype.setImgClick=function(a){this._wwaData.imgClickX=a.x;this._wwaData.imgClickY=a.y;if(a.equals(new k(0,0)))Array.prototype.forEach.call(wwa_util.$qsAll(".item-cell>.item-click-border"),function(a){a.style.backgroundImage="url('"+wwa_data.WWAConsts.ITEM_BORDER_IMG_DATA_URL+"')";a.style.backgroundPosition="0 0"});else{var c=this._wwaData.mapCGName.replace("(",
"\\(").replace(")","\\)");Array.prototype.forEach.call(wwa_util.$qsAll(".item-cell>.item-click-border"),function(d){d.style.backgroundImage="url('"+c+"')";d.style.backgroundPosition="-"+a.x*b.CHIP_SIZE+"px -"+a.y*b.CHIP_SIZE+"px"})}};d.prototype.addFace=function(a){this._faces.push(a)};d.prototype.clearFaces=function(){this._faces=[]};d.prototype.initCSSRule=function(){console.log(this);this._styleElm=wwa_util.$id(b.WWA_STYLE_TAG_ID);this._sheet=this._styleElm.sheet;this.updateCSSRule()};d.prototype.updateCSSRule=
function(){if(void 0===this._stylePos)this._stylePos=Array(2);else if(void 0!==this._sheet.addRule)for(var a=0;a<this._stylePos.length;a++)this._sheet.removeRule(this._stylePos[this._styleElm[a]]);else for(a=0;a<this._stylePos.length;a++)this._sheet.deleteRule(this._stylePos[this._styleElm[a]]);void 0!==this._sheet.addRule?(this._stylePos[0]=this._sheet.addRule("div.wwa-message-window","background-color: rgba("+this._wwaData.frameColorR+","+this._wwaData.frameColorG+","+this._wwaData.frameColorB+
",1) ;border-color: rgba("+this._wwaData.frameOutColorR+","+this._wwaData.frameOutColorG+","+this._wwaData.frameOutColorB+",1);color: rgba("+this._wwaData.fontColorR+","+this._wwaData.fontColorG+","+this._wwaData.fontColorB+",1);"),this._stylePos[1]=this._sheet.addRule("div#wwa-sidebar","color: rgba("+this._wwaData.statusColorR+","+this._wwaData.statusColorG+","+this._wwaData.statusColorB+",1);font-weight: bold;")):(this._stylePos[0]=this._sheet.insertRule("div.wwa-message-window {\nbackground-color: rgb("+
this._wwaData.frameColorR+","+this._wwaData.frameColorG+","+this._wwaData.frameColorB+");\nborder-color: rgb("+this._wwaData.frameOutColorR+","+this._wwaData.frameOutColorG+","+this._wwaData.frameOutColorB+");\ncolor: rgb("+this._wwaData.fontColorR+","+this._wwaData.fontColorG+","+this._wwaData.fontColorB+");\n}",0),this._stylePos[1]=this._sheet.insertRule("div#wwa-sidebar {\ncolor: rgba("+this._wwaData.statusColorR+","+this._wwaData.statusColorG+","+this._wwaData.statusColorB+",1);\nfont-weight: bold;\n}",
1))};d.prototype.changeStyleRule=function(a,b,c,d){0===a?(this._wwaData.frameColorR=b,this._wwaData.frameColorG=c,this._wwaData.frameColorB=d):1===a?(this._wwaData.frameOutColorR=b,this._wwaData.frameOutColorG=c,this._wwaData.frameOutColorB=d):2===a?(this._wwaData.fontColorR=b,this._wwaData.fontColorG=c,this._wwaData.fontColorB=d):4===a&&(this._wwaData.statusColorR=b,this._wwaData.statusColorG=c,this._wwaData.statusColorB=d);this.updateCSSRule()};d.prototype.showMonsterWindow=function(){this._monsterWindow.show()};
d.prototype.isConsoleOutputMode=function(){return this._useConsole};return d}();e.WWA=w;var B=!1;"complete"===document.readyState?d():window.addEventListener("load",d)})(wwa_main||(wwa_main={}));
